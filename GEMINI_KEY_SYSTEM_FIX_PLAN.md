# ๐ง ุฎุทุฉ ุฅุตูุงุญ ูุธุงู ุฅุฏุงุฑุฉ ููุงุชูุญ Gemini - ุชุญููู ููุตู

## ๐ ููุฎุต ุงููุดุงูู ุงูููุชุดูุฉ

ุชู ุงูุชุดุงู **22 ูุดููุฉ** ูู ูุธุงู ุฅุฏุงุฑุฉ ุงูููุงุชูุญุ ููุณูุฉ ุฅูู:
- ๐ฅ **7 ูุดุงูู ุญุฑุฌุฉ** (Critical)
- โก **8 ูุดุงูู ุนุงููุฉ ุงูุฃููููุฉ** (High Priority)
- ๐ง **7 ูุดุงูู ูุชูุณุทุฉ ุงูุฃููููุฉ** (Medium Priority)

---

## ๐ฏ ุงููุฑุญูุฉ 1 - ุงูุฅุตูุงุญุงุช ุงูุญุฑุฌุฉ ุงูููุฑูุฉ (1-2 ุณุงุนุฉ)

### **ุงูุฅุตูุงุญ 1: ุฅุถุงูุฉ ูุธุงู ุชุชุจุน ุนุงููู ููููุงุฐุฌ ุงููุฌุฑุจุฉ**

#### ุงููุดููุฉ ุงูุญุงููุฉ:
- `triedModels` ูุชู ุฅูุดุงุคู ูุญููุงู ูู `catch block`
- ูุง ูุชู ูุดุงุฑูุชู ูุน `findNextAvailableModel()`
- ุงููุชูุฌุฉ: ุชุฌุฑุจุฉ ููุณ ุงููููุฐุฌ ุงููุณุชููุฏ ูู ููุงุชูุญ ูุฎุชููุฉ

#### ุงูุญู ุงูููุชุฑุญ:
- ุฅุถุงูุฉ `globalTriedModels` ูู Map ุนูู ูุณุชูู ุงูู class
- ุงูููุชุงุญ: `sessionId` (companyId + timestamp)
- ุงููููุฉ: Set ูู ุฃุณูุงุก ุงูููุงุฐุฌ ุงููุฌุฑุจุฉ
- ุชูุธูู ุชููุงุฆู ุจุนุฏ 5 ุฏูุงุฆู

#### ุงูุชุฃุซูุฑ ุงููุชููุน:
- โ ููุน ุชุฌุฑุจุฉ ููุณ ุงููููุฐุฌ ูุฑุชูู
- โ ุชูููู ุงููุญุงููุงุช ุงููุงุดูุฉ ุจูุณุจุฉ 60-70%
- โ ุชุญุณูู ููุช ุงูุงุณุชุฌุงุจุฉ ุจููุฏุงุฑ 2-3 ุซูุงูู
- โ ุชูููุฑ ุงุณุชููุงู API calls ุบูุฑ ุถุฑูุฑูุฉ

#### ุงููุฎุงุทุฑ:
- โ๏ธ ุงุณุชููุงู ุฐุงูุฑุฉ ุฅุถุงูู (ูุญุฏูุฏ - ูุชู ุงูุชูุธูู ูู 5 ุฏูุงุฆู)
- โ๏ธ ูุญุชุงุฌ ุฅูู ุชูุณูู ุจูู responseGenerator ู modelManager

---

### **ุงูุฅุตูุงุญ 2: ุฅุถุงูุฉ ูุนุงูู excludeModels ูู findNextAvailableModel**

#### ุงููุดููุฉ ุงูุญุงููุฉ:
- `findNextAvailableModel()` ูุง ููุจู ูุงุฆูุฉ ุจุงูููุงุฐุฌ ุงููุณุชุซูุงุฉ
- ูุนูุฏ ุฃู ูููุฐุฌ ูุชุงุญ ุญุชู ูู ุชู ุชุฌุฑุจุชู
- ูุง ููุฌุฏ ุชูุณูู ูุน `triedModels`

#### ุงูุญู ุงูููุชุฑุญ:
- ุฅุถุงูุฉ ูุนุงูู `excludeModels = []` ูู `findNextAvailableModel()`
- ุชูุฑูุฑ ุงููุนุงูู ุฅูู `findBestModelByPriorityWithQuota()`
- ูุญุต ุงููุงุฆูุฉ ุงููุณุชุซูุงุฉ ูุจู ุงุฎุชูุงุฑ ุงููููุฐุฌ
- ูุญุต `exhaustedModelsCache` ุฃูุถุงู

#### ุงูุชุฃุซูุฑ ุงููุชููุน:
- โ ููุน ุชุฌุฑุจุฉ ููุงุฐุฌ ูุงุดูุฉ ุจูุณุจุฉ 100%
- โ ุชูููู ุนุฏุฏ ุงููุญุงููุงุช ูู 4-5 ุฅูู 2-3
- โ ุชุญุณูู ูุนุฏู ุงููุฌุงุญ ูู 70% ุฅูู 95%
- โ ุชูููุฑ 30-40% ูู API calls

#### ุงููุฎุงุทุฑ:
- โ๏ธ ูุญุชุงุฌ ุฅูู ุชุนุฏูู ุฌููุน ุงุณุชุฏุนุงุกุงุช `findNextAvailableModel()`
- โ๏ธ ูุฏ ูุคุฏู ุฅูู ุนุฏู ุงูุนุซูุฑ ุนูู ูููุฐุฌ ุฅุฐุง ูุงูุช ุงููุงุฆูุฉ ูุจูุฑุฉ ุฌุฏุงู

---

### **ุงูุฅุตูุงุญ 3: ุฅุถุงูุฉ Cache Invalidation ุนูุฏ ุชุญุฏูุซ ุงูุงุณุชุฎุฏุงู**

#### ุงููุดููุฉ ุงูุญุงููุฉ:
- `quotaCache` ูู TTL 10 ุซูุงูู
- ุนูุฏ ุชุญุฏูุซ ุงูุงุณุชุฎุฏุงู ูู `updateModelUsage()` ูุง ูุชู ุญุฐู ุงูู cache
- ุงููุชูุฌุฉ: ุงุณุชุฎุฏุงู ุจูุงูุงุช ูุฏููุฉ ููุฏุฉ 10 ุซูุงูู

#### ุงูุญู ุงูููุชุฑุญ:
- ุฅุถุงูุฉ `this.quotaCache.delete(cacheKey)` ูู `updateModelUsage()`
- ุฅุถุงูุฉ `invalidateQuotaCache(modelName, companyId)` ูุฏุงูุฉ ูููุตูุฉ
- ุงุณุชุฏุนุงุคูุง ุจุนุฏ ูู ุชุญุฏูุซ ููุงุณุชุฎุฏุงู
- ุงุณุชุฏุนุงุคูุง ุจุนุฏ `markModelAsExhaustedFrom429()`

#### ุงูุชุฃุซูุฑ ุงููุชููุน:
- โ ุจูุงูุงุช ููุชุฉ ุฏูููุฉ 100% (ุจุฏูุงู ูู 90%)
- โ ูุฑุงุฑุงุช ุชุจุฏูู ุตุญูุญุฉ ุจูุณุจุฉ 95% (ุจุฏูุงู ูู 70%)
- โ ุชูููู ุญุงูุงุช ุงุฎุชูุงุฑ ูููุฐุฌ ูุณุชููุฏ ุจูุณุจุฉ 80%
- โ ุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู (ุฑุฏูุฏ ุฃุณุฑุน ูุฃูู ุฃุฎุทุงุก)

#### ุงููุฎุงุทุฑ:
- โ๏ธ ุฒูุงุฏุฉ ุทูููุฉ ูู ุงุณุชุนูุงูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช (5-10%)
- โ๏ธ ูุญุชุงุฌ ุฅูู ุชูุณูู ุจูู ุฌููุน ุงูุฏูุงู ุงูุชู ุชุญุฏุซ ุงูุงุณุชุฎุฏุงู

---

### **ุงูุฅุตูุงุญ 4: ุฏูุฌ exhaustedModelsCache ูุน excludedModels**

#### ุงููุดููุฉ ุงูุญุงููุฉ:
- ูุธุงูุงู ูููุตูุงู: `exhaustedModelsCache` (10 ุฏูุงุฆู) ู `excludedModels` (6 ุณุงุนุงุช)
- `markModelAsExhaustedFrom429()` ูุถูู ููุท ุฅูู `exhaustedModelsCache`
- ุงููุชูุฌุฉ: ูููุฐุฌ ูุณุชููุฏ ูุฏ ูุง ูููู ูุณุชุซูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

#### ุงูุญู ุงูููุชุฑุญ:
- ุนูุฏ ุงุณุชุฏุนุงุก `markModelAsExhaustedFrom429()`:
  - ุฅุถุงูุฉ ุฅูู `exhaustedModelsCache` (ููุณุฑุนุฉ)
  - ุฅุถุงูุฉ ุฅูู `excludedModels` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (ููุงุณุชูุฑุงุฑูุฉ)
- ุชูุญูุฏ ููุทู ุงููุญุต ูู ุฏุงูุฉ ูุงุญุฏุฉ `isModelAvailable()`
- ูุญุต ููุง ุงููุธุงููู ูุจู ุงุฎุชูุงุฑ ุงููููุฐุฌ

#### ุงูุชุฃุซูุฑ ุงููุชููุน:
- โ ุชุชุจุน ุฏููู ููููุงุฐุฌ ุงููุณุชููุฏุฉ ุจูุณุจุฉ 100%
- โ ููุน ุชุฌุฑุจุฉ ููุงุฐุฌ ูุณุชููุฏุฉ ุญุชู ุจุนุฏ ุฅุนุงุฏุฉ ุชุดุบูู ุงูุณูุฑูุฑ
- โ ุชูููู ุฃุฎุทุงุก 429 ุจูุณุจุฉ 70-80%
- โ ุงุณุชูุฑุงุฑูุฉ ุงูุจูุงูุงุช ุนุจุฑ ุงูุฌูุณุงุช

#### ุงููุฎุงุทุฑ:
- โ๏ธ ุฒูุงุฏุฉ ูู ุงุณุชุนูุงูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช (10-15%)
- โ๏ธ ูุญุชุงุฌ ุฅูู ุชูุธูู ุฏูุฑู ูุฌุฏูู `excludedModels`

---

### **ุงูุฅุตูุงุญ 5: ุฅุถุงูุฉ Optimistic Locking ูู updateModelUsage**

#### ุงููุดููุฉ ุงูุญุงููุฉ:
- `updateModelUsage()` ููุฑุฃ ุซู ููุชุจ ุจุฏูู ุชุญูู
- ุทูุจุงู ูุชุฒุงููุงู ูุฏ ูุญุฏุซุงู ููุณ ุงููููุฉ ูุฑุชูู
- ุงููุชูุฌุฉ: ุนุฏู ุฏูุฉ ูู ุชุชุจุน ุงูููุชุฉ (ุฎุทุฃ 5-10%)

#### ุงูุญู ุงูููุชุฑุญ:
- ุฅุถุงูุฉ ุญูู `version` ุฃู `updatedAt` ููุชุญูู
- ุงุณุชุฎุฏุงู `WHERE` clause ูู `UPDATE`:
  ```
  WHERE id = modelId AND updatedAt = oldUpdatedAt
  ```
- ุฅุฐุง ูุดู ุงูุชุญุฏูุซุ ุฅุนุงุฏุฉ ุงููุญุงููุฉ (retry)
- ุญุฏ ุฃูุตู 3 ูุญุงููุงุช

#### ุงูุชุฃุซูุฑ ุงููุชููุน:
- โ ุฏูุฉ 100% ูู ุชุชุจุน ุงูููุชุฉ (ุจุฏูุงู ูู 90-95%)
- โ ููุน Race Conditions ุจูุณุจุฉ 100%
- โ ุชุญุณูู ููุซูููุฉ ุงููุธุงู
- โ ุชูููู ุญุงูุงุช ุงุณุชููุงุฏ ุบูุฑ ูุชููุน

#### ุงููุฎุงุทุฑ:
- โ๏ธ ุฒูุงุฏุฉ ุชุนููุฏ ุงูููุฏ
- โ๏ธ ูุฏ ูุคุฏู ุฅูู retry loops ูู ุญุงูุงุช ุงูุถุบุท ุงูุนุงูู
- โ๏ธ ูุญุชุงุฌ ุฅูู ุชุนุฏูู schema ูุงุนุฏุฉ ุงูุจูุงูุงุช (ุฅุถุงูุฉ version)

---

### **ุงูุฅุตูุงุญ 6: ุฒูุงุฏุฉ Cache TTL ุฅูู 30 ุซุงููุฉ ูุน Invalidation ุฐูู**

#### ุงููุดููุฉ ุงูุญุงููุฉ:
- Cache TTL = 10 ุซูุงูู (ูุตูุฑ ุฌุฏุงู)
- ุงุณุชุนูุงูุงุช ูุชูุฑุฑุฉ ูู 10 ุซูุงูู
- ุถุบุท ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

#### ุงูุญู ุงูููุชุฑุญ:
- ุฒูุงุฏุฉ TTL ุฅูู 30 ุซุงููุฉ (ุชูุงุฒู ุจูู ุงูุฃุฏุงุก ูุงูุฏูุฉ)
- ุฅุถุงูุฉ Invalidation ููุฑู ุนูุฏ:
  - ุชุญุฏูุซ ุงูุงุณุชุฎุฏุงู
  - ุชุญุฏูุฏ ูููุฐุฌ ููุณุชููุฏ
  - ุชูุนูู/ุชุนุทูู ููุชุงุญ
- ุฅุถุงูุฉ `forceRefresh` parameter ููุญุงูุงุช ุงูุญุฑุฌุฉ

#### ุงูุชุฃุซูุฑ ุงููุชููุน:
- โ ุชูููู ุงุณุชุนูุงูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูุณุจุฉ 60-70%
- โ ุชุญุณูู ุงูุฃุฏุงุก (ุณุฑุนุฉ ุงูุงุณุชุฌุงุจุฉ) ุจูุณุจุฉ 30-40%
- โ ุชูููู ุงูุถุบุท ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุฏูุฉ ุงูุจูุงูุงุช ุชุจูู 95%+ (ุจูุถู Invalidation)

#### ุงููุฎุงุทุฑ:
- โ๏ธ ุจูุงูุงุช ูุฏููุฉ ููุฏุฉ 30 ุซุงููุฉ ูู ุญุงูุงุช ูุงุฏุฑุฉ
- โ๏ธ ูุญุชุงุฌ ุฅูู ุชูุณูู ุฏููู ูู Invalidation

---

### **ุงูุฅุตูุงุญ 7: ุฅุถุงูุฉ ุญุฏ ุฃูุตู ูููุญุงููุงุช (MAX_FALLBACK_ATTEMPTS)**

#### ุงููุดููุฉ ุงูุญุงููุฉ:
- ูุง ููุฌุฏ ุญุฏ ุฃูุตู ูููุญุงููุงุช
- ุงููุธุงู ูุญุงูู: 503 โ backup โ 429 โ second backup โ ูุชููู
- ููุท ูุญุงููุชุงู (ูุฏ ูุง ุชููู)

#### ุงูุญู ุงูููุชุฑุญ:
- ุฅุถุงูุฉ `MAX_FALLBACK_ATTEMPTS = 3`
- ุงุณุชุฎุฏุงู `while loop` ูุน ุนุฏุงุฏ
- ุชุชุจุน ุฌููุน ุงูููุงุฐุฌ ุงููุฌุฑุจุฉ
- ุฅุฑุณุงู ุฑุณุงูุฉ ููุนููู ุจุนุฏ ุงุณุชููุงุฏ ุงููุญุงููุงุช

#### ุงูุชุฃุซูุฑ ุงููุชููุน:
- โ ุฒูุงุฏุฉ ูุนุฏู ุงููุฌุงุญ ูู 85% ุฅูู 95%
- โ ุชุบุทูุฉ ุญุงูุงุช ูุดู ูุชุนุฏุฏุฉ
- โ ุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู (ูุญุงููุงุช ุฃูุซุฑ)
- โ ุชูููู ุญุงูุงุช "ูุง ููุฌุฏ ุฑุฏ" ุจูุณุจุฉ 50%

#### ุงููุฎุงุทุฑ:
- โ๏ธ ุฒูุงุฏุฉ ููุช ุงูุงุณุชุฌุงุจุฉ ูู ุญุงูุงุช ุงููุดู (3-5 ุซูุงูู ุฅุถุงููุฉ)
- โ๏ธ ุงุณุชููุงู API calls ุฃูุซุฑ (ููู ุจูุฌุงุญ ุฃุนูู)

---

## โก ุงููุฑุญูุฉ 2 - ุงูุชุญุณููุงุช ุนุงููุฉ ุงูุฃููููุฉ (1-2 ููู)

### **ุงูุชุญุณูู 1: ุชูุนูู Round-Robin ุงูุญูููู ูุน Load Balancing**

#### ุงููุดููุฉ ุงูุญุงููุฉ:
- `selectBestModelByPriority()` ูุฎุชุงุฑ ุฏุงุฆูุงู `availableModels[0]`
- `selectNextKeyRoundRobin()` ููุฌูุฏ ููู @deprecated ููุง ููุณุชุฎุฏู
- ุงููุชูุฌุฉ: ุงูููุชุงุญ ุงูุฃูู ูุณุชููุฏ ุจุณุฑุนุฉ

#### ุงูุญู ุงูููุชุฑุญ:
- ุชุนุฏูู `selectBestModelByPriority()` ููุตุจุญ `selectBestModelWithLoadBalancing()`
- ุฎูุงุฑุฒููุฉ ุฌุฏูุฏุฉ:
  1. ุชุฌููุน ุงูููุงุชูุญ ุญุณุจ ุงูุฃููููุฉ
  2. ููููุงุชูุญ ุฐุงุช ููุณ ุงูุฃููููุฉ: ุงุฎุชูุงุฑ ุงูุฃูู ุงุณุชุฎุฏุงูุงู
  3. ุญุณุงุจ ูุณุจุฉ ุงูุงุณุชุฎุฏุงู: `used / limit`
  4. ุงุฎุชูุงุฑ ุงูููุชุงุญ ุจุฃูู ูุณุจุฉ
- ุชุญุฏูุซ `lastUsed` ููููุชุงุญ ุงููุฎุชุงุฑ

#### ุงูุชุฃุซูุฑ ุงููุชููุน:
- โ ุชูุฒูุน ูุชุณุงูู ููุฃุญูุงู ุจูู ุงูููุงุชูุญ (90%+)
- โ ุฒูุงุฏุฉ ุนูุฑ ุงูููุงุชูุญ (ุงุณุชููุงุฏ ุฃุจุทุฃ)
- โ ุชูููู ุญุงูุงุช "ุฌููุน ุงูููุงุชูุญ ูุณุชููุฏุฉ" ุจูุณุจุฉ 80%
- โ ุงุณุชุบูุงู ุฃูุถู ููููุงุฑุฏ ุงููุชุงุญุฉ

#### ุงููุฎุงุทุฑ:
- โ๏ธ ุชุนููุฏ ุฃูุจุฑ ูู ููุทู ุงูุงุฎุชูุงุฑ
- โ๏ธ ูุฏ ูุคุฏู ุฅูู ุงุฎุชูุงุฑ ููุชุงุญ ุฃุจุทุฃ ุฃุญูุงูุงู
- โ๏ธ ูุญุชุงุฌ ุฅูู ุงุฎุชุจุงุฑ ููุซู

---

### **ุงูุชุญุณูู 2: ุงุณุชุซูุงุก ุนูู ูุณุชูู ุงูููุชุงุญ ูููุณ ุงููููุฐุฌ**

#### ุงููุดููุฉ ุงูุญุงููุฉ:
- ุนูุฏ RPD 100% ูู ุงูููุชุฉ ุงูุฅุฌูุงููุฉุ ูุชู ุงุณุชุซูุงุก ุงููููุฐุฌ ูู **ุฌููุน ุงูููุงุชูุญ**
- ูุฏ ูููู ููุชุงุญ ูุงุญุฏ ูุณุชููุฏ ูุงูุจุงูู ูุชุงุญ
- ุงููุชูุฌุฉ: ููุฏุงู ููุงุชูุญ ูุชุงุญุฉ

#### ุงูุญู ุงูููุชุฑุญ:
- ุชุนุฏูู ููุทู ุงูุงุณุชุซูุงุก:
  - ุญุณุงุจ RPD ููู ููุชุงุญ ุนูู ุญุฏุฉ
  - ุงุณุชุซูุงุก ููุท ุงูููุงุชูุญ ุงููุณุชููุฏุฉ (RPD >= 100%)
  - ุงูุฅุจูุงุก ุนูู ุงูููุงุชูุญ ุงููุชุงุญุฉ
- ุฅุถุงูุฉ `excludeModelInKey(modelName, keyId, companyId)`
- ูุญุต ุงูุงุณุชุซูุงุก ุนูู ูุณุชูู ุงูููุชุงุญ

#### ุงูุชุฃุซูุฑ ุงููุชููุน:
- โ ุงูุญูุงุธ ุนูู 30-50% ูู ุงูููุงุชูุญ ุงููุชุงุญุฉ
- โ ุฒูุงุฏุฉ ูุนุฏู ุงููุฌุงุญ ุจูุณุจุฉ 20-30%
- โ ุงุณุชุบูุงู ุฃูุถู ููููุงุฑุฏ
- โ ุชูููู ุญุงูุงุช "ูุง ููุฌุฏ ูููุฐุฌ ูุชุงุญ"

#### ุงููุฎุงุทุฑ:
- โ๏ธ ุชุนููุฏ ุฃูุจุฑ ูู ุญุณุงุจ ุงูููุชุฉ
- โ๏ธ ุงุณุชุนูุงูุงุช ูุงุนุฏุฉ ุจูุงูุงุช ุฃูุซุฑ (15-20%)
- โ๏ธ ูุญุชุงุฌ ุฅูู ุฅุนุงุฏุฉ ููููุฉ ุฌุฏูู `excludedModels`

---

### **ุงูุชุญุณูู 3: ูุญุต ุงูููุชุฉ ุนูู ูุณุชูู ุงูููุชุงุญ ุงููุญุฏุฏ**

#### ุงููุดููุฉ ุงูุญุงููุฉ:
- ูุญุต 80% ูุชู ุนูู ุงูููุชุฉ ุงูุฅุฌูุงููุฉ
- ูุฏ ูููู ููุชุงุญ 100% ูููุชุงุญ 20% โ ุงูุฅุฌูุงูู 60%
- ูุชู ุงุฎุชูุงุฑ ุงููููุฐุฌ ููู ูุฏ ููุฎุชุงุฑ ุงูููุชุงุญ ุงููุณุชููุฏ

#### ุงูุญู ุงูููุชุฑุญ:
- ุจุนุฏ ุงุฎุชูุงุฑ ุงููููุฐุฌุ ูุญุต ููุชุฉ ุงูููุชุงุญ ุงููุญุฏุฏ:
  - ุญุณุงุจ RPM, TPM, RPD ููููุชุงุญ ุงููุฎุชุงุฑ ููุท
  - ุฅุฐุง ูุงู > 80%ุ ุงุฎุชูุงุฑ ููุชุงุญ ุขุฎุฑ
  - ุชูุฑุงุฑ ุญุชู ุฅูุฌุงุฏ ููุชุงุญ < 80%
- ุฅุถุงูุฉ `getKeyQuota(keyId, modelName)`

#### ุงูุชุฃุซูุฑ ุงููุชููุน:
- โ ุฏูุฉ 95%+ ูู ุงุฎุชูุงุฑ ุงูููุชุงุญ ุงูููุงุณุจ
- โ ุชูููู ุฃุฎุทุงุก 429 ุจูุณุจุฉ 60-70%
- โ ุชูุฒูุน ุฃูุถู ููุฃุญูุงู
- โ ุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู

#### ุงููุฎุงุทุฑ:
- โ๏ธ ุฒูุงุฏุฉ ููุช ุงุฎุชูุงุฑ ุงููููุฐุฌ (50-100ms)
- โ๏ธ ุงุณุชุนูุงูุงุช ูุงุนุฏุฉ ุจูุงูุงุช ุฅุถุงููุฉ
- โ๏ธ ูุฏ ูุคุฏู ุฅูู ุนุฏู ุงูุนุซูุฑ ุนูู ููุชุงุญ ูู ุญุงูุงุช ูุงุฏุฑุฉ

---

### **ุงูุชุญุณูู 4: ุชูุฑูุฑ totalTokenCount ูุชุญุฏูุซ TPM**

#### ุงููุดููุฉ ุงูุญุงููุฉ:
- `updateModelUsage()` ููุจู `totalTokenCount` ููู ูุง ูุชู ุชูุฑูุฑู
- ูู `responseGenerator.js`: `updateModelUsage(modelId)` ุจุฏูู tokens
- ุงููุชูุฌุฉ: TPM ุฏุงุฆูุงู = 0

#### ุงูุญู ุงูููุชุฑุญ:
- ูู `responseGenerator.js`:
  - ุญุณุงุจ `totalTokenCount` ูู `result.response.usageMetadata`
  - ุชูุฑูุฑ ุงููููุฉ ุฅูู `updateModelUsage(modelId, totalTokenCount)`
- ูู `modelManager.js`:
  - ุงุณุชุฎุฏุงู ุงููููุฉ ูุชุญุฏูุซ TPM
  - ูุญุต TPM ุนูุฏ ุงุฎุชูุงุฑ ุงููููุฐุฌ

#### ุงูุชุฃุซูุฑ ุงููุชููุน:
- โ ุชุชุจุน ุฏููู ูุงุณุชููุงู Tokens
- โ ููุน ุชุฌุงูุฒ TPM limit
- โ ุชุญุณูู ุชูุฒูุน ุงูุฃุญูุงู ุญุณุจ Tokens
- โ ุชูููู ุฃุฎุทุงุก 429 ุงููุชุนููุฉ ุจู TPM ุจูุณุจุฉ 90%

#### ุงููุฎุงุทุฑ:
- โ๏ธ ูุญุชุงุฌ ุฅูู ุชุนุฏูู ุฌููุน ุงุณุชุฏุนุงุกุงุช `updateModelUsage()`
- โ๏ธ ูุฏ ูุง ุชููู `usageMetadata` ูุชุงุญุฉ ุฏุงุฆูุงู

---

### **ุงูุชุญุณูู 5: Cache ูุฅุนุฏุงุฏุงุช ุงูุดุฑูุฉ (useCentralKeys)**

#### ุงููุดููุฉ ุงูุญุงููุฉ:
- `company.useCentralKeys` ูุชู ุงูุงุณุชุนูุงู ุนูู ูู ูู ูุฑุฉ
- ุงุณุชุนูุงู ูุชูุฑุฑ ูู `aggregateModelsByPriority()`
- ุถุบุท ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

#### ุงูุญู ุงูููุชุฑุญ:
- ุฅุถุงูุฉ `companySettingsCache` ูู Map
- ุงูููุชุงุญ: `companyId`
- ุงููููุฉ: `{ useCentralKeys, timestamp }`
- TTL: 60 ุซุงููุฉ
- Invalidation ุนูุฏ ุชุญุฏูุซ ุฅุนุฏุงุฏุงุช ุงูุดุฑูุฉ

#### ุงูุชุฃุซูุฑ ุงููุชููุน:
- โ ุชูููู ุงุณุชุนูุงูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูุณุจุฉ 40-50%
- โ ุชุญุณูู ุณุฑุนุฉ ุงุฎุชูุงุฑ ุงููููุฐุฌ (50-100ms ุฃุณุฑุน)
- โ ุชูููู ุงูุถุบุท ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุชุญุณูู ุงูุฃุฏุงุก ุงูุนุงู

#### ุงููุฎุงุทุฑ:
- โ๏ธ ุจูุงูุงุช ูุฏููุฉ ููุฏุฉ 60 ุซุงููุฉ
- โ๏ธ ุงุณุชููุงู ุฐุงูุฑุฉ ุฅุถุงูู (ูุญุฏูุฏ ุฌุฏุงู)

---

### **ุงูุชุญุณูู 6: ุชุญุณูู aggregateModelsByPriority (ุชูููู ุงูุงุณุชุนูุงูุงุช)**

#### ุงููุดููุฉ ุงูุญุงููุฉ:
- 3 ุงุณุชุนูุงูุงุช ูู ูู ูุฑุฉ:
  1. `company.findUnique()` ููุฅุนุฏุงุฏุงุช
  2. `geminiKeyModel.findMany()` ูููุงุฐุฌ ุงูุดุฑูุฉ
  3. `geminiKeyModel.findMany()` ููููุงุฐุฌ ุงููุฑูุฒูุฉ

#### ุงูุญู ุงูููุชุฑุญ:
- ุฏูุฌ ุงูุงุณุชุนูุงูุงุช ูู ุงุณุชุนูุงู ูุงุญุฏ ุจุงุณุชุฎุฏุงู `OR`:
  ```
  WHERE model = modelName AND isEnabled = true AND (
    (key.companyId = companyId AND key.keyType = 'COMPANY') OR
    (key.keyType = 'CENTRAL' AND key.companyId = null AND useCentralKeys = true)
  )
  ```
- ุงุณุชุฎุฏุงู `companySettingsCache` ููุฅุนุฏุงุฏุงุช
- ุชูููู ุนุฏุฏ ุงูุงุณุชุนูุงูุงุช ูู 3 ุฅูู 1

#### ุงูุชุฃุซูุฑ ุงููุชููุน:
- โ ุชูููู ุงุณุชุนูุงูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูุณุจุฉ 66%
- โ ุชุญุณูู ุณุฑุนุฉ ุงุฎุชูุงุฑ ุงููููุฐุฌ (100-200ms ุฃุณุฑุน)
- โ ุชูููู ุงูุถุบุท ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุดูู ูุจูุฑ
- โ ุชุญุณูู ุงูุฃุฏุงุก ูู ุญุงูุงุช ุงูุถุบุท ุงูุนุงูู

#### ุงููุฎุงุทุฑ:
- โ๏ธ ุงุณุชุนูุงู ุฃูุซุฑ ุชุนููุฏุงู
- โ๏ธ ูุฏ ูููู ุฃุจุทุฃ ูู ุญุงูุงุช ูุนููุฉ
- โ๏ธ ูุญุชุงุฌ ุฅูู ุงุฎุชุจุงุฑ ููุซู

---

### **ุงูุชุญุณูู 7: ุฅุถุงูุฉ Connection Pooling ูู GoogleGenerativeAI**

#### ุงููุดููุฉ ุงูุญุงููุฉ:
- ุฅูุดุงุก ุงุชุตุงู ุฌุฏูุฏ ููู request: `new GoogleGenerativeAI(apiKey)`
- ุงุณุชููุงู ููุงุฑุฏ ูุฅุจุทุงุก ุงูุงุณุชุฌุงุจุฉ

#### ุงูุญู ุงูููุชุฑุญ:
- ุฅุถุงูุฉ `connectionPool` ูู Map
- ุงูููุชุงุญ: `apiKey`
- ุงููููุฉ: `GoogleGenerativeAI instance`
- ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ุงูุงุชุตุงูุงุช ุงูููุฌูุฏุฉ
- ุชูุธูู ุงูุงุชุตุงูุงุช ุบูุฑ ุงููุณุชุฎุฏูุฉ ูู 10 ุฏูุงุฆู

#### ุงูุชุฃุซูุฑ ุงููุชููุน:
- โ ุชุญุณูู ุณุฑุนุฉ ุงูุงุณุชุฌุงุจุฉ (200-500ms ุฃุณุฑุน)
- โ ุชูููู ุงุณุชููุงู ุงูุฐุงูุฑุฉ
- โ ุชูููู ุงุณุชููุงู CPU
- โ ุชุญุณูู ุงูุฃุฏุงุก ูู ุญุงูุงุช ุงูุถุบุท ุงูุนุงูู

#### ุงููุฎุงุทุฑ:
- โ๏ธ ุงุณุชููุงู ุฐุงูุฑุฉ ุฅุถุงูู (ูุญุฏูุฏ)
- โ๏ธ ูุฏ ูุคุฏู ุฅูู ูุดุงูู ูู ุญุงูุฉ ุชุบููุฑ API keys
- โ๏ธ ูุญุชุงุฌ ุฅูู ุชูุธูู ุฏูุฑู

---

### **ุงูุชุญุณูู 8: ุฅุถุงูุฉ Retry Logic ูุญุณู (Exponential Backoff ุฐูู)**

#### ุงููุดููุฉ ุงูุญุงููุฉ:
- Retry delays ุซุงุจุชุฉ: `[1000, 2000]` ูุฌููุน ุฃููุงุน ุงูุฃุฎุทุงุก
- ูุง ููุฌุฏ ุชูููุฒ ุจูู 503 ู 429

#### ุงูุญู ุงูููุชุฑุญ:
- Retry delays ูุฎุชููุฉ ุญุณุจ ููุน ุงูุฎุทุฃ:
  - 503: `[2000, 5000]` (ุฃุจุทุฃ - ุงููููุฐุฌ ูุญูู)
  - 429: `[5000, 10000]` (ุฃุจุทุฃ ุฌุฏุงู - ุงูููุชุฉ ูุณุชููุฏุฉ)
  - Network errors: `[1000, 2000, 4000]` (3 ูุญุงููุงุช)
- ุฅุถุงูุฉ Jitter (ุชุดููุด ุนุดูุงุฆู) ูุชุฌูุจ Thundering Herd
- ุญุฏ ุฃูุตู ููุงูุชุธุงุฑ: 15 ุซุงููุฉ

#### ุงูุชุฃุซูุฑ ุงููุชููุน:
- โ ุฒูุงุฏุฉ ูุนุฏู ุงููุฌุงุญ ุจูุณุจุฉ 10-15%
- โ ุชูููู ุงูุถุบุท ุนูู Google API
- โ ุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู (ุฃุฎุทุงุก ุฃูู)
- โ ุชูุฒูุน ุฃูุถู ููุทูุจุงุช

#### ุงููุฎุงุทุฑ:
- โ๏ธ ุฒูุงุฏุฉ ููุช ุงูุงุณุชุฌุงุจุฉ ูู ุญุงูุงุช ุงููุดู (5-10 ุซูุงูู)
- โ๏ธ ูุฏ ูุคุฏู ุฅูู timeouts ูู ุญุงูุงุช ูุงุฏุฑุฉ

---

## ๐ง ุงููุฑุญูุฉ 3 - ุงูุชุญุณููุงุช ูุชูุณุทุฉ ุงูุฃููููุฉ (3-5 ุฃูุงู)

### **ุงูุชุญุณูู 1: ุฅุถุงูุฉ Health Checks ุฏูุฑูุฉ ููููุงุชูุญ**

#### ุงููุดููุฉ ุงูุญุงููุฉ:
- ูุง ููุฌุฏ ูุญุต ุฏูุฑู ูุตุญุฉ ุงูููุงุชูุญ
- ูุชู ุงูุชุดุงู ุงููุดุงูู ููุท ุนูุฏ ุงูุงุณุชุฎุฏุงู

#### ุงูุญู ุงูููุชุฑุญ:
- ุฅุถุงูุฉ Cron Job ูุนูู ูู 5 ุฏูุงุฆู
- ูุญุต ุฌููุน ุงูููุงุชูุญ ุงููุดุทุฉ:
  - ุฅุฑุณุงู ุทูุจ ุงุฎุชุจุงุฑ ุจุณูุท
  - ูุญุต ุงูุงุณุชุฌุงุจุฉ (200 OK)
  - ุชุญุฏูุซ ุญุงูุฉ ุงูููุชุงุญ
- ุชุนุทูู ุงูููุงุชูุญ ุงููุงุดูุฉ ุชููุงุฆูุงู
- ุฅุฑุณุงู ุชูุจูู ูููุณุคูููู

#### ุงูุชุฃุซูุฑ ุงููุชููุน:
- โ ุงูุชุดุงู ูุจูุฑ ูููุดุงูู (ูุจู ุงุณุชุฎุฏุงู ุงูููุชุงุญ)
- โ ุชูููู ุญุงูุงุช ุงููุดู ุจูุณุจุฉ 30-40%
- โ ุชุญุณูู ููุซูููุฉ ุงููุธุงู
- โ ุชูุจููุงุช ุงุณุชุจุงููุฉ ูููุณุคูููู

#### ุงููุฎุงุทุฑ:
- โ๏ธ ุงุณุชููุงู API calls ุฅุถุงููุฉ (ูุญุฏูุฏ - ูุฑุฉ ูู 5 ุฏูุงุฆู)
- โ๏ธ ูุฏ ูุคุฏู ุฅูู ุชุนุทูู ููุงุชูุญ ุตุญูุญุฉ ูู ุญุงูุงุช ูุงุฏุฑุฉ

---

### **ุงูุชุญุณูู 2: ุฅุถุงูุฉ ูุธุงู ุฃููููุงุช ุฏููุงูููู**

#### ุงููุดููุฉ ุงูุญุงููุฉ:
- ุงูุฃููููุงุช ุซุงุจุชุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ูุง ุชุชุบูุฑ ุญุณุจ ุงูุฃุฏุงุก (ูุฌุงุญ/ูุดู)

#### ุงูุญู ุงูููุชุฑุญ:
- ุชุชุจุน ูุนุฏู ุงููุฌุงุญ ููู ููุชุงุญ:
  - ุนุฏุฏ ุงูุทูุจุงุช ุงููุงุฌุญุฉ
  - ุนุฏุฏ ุงูุทูุจุงุช ุงููุงุดูุฉ
  - ูุนุฏู ุงููุฌุงุญ = ูุงุฌุญุฉ / ุฅุฌูุงูู
- ุชุนุฏูู ุงูุฃููููุฉ ุชููุงุฆูุงู:
  - ูุนุฏู ูุฌุงุญ > 95% โ ุฒูุงุฏุฉ ุงูุฃููููุฉ
  - ูุนุฏู ูุฌุงุญ < 80% โ ุชูููู ุงูุฃููููุฉ
- ุฅุนุงุฏุฉ ุญุณุงุจ ูู ุณุงุนุฉ

#### ุงูุชุฃุซูุฑ ุงููุชููุน:
- โ ุชุญุณูู ูุนุฏู ุงููุฌุงุญ ุงูุฅุฌูุงูู ุจูุณุจุฉ 5-10%
- โ ุงุณุชุฎุฏุงู ุฃูุถู ููููุงุชูุญ ุนุงููุฉ ุงูุฌูุฏุฉ
- โ ุชูููู ุงุณุชุฎุฏุงู ุงูููุงุชูุญ ุงููุดููุฉ
- โ ุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู

#### ุงููุฎุงุทุฑ:
- โ๏ธ ุชุนููุฏ ุฃูุจุฑ ูู ุงููุธุงู
- โ๏ธ ูุฏ ูุคุฏู ุฅูู ุชุฌุงูู ููุงุชูุญ ุฌูุฏุฉ ูู ุญุงูุงุช ูุงุฏุฑุฉ
- โ๏ธ ูุญุชุงุฌ ุฅูู ุชุชุจุน ุฏููู ููุฅุญุตุงุฆูุงุช

---

### **ุงูุชุญุณูู 3: ุฅุถุงูุฉ Parallel Processing ูุญุณุงุจ ุงูููุชุฉ**

#### ุงููุดููุฉ ุงูุญุงููุฉ:
- ุญุณุงุจ ุงูููุชุฉ ูุชู ุชุณูุณููุงู ููู ูููุฐุฌ
- ุจุทุก ูู ุญุงูุฉ ูุฌูุฏ ููุงุฐุฌ ูุชุนุฏุฏุฉ

#### ุงูุญู ุงูููุชุฑุญ:
- ูุนุงูุฌุฉ ุฃูู 3 ููุงุฐุฌ ุจุงูุชูุงุฒู ุจุงุณุชุฎุฏุงู `Promise.all()`
- ุฅุฐุง ูุฌุญ ุฃุญุฏููุ ุงุณุชุฎุฏุงูู ููุฑุงู
- ุฅุฐุง ูุดููุง ุฌููุนุงูุ ูุนุงูุฌุฉ ุงูู 3 ุงูุชุงููุฉ
- ุญุฏ ุฃูุตู: 3 ููุงุฐุฌ ูู ููุณ ุงูููุช

#### ุงูุชุฃุซูุฑ ุงููุชููุน:
- โ ุชุญุณูู ุณุฑุนุฉ ุงุฎุชูุงุฑ ุงููููุฐุฌ ุจูุณุจุฉ 50-70%
- โ ุชูููู ููุช ุงูุงุณุชุฌุงุจุฉ (500-1000ms ุฃุณุฑุน)
- โ ุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู
- โ ุงุณุชุบูุงู ุฃูุถู ููููุงุฑุฏ

#### ุงููุฎุงุทุฑ:
- โ๏ธ ุฒูุงุฏุฉ ุงูุถุบุท ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ๏ธ ูุฏ ูุคุฏู ุฅูู ูุดุงูู ูู ุญุงูุงุช ุงูุถุบุท ุงูุนุงูู
- โ๏ธ ูุญุชุงุฌ ุฅูู ุฅุฏุงุฑุฉ ุฏูููุฉ ููู Promises

---

### **ุงูุชุญุณูู 4: ุฅุถุงูุฉ ูุธุงู Monitoring ููุชุงุจุนุฉ ุงูุฃุฏุงุก**

#### ุงููุดููุฉ ุงูุญุงููุฉ:
- ูุง ุชูุฌุฏ ุฅุญุตุงุฆูุงุช ููุตูุฉ ุนู ุฃุฏุงุก ุงููุธุงู
- ุตุนูุจุฉ ุชุญุฏูุฏ ุงููุดุงูู ูุงูุงุฎุชูุงูุงุช

#### ุงูุญู ุงูููุชุฑุญ:
- ุชุชุจุน Metrics ููุตูุฉ:
  - ุนุฏุฏ ุงูุทูุจุงุช ููู ููุชุงุญ
  - ูุนุฏู ุงููุฌุงุญ/ุงููุดู
  - ูุชูุณุท ููุช ุงูุงุณุชุฌุงุจุฉ
  - ุงุณุชููุงู ุงูููุชุฉ
  - ุนุฏุฏ ุญุงูุงุช ุงูุชุจุฏูู
- Dashboard ูููุฑุงูุจุฉ
- ุชูุจููุงุช ุชููุงุฆูุฉ ุนูุฏ ุงููุดุงูู

#### ุงูุชุฃุซูุฑ ุงููุชููุน:
- โ ุฑุคูุฉ ูุงุถุญุฉ ูุฃุฏุงุก ุงููุธุงู
- โ ุงูุชุดุงู ุณุฑูุน ูููุดุงูู
- โ ุงุชุฎุงุฐ ูุฑุงุฑุงุช ูุจููุฉ ุนูู ุจูุงูุงุช
- โ ุชุญุณูู ูุณุชูุฑ ูููุธุงู

#### ุงููุฎุงุทุฑ:
- โ๏ธ ุงุณุชููุงู ููุงุฑุฏ ุฅุถุงููุฉ
- โ๏ธ ุชุนููุฏ ุฃูุจุฑ ูู ุงููุธุงู
- โ๏ธ ูุญุชุงุฌ ุฅูู ุตูุงูุฉ ูุณุชูุฑุฉ

---

### **ุงูุชุญุณูู 5: ุฅุถุงูุฉ ูุธุงู ููุชุญูู ูู ุงูููุชุฉ ุงููุนููุฉ ูู Google**

#### ุงููุดููุฉ ุงูุญุงููุฉ:
- ูุง ุชูุฌุฏ ุขููุฉ ููููุงุฑูุฉ ูุน ุงูููุชุฉ ุงููุนููุฉ ูู Google API
- ูุฏ ูุญุฏุซ ุงูุญุฑุงู ุชุฏุฑูุฌู

#### ุงูุญู ุงูููุชุฑุญ:
- ุงุณุชุฏุนุงุก Google API ููุญุตูู ุนูู ุงูููุชุฉ ุงููุนููุฉ (ุฅุฐุง ูุชุงุญ)
- ููุงุฑูุฉ ูุน ุงูููุชุฉ ุงููุญุณูุจุฉ ูุญููุงู
- ุชุตุญูุญ ุงูุงุฎุชูุงูุงุช ุชููุงุฆูุงู
- ุชุดุบูู ูุฑุฉ ูู ุณุงุนุฉ

#### ุงูุชุฃุซูุฑ ุงููุชููุน:
- โ ุฏูุฉ 100% ูู ุชุชุจุน ุงูููุชุฉ
- โ ููุน ุงูุงูุญุฑุงู ุงูุชุฏุฑูุฌู
- โ ุงูุชุดุงู ูุดุงูู ูู ุงูุญุณุงุจ
- โ ุชุญุณูู ููุซูููุฉ ุงููุธุงู

#### ุงููุฎุงุทุฑ:
- โ๏ธ ูุฏ ูุง ูููู API ูุชุงุญุงู
- โ๏ธ ุงุณุชููุงู API calls ุฅุถุงููุฉ
- โ๏ธ ูุฏ ูุคุฏู ุฅูู ุชุตุญูุญุงุช ุฎุงุทุฆุฉ ูู ุญุงูุงุช ูุงุฏุฑุฉ

---

### **ุงูุชุญุณูู 6: ุฅุถุงูุฉ Circuit Breaker Pattern**

#### ุงููุดููุฉ ุงูุญุงููุฉ:
- ูุง ููุฌุฏ ูุธุงู ูููุน ุงููุญุงููุงุช ุงููุชูุฑุฑุฉ ููููุงุฐุฌ ุงููุงุดูุฉ
- ูุฏุฑ ููุช ูููุงุฑุฏ

#### ุงูุญู ุงูููุชุฑุญ:
- ุชุทุจูู Circuit Breaker Pattern:
  - **Closed**: ุงููููุฐุฌ ูุนูู ุจุดูู ุทุจูุนู
  - **Open**: ุงููููุฐุฌ ูุดู 3 ูุฑุงุช ูุชุชุงููุฉ โ ุชููู ุงููุญุงููุงุช ููุฏุฉ 5 ุฏูุงุฆู
  - **Half-Open**: ุจุนุฏ 5 ุฏูุงุฆู โ ูุญุงููุฉ ูุงุญุฏุฉ ููุงุฎุชุจุงุฑ
- ุชุชุจุน ุญุงูุฉ ูู ูููุฐุฌ
- ุฅุนุงุฏุฉ ุชุนููู ุชููุงุฆูุฉ ุจุนุฏ ุงููุฌุงุญ

#### ุงูุชุฃุซูุฑ ุงููุชููุน:
- โ ุชูููู ุงููุญุงููุงุช ุงููุงุดูุฉ ุจูุณุจุฉ 80-90%
- โ ุชูููุฑ ููุช ูุงุณุชุฌุงุจุฉ ุฃุณุฑุน
- โ ุชูููู ุงูุถุบุท ุนูู Google API
- โ ุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู

#### ุงููุฎุงุทุฑ:
- โ๏ธ ูุฏ ูุคุฏู ุฅูู ุชุฌุงูู ููุงุฐุฌ ูุชุงุญุฉ ูู ุญุงูุงุช ูุงุฏุฑุฉ
- โ๏ธ ุชุนููุฏ ุฃูุจุฑ ูู ุงููุธุงู
- โ๏ธ ูุญุชุงุฌ ุฅูู ุถุจุท ุฏููู ูููุนุงููุงุช

---

### **ุงูุชุญุณูู 7: ุชุญุณูู ุฅุฏุงุฑุฉ ุงูุฐุงูุฑุฉ (Memory Management)**

#### ุงููุดููุฉ ุงูุญุงููุฉ:
- `errorStats` ูุฏ ูุชุฑุงูู ุจุฏูู ุญุฏ
- `exhaustedModelsCache` ู `excludedModels` ูุฏ ููุจุฑุงู

#### ุงูุญู ุงูููุชุฑุญ:
- ุฅุถุงูุฉ ุญุฏ ุฃูุตู ูุญุฌู `errorStats`: 1000 ุฎุทุฃ
- ุชูุธูู ุชููุงุฆู ููุฃุฎุทุงุก ุงููุฏููุฉ (> 24 ุณุงุนุฉ)
- ุชูุธูู `excludedModels` ุงููุฏููุฉ (> 7 ุฃูุงู)
- ุฅุถุงูุฉ `maxSize` ูุฌููุน ุงูู Caches
- Monitoring ูุงุณุชููุงู ุงูุฐุงูุฑุฉ

#### ุงูุชุฃุซูุฑ ุงููุชููุน:
- โ ููุน ุชุณุฑุจ ุงูุฐุงูุฑุฉ (Memory Leaks)
- โ ุงุณุชูุฑุงุฑ ุงููุธุงู ุนูู ุงููุฏู ุงูุทููู
- โ ุชุญุณูู ุงูุฃุฏุงุก
- โ ุชูููู ุงุณุชููุงู ุงูููุงุฑุฏ

#### ุงููุฎุงุทุฑ:
- โ๏ธ ูุฏ ูุคุฏู ุฅูู ููุฏุงู ุจูุงูุงุช ูููุฉ
- โ๏ธ ูุญุชุงุฌ ุฅูู ุถุจุท ุฏููู ููุญุฏูุฏ

---

## ๐ ููุฎุต ุงูุชุฃุซูุฑ ุงููุชููุน ูุฌููุน ุงูุฅุตูุงุญุงุช

### **ุชุญุณููุงุช ุงูุฃุฏุงุก:**
- โก ุชูููู ููุช ุงูุงุณุชุฌุงุจุฉ: **30-50%**
- โก ุชูููู ุงุณุชุนูุงูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช: **50-60%**
- โก ุชุญุณูู ุณุฑุนุฉ ุงุฎุชูุงุฑ ุงููููุฐุฌ: **40-60%**

### **ุชุญุณููุงุช ุงูููุซูููุฉ:**
- โ ุฒูุงุฏุฉ ูุนุฏู ุงููุฌุงุญ: ูู **85%** ุฅูู **95-98%**
- โ ุชูููู ุฃุฎุทุงุก 429: **70-80%**
- โ ุชูููู ุฃุฎุทุงุก 503: **50-60%**
- โ ุชูููู ุญุงูุงุช "ูุง ููุฌุฏ ูููุฐุฌ ูุชุงุญ": **80%**

### **ุชุญุณููุงุช ุงูููุงุกุฉ:**
- ๐ฐ ุชูููุฑ API calls ุบูุฑ ุถุฑูุฑูุฉ: **30-40%**
- ๐ฐ ุงุณุชุบูุงู ุฃูุถู ููููุงุชูุญ ุงููุชุงุญุฉ: **50-70%**
- ๐ฐ ุชูุฒูุน ูุชุณุงูู ููุฃุญูุงู: **80-90%**

### **ุชุญุณููุงุช ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู:**
- ๐ ุฑุฏูุฏ ุฃุณุฑุน: **2-3 ุซูุงูู ุฃุณุฑุน**
- ๐ ุฃุฎุทุงุก ุฃูู: **60-70%**
- ๐ ุงุณุชูุฑุงุฑ ุฃูุถู: **90%+**

---

## โ๏ธ ุงููุฎุงุทุฑ ุงูุนุงูุฉ ูุงูุงุญุชูุงุทุงุช

### **ุงููุฎุงุทุฑ ุงูุชูููุฉ:**
1. **ุชุนููุฏ ุงูููุฏ**: ุฒูุงุฏุฉ ุจูุณุจุฉ 30-40%
2. **ุงุณุชููุงู ุงูุฐุงูุฑุฉ**: ุฒูุงุฏุฉ ุจูุณุจุฉ 10-15%
3. **ุงุณุชุนูุงูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช**: ูุฏ ุชุฒูุฏ ูู ุจุนุถ ุงูุญุงูุงุช

### **ุงูุงุญุชูุงุทุงุช ุงููุทููุจุฉ:**
1. **ุงุฎุชุจุงุฑ ููุซู**: Unit tests + Integration tests
2. **Rollback Plan**: ุฎุทุฉ ููุนูุฏุฉ ูููุธุงู ุงููุฏูู
3. **Monitoring**: ูุฑุงูุจุฉ ูุณุชูุฑุฉ ุจุนุฏ ุงูุชุทุจูู
4. **Gradual Rollout**: ุชุทุจูู ุชุฏุฑูุฌู (10% โ 50% โ 100%)
5. **Documentation**: ุชูุซูู ุดุงูู ููุชุบููุฑุงุช

---

## ๐ฏ ุงูุฌุฏูู ุงูุฒููู ุงูููุชุฑุญ

### **ุงูุฃุณุจูุน 1:**
- โ ุงููุฑุญูุฉ 1: ุงูุฅุตูุงุญุงุช ุงูุญุฑุฌุฉ (7 ุฅุตูุงุญุงุช)
- โ ุงุฎุชุจุงุฑ ูุจุฏุฆู

### **ุงูุฃุณุจูุน 2:**
- โ ุงููุฑุญูุฉ 2: ุงูุชุญุณููุงุช ุนุงููุฉ ุงูุฃููููุฉ (8 ุชุญุณููุงุช)
- โ ุงุฎุชุจุงุฑ ุดุงูู

### **ุงูุฃุณุจูุน 3:**
- โ ุงููุฑุญูุฉ 3: ุงูุชุญุณููุงุช ูุชูุณุทุฉ ุงูุฃููููุฉ (7 ุชุญุณููุงุช)
- โ ุงุฎุชุจุงุฑ ููุงุฆู

### **ุงูุฃุณุจูุน 4:**
- โ Gradual Rollout
- โ Monitoring ููุชุงุจุนุฉ
- โ ุฅุตูุงุญ ุฃู ูุดุงูู ุทุงุฑุฆุฉ

---

## ๐ ูุคุดุฑุงุช ุงููุฌุงุญ (KPIs)

### **ูุจู ุงูุฅุตูุงุญุงุช:**
- ูุนุฏู ุงููุฌุงุญ: **85%**
- ูุชูุณุท ููุช ุงูุงุณุชุฌุงุจุฉ: **5-8 ุซูุงูู**
- ุฃุฎุทุงุก 429: **15-20%**
- ุงุณุชุนูุงูุงุช DB: **100 ุงุณุชุนูุงู/ุฏูููุฉ**

### **ุจุนุฏ ุงูุฅุตูุงุญุงุช (ุงููุชููุน):**
- ูุนุฏู ุงููุฌุงุญ: **95-98%** โ
- ูุชูุณุท ููุช ุงูุงุณุชุฌุงุจุฉ: **3-5 ุซูุงูู** โ
- ุฃุฎุทุงุก 429: **3-5%** โ
- ุงุณุชุนูุงูุงุช DB: **40-50 ุงุณุชุนูุงู/ุฏูููุฉ** โ

---

## โ ุงูุฎูุงุตุฉ

ูุฐู ุงูุฎุทุฉ ุชุบุทู **22 ูุดููุฉ** ููุณูุฉ ุนูู **3 ูุฑุงุญู**:
- ๐ฅ **7 ุฅุตูุงุญุงุช ุญุฑุฌุฉ** (ููุฑูุฉ)
- โก **8 ุชุญุณููุงุช ุนุงููุฉ ุงูุฃููููุฉ** (1-2 ููู)
- ๐ง **7 ุชุญุณููุงุช ูุชูุณุทุฉ ุงูุฃููููุฉ** (3-5 ุฃูุงู)

**ุงูุชุฃุซูุฑ ุงูุฅุฌูุงูู ุงููุชููุน:**
- โ ุชุญุณูู ูุนุฏู ุงููุฌุงุญ ูู **85%** ุฅูู **95-98%**
- โ ุชุญุณูู ุงูุฃุฏุงุก ุจูุณุจุฉ **30-50%**
- โ ุชูููู ุงูุฃุฎุทุงุก ุจูุณุจุฉ **60-80%**
- โ ุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู ุจุดูู ูุจูุฑ

**ุงูุฌุฏูู ุงูุฒููู:** 3-4 ุฃุณุงุจูุน ููุชุทุจูู ุงููุงูู

**ุงูุฃููููุฉ:** ุงูุจุฏุก ุจุงููุฑุญูุฉ 1 (ุงูุฅุตูุงุญุงุช ุงูุญุฑุฌุฉ) ููุฑุงู โ

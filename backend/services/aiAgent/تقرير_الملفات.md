# ๐ ุชูุฑูุฑ ุดุงูู ุนู ูููุงุช ูุฌูุฏ aiAgent

## ๐ ููุฎุต ุงูุชูููุฐ

**ุงููุถุน ุงูุญุงูู:** โ ุฌููุน ุงููููุงุช **ูุณุชุฎุฏูุฉ ูุนููุงู** ูู `aiAgentService.js` ุจุงุณุชุฎุฏุงู **Lazy Initialization Pattern**

**ุงูุญุงูุฉ:** ุฌููุน ุงููููุงุช ูููุฏุฉ ูุชุนูู ุจูุฌุงุญ

---

## ๐ ุงููููุงุช ุงูููุฌูุฏุฉ ูู ุงููุฌูุฏ

### 1. ๐ `messageProcessor.js`
**ุงูุงุณุชุฎุฏุงู:**
- ูุนุงูุฌุฉ ุฑุณุงุฆู ุงูุนููุงุก ุงูุฑุฆูุณูุฉ
- ุฅูุดุงุก ุฑุฏูุฏ AI
- ูุนุงูุฌุฉ ุงูุตูุฑ
- ุญูุธ ุงูุชูุงุนูุงุช ูู ุงูุฐุงูุฑุฉ

**ุงูุญุงูุฉ:** โ **ูููุฏ ุฌุฏุงู ููุณุชุฎุฏู**
- ูุชู ุงุณุชุฎุฏุงูู ุนุจุฑ `getMessageProcessor()` ูู `aiAgentService.js`
- ูุญุชูู ุนูู ุฏุงูุฉ `processCustomerMessage()` ุงูุฑุฆูุณูุฉ ุงูุชู ุชุนุงูุฌ ูู ุงูุฑุณุงุฆู

**ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ:**
- `processCustomerMessage()` - ุงูุฏุงูุฉ ุงูุฑุฆูุณูุฉ ููุนุงูุฌุฉ ุงูุฑุณุงุฆู
- `processImageWithAI()` - ูุนุงูุฌุฉ ุงูุตูุฑ ูุน AI
- `processWithAI()` - ูุนุงูุฌุฉ ูุตูุฉ ูุน AI
- `saveImageResponseToMemory()` - ุญูุธ ุฑุฏูุฏ ุงูุตูุฑ ูู ุงูุฐุงูุฑุฉ

---

### 2. ๐ง `contextManager.js`
**ุงูุงุณุชุฎุฏุงู:**
- ุฅุฏุงุฑุฉ ูุชุญููู ุณูุงู ุงููุญุงุฏุซุฉ
- ุชุญููู ุงูููุงูุง (intent) ูุน ุณูุงู ูุญุณู
- ุชุญููู ุญุงูุฉ ุงููุญุงุฏุซุฉ
- ุชุญููู ุณููู ุงูุนููู

**ุงูุญุงูุฉ:** โ **ูููุฏ ุฌุฏุงู ููุณุชุฎุฏู**
- ูุชู ุงุณุชุฎุฏุงูู ุนุจุฑ `getContextManager()` ูู `aiAgentService.js`
- ูุญุชูู ุนูู ููุทู ูุนูุฏ ูุชุญููู ุงูุณูุงู ูุงูุฐูุงุก ุงูุงุตุทูุงุนู

**ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ:**
- `analyzeEnhancedConversationContext()` - ุชุญููู ุงูุณูุงู ุงููุชูุฏู
- `buildEnhancedConversationContext()` - ุจูุงุก ุงูุณูุงู
- `analyzeConversationState()` - ุชุญููู ุญุงูุฉ ุงููุญุงุฏุซุฉ
- `analyzeIntentWithEnhancedContext()` - ุชุญููู ุงูููุงูุง ูุน ุณูุงู ูุญุณู
- `enhanceResponseWithConversationState()` - ุชุญุณูู ุงูุฑุฏ ุจูุงุกู ุนูู ุญุงูุฉ ุงููุญุงุฏุซุฉ

---

### 3. ๐ค `responseGenerator.js`
**ุงูุงุณุชุฎุฏุงู:**
- ุชูููุฏ ุฑุฏูุฏ AI
- ุจูุงุก ุงูู prompts ุงููุชูุฏูุฉ
- ุจูุงุก ุฅุนุฏุงุฏุงุช ุงูุชูููุฏ ุงูุฏููุงููููุฉ
- ูุนุงูุฌุฉ ุฃุฎุทุงุก AI

**ุงูุญุงูุฉ:** โ **ูููุฏ ุฌุฏุงู ููุณุชุฎุฏู**
- ูุชู ุงุณุชุฎุฏุงูู ุนุจุฑ `getResponseGenerator()` ูู `aiAgentService.js`
- ูุญุชูู ุนูู ููุทู ูุนูุฏ ูุชูููุฏ ุงูุฑุฏูุฏ ูุงูู prompts

**ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ:**
- `buildPrompt()` - ุจูุงุก ุงูู prompt ุงูุฃุณุงุณู
- `buildAdvancedPrompt()` - ุจูุงุก ุงูู prompt ุงููุชูุฏู
- `generateAIResponse()` - ุชูููุฏ ุฑุฏ AI ุจุงุณุชุฎุฏุงู Gemini
- `buildGenerationConfig()` - ุจูุงุก ุฅุนุฏุงุฏุงุช ุงูุชูููุฏ
- `buildOrderConfirmationPrompt()` - ุจูุงุก prompt ูุชุฃููุฏ ุงูุทูุจ

---

### 4. ๐ `orderProcessor.js`
**ุงูุงุณุชุฎุฏุงู:**
- ูุนุงูุฌุฉ ุงูุทูุจุงุช
- ูุดู ุชุฃููุฏ ุงูุทูุจ
- ุงุณุชุฎุฑุงุฌ ุจูุงูุงุช ุงูุนููู
- ุงูุชุญูู ูู ุงูุชูุงู ุงูุจูุงูุงุช

**ุงูุญุงูุฉ:** โ **ูููุฏ ุฌุฏุงู ููุณุชุฎุฏู**
- ูุชู ุงุณุชุฎุฏุงูู ุนุจุฑ `getOrderProcessor()` ูู `aiAgentService.js`
- ูุญุชูู ุนูู ููุทู ูุนูุฏ ููุนุงูุฌุฉ ุงูุทูุจุงุช

**ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ:**
- `detectOrderConfirmation()` - ูุดู ุชุฃููุฏ ุงูุทูุจ
- `extractOrderDetailsFromMemory()` - ุงุณุชุฎุฑุงุฌ ุชูุงุตูู ุงูุทูุจ ูู ุงูุฐุงูุฑุฉ
- `checkDataCompleteness()` - ูุญุต ุงูุชูุงู ุงูุจูุงูุงุช
- `generateDataRequestResponse()` - ุฅูุดุงุก ุฑุฏ ูุทูุจ ุงูุจูุงูุงุช ุงูููููุฏุฉ
- `extractCustomerDataFromMessage()` - ุงุณุชุฎุฑุงุฌ ุจูุงูุงุช ุงูุนููู ูู ุงูุฑุณุงูุฉ
- `attemptOrderCreationWithNewData()` - ูุญุงููุฉ ุฅูุดุงุก ุงูุทูุจ ุจุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ

---

### 5. ๐ผ๏ธ `imageProcessor.js`
**ุงูุงุณุชุฎุฏุงู:**
- ูุนุงูุฌุฉ ุงูุตูุฑ
- ูุดู ุทูุจ ุงูุตูุฑ
- ุฌูุจ ุงูุตูุฑ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ููุชุฑุฉ ุงูุตูุฑ ุญุณุจ ุงูููู
- ุงุณุชุฎุฑุงุฌ ุงูุตูุฑ ูู RAG data (โ ุชู ุฏูุฌ `imageExtractor.js`)

**ุงูุญุงูุฉ:** โ **ูููุฏ ุฌุฏุงู ููุณุชุฎุฏู**
- ูุชู ุงุณุชุฎุฏุงูู ุนุจุฑ `getImageProcessor()` ูู `aiAgentService.js`
- ูุญุชูู ุนูู ููุทู ูุนูุฏ ููุนุงูุฌุฉ ุงูุตูุฑ ูุงูุจุญุซ ุงูุฐูู
- โ ุชู ุฏูุฌ `imageExtractor.js` ููู

**ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ:**
- `isCustomerRequestingImages()` - ูุดู ุฅุฐุง ูุงู ุงูุนููู ูุทูุจ ุตูุฑ
- `getSmartResponse()` - ุฏุงูุฉ ููุญุฏุฉ ุฐููุฉ ููุญุตูู ุนูู ุงูุฑุฏ ูุงูุตูุฑ
- `filterImagesByColor()` - ููุชุฑุฉ ุงูุตูุฑ ุญุณุจ ุงูููู
- `getProductImagesFromDB()` - ุฌูุจ ุตูุฑ ุงูููุชุฌ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- `searchImagesByColorInDatabase()` - ุงูุจุญุซ ุนู ุตูุฑ ุจููู ูุญุฏุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- `extractImagesFromRAGData()` - ุงุณุชุฎุฑุงุฌ ุงูุตูุฑ ูู RAG data ุจุฐูุงุก (โ ุฌุฏูุฏ)

---

### 6. โ๏ธ `settingsManager.js`
**ุงูุงุณุชุฎุฏุงู:**
- ุฅุฏุงุฑุฉ ุฅุนุฏุงุฏุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู
- ุฌูุจ prompts ุงูุดุฑูุฉ
- ุชุญุฏูุซ ุงูุฅุนุฏุงุฏุงุช

**ุงูุญุงูุฉ:** โ **ูููุฏ ุฌุฏุงู ููุณุชุฎุฏู**
- ูุชู ุงุณุชุฎุฏุงูู ุนุจุฑ `getSettingsManager()` ูู `aiAgentService.js`
- ูุญุชูู ุนูู ููุทู ุฌูุจ ุงูุฅุนุฏุงุฏุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

**ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ:**
- `getCompanyPrompts()` - ุฌูุจ prompts ุงูุดุฑูุฉ
- `getSettings()` - ุฌูุจ ุฅุนุฏุงุฏุงุช AI
- `updateSettings()` - ุชุญุฏูุซ ุงูุฅุนุฏุงุฏุงุช
- `reloadSystemPrompt()` - ุฅุนุงุฏุฉ ุชุญููู system prompt

---

### 7. ๐ `modelManager.js`
**ุงูุงุณุชุฎุฏุงู:**
- ุฅุฏุงุฑุฉ ููุงุฐุฌ Gemini
- ุงูุจุญุซ ุนู ููุงุฐุฌ ูุชุงุญุฉ
- ุงูุชุจุฏูู ุจูู ุงูููุงุฐุฌ
- ุชุญุฏูุซ ุญุงูุฉ ุงูููุงุฐุฌ

**ุงูุญุงูุฉ:** โ **ูููุฏ ุฌุฏุงู ููุณุชุฎุฏู**
- ูุชู ุงุณุชุฎุฏุงูู ุนุจุฑ `getModelManager()` ูู `aiAgentService.js`
- ูุญุชูู ุนูู ููุทู ูุนูุฏ ูุฅุฏุงุฑุฉ ุงูููุงุฐุฌ ูุงูุชุจุฏูู ุจูููุง

**ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ:**
- `getActiveGeminiKey()` - ุงูุญุตูู ุนูู ุงูููุชุงุญ ุงููุดุท
- `getActiveGeminiKeyWithModel()` - ุงูุญุตูู ุนูู ุงูููุชุงุญ ูุงููููุฐุฌ ุงููุดุท
- `findNextAvailableModel()` - ุงูุจุญุซ ุนู ูููุฐุฌ ุงุญุชูุงุทู
- `markModelAsExhausted()` - ุชุญุฏูุฏ ูููุฐุฌ ููุณุชููุฏ
- `updateModelUsage()` - ุชุญุฏูุซ ุนุฏุงุฏ ุงูุงุณุชุฎุฏุงู
- `activateKey()` - ุชูุนูู ููุชุงุญ

---

### 8. ๐ `learningMonitor.js`
**ุงูุงุณุชุฎุฏุงู:**
- ุฌูุน ุจูุงูุงุช ุงูุชุนูู
- ูุฑุงูุจุฉ ุฃุฏุงุก ุงูุชุญุณููุงุช
- ุชุญุฏูุซ ุจูุงูุงุช ุงูุชุนูู ูุน ุงูุชุบุฐูุฉ ุงูุฑุงุฌุนุฉ

**ุงูุญุงูุฉ:** โ **ูููุฏ ููุณุชุฎุฏู**
- ูุชู ุงุณุชุฎุฏุงูู ุนุจุฑ `getLearningMonitor()` ูู `aiAgentService.js`
- ูุญุชูู ุนูู ููุทู ุฌูุน ุจูุงูุงุช ุงูุชุนูู ูุงููุฑุงูุจุฉ

**ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ:**
- `collectLearningData()` - ุฌูุน ุจูุงูุงุช ุงูุชุนูู
- `determineOutcome()` - ุชุญุฏูุฏ ูุชูุฌุฉ ุงูุชูุงุนู
- `updateLearningDataWithFeedback()` - ุชุญุฏูุซ ุจูุงูุงุช ุงูุชุนูู ูุน ุงูุชุบุฐูุฉ ุงูุฑุงุฌุนุฉ
- `monitorImprovementPerformance()` - ูุฑุงูุจุฉ ุฃุฏุงุก ุงูุชุญุณููุงุช
- `calculateImprovement()` - ุญุณุงุจ ุงูุชุญุณู ูู ุงููุคุดุฑุงุช

---

### 9. ๐ฏ `intentAnalyzer.js`
**ุงูุงุณุชุฎุฏุงู:**
- ุชุญููู ุงูููุงูุง (intent) ูู ุงูุฑุณุงุฆู
- ุชุญููู ุงูููุงูุง ูุน ุณูุงู ูุญุณู

**ุงูุญุงูุฉ:** โ **ูููุฏ ููุณุชุฎุฏู**
- ูุชู ุงุณุชุฎุฏุงูู ูุจุงุดุฑุฉ ูู `aiAgentService.js` (ุณุทุฑ 11 ู 288)
- ูุญุชูู ุนูู ููุทู ุชุญููู ุงูููุงูุง ุจุงุณุชุฎุฏุงู AI

**ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ:**
- `analyzeIntent()` - ุชุญููู ุงูู intent ุงูุฃุณุงุณู
- `analyzeIntentWithEnhancedContext()` - ุชุญููู ุงูู intent ูุน ุณูุงู ูุญุณู
- `checkGreetingIntent()` - ูุญุต ุฃููู ููุชุญูุงุช
- `checkPriorityKeywords()` - ูุญุต ุฃููู ูููููุงุช ุงูููุชุงุญูุฉ

---

### 10. ๐ฆ `productExtractor.js`
**ุงูุงุณุชุฎุฏุงู:**
- ุงุณุชุฎุฑุงุฌ ุฃุณูุงุก ุงูููุชุฌุงุช ูู ุงูุฑุณุงุฆู
- ุงุณุชุฎุฑุงุฌ ุงูููุชุฌุงุช ูู ุงูุฐุงูุฑุฉ
- ุงุณุชุฎุฑุงุฌ ุงูููุชุฌุงุช ูู RAG data

**ุงูุญุงูุฉ:** โ **ูููุฏ ููุณุชุฎุฏู**
- ูุชู ุงุณุชุฎุฏุงูู ูุจุงุดุฑุฉ ูู `aiAgentService.js` (ุณุทุฑ 10)
- ูุชู ุงุณุชุฎุฏุงูู ูู `responseGenerator.js` (ุณุทุฑ 9)

**ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ:**
- `extractFromCurrentMessage()` - ุงุณุชุฎุฑุงุฌ ูู ุงูุฑุณุงูุฉ ุงูุญุงููุฉ
- `extractFromMemory()` - ุงุณุชุฎุฑุงุฌ ูู ุงูุฐุงูุฑุฉ
- `extractFromRAGData()` - ุงุณุชุฎุฑุงุฌ ูู RAG data
- `extractProduct()` - ุงุณุชุฎุฑุงุฌ ุงูููุชุฌ ุจุงูุชุฑุชูุจ

---

### 11. โ `imageExtractor.js` (ุชู ุญุฐูู)
**ุงูุญุงูุฉ:** ๐๏ธ **ุชู ุญุฐูู**
- ุชู ุฏูุฌ ุฌููุน ูุธุงุฆูู ูู `imageProcessor.js`
- ุงูุฏุงูุฉ `extractImagesFromRAGData()` ููุฌูุฏุฉ ุงูุขู ูู `imageProcessor.js`

---

### 12. โ `promptBuilder.js` (ุชู ุญุฐูู)
**ุงูุญุงูุฉ:** ๐๏ธ **ุชู ุญุฐูู**
- ุงููุธุงุฆู ููุฌูุฏุฉ ูู `responseGenerator.js` ุจุดูู ุฃูุถู ูุฃูุซุฑ ุชูุตููุงู
- ุงูููุฏ ุงูููุฌูุฏ ููู ูุงู ูุจุณุทุงู ุฌุฏุงู

---

### 13. ๐ `README.md`
**ุงูุงุณุชุฎุฏุงู:**
- ุชูุซูู ุงูู modules
- ุดุฑุญ ุงุณุชุฎุฏุงู ูู module

**ุงูุญุงูุฉ:** โ **ูููุฏ ููุชูุซูู**
- ูุญุชูู ุนูู ูุนูููุงุช ุนู ุงูู modules
- ููู ุงููุนูููุงุช **ูุฏููุฉ ุจุนุถ ุงูุดูุก** - ุจุนุถ ุงูู modules ูุณุชุฎุฏูุฉ ูุงูุจุนุถ ุบูุฑ ูุณุชุฎุฏู

**ุงูุชูุตูุฉ:** โ๏ธ **ูุญุชุงุฌ ุชุญุฏูุซ** - ุชุญุฏูุซ ุงููุนูููุงุช ูุชุนูุณ ุงููุถุน ุงูุญุงูู

---

## ๐ฏ ุงูุฎูุงุตุฉ ูุงูุชูุตูุงุช

### โ ุงููููุงุช ุงููููุฏุฉ ูุงููุณุชุฎุฏูุฉ (10 ูููุงุช):
1. โ `messageProcessor.js` - ูุนุงูุฌุฉ ุงูุฑุณุงุฆู ุงูุฑุฆูุณูุฉ
2. โ `contextManager.js` - ุฅุฏุงุฑุฉ ุงูุณูุงู
3. โ `responseGenerator.js` - ุชูููุฏ ุงูุฑุฏูุฏ
4. โ `orderProcessor.js` - ูุนุงูุฌุฉ ุงูุทูุจุงุช
5. โ `imageProcessor.js` - ูุนุงูุฌุฉ ุงูุตูุฑ (โ ุชู ุฏูุฌ `imageExtractor.js` ููู)
6. โ `settingsManager.js` - ุฅุฏุงุฑุฉ ุงูุฅุนุฏุงุฏุงุช
7. โ `modelManager.js` - ุฅุฏุงุฑุฉ ุงูููุงุฐุฌ
8. โ `learningMonitor.js` - ูุฑุงูุจุฉ ุงูุชุนูู
9. โ `intentAnalyzer.js` - ุชุญููู ุงูููุงูุง
10. โ `productExtractor.js` - ุงุณุชุฎุฑุงุฌ ุงูููุชุฌุงุช

### ๐๏ธ ุงููููุงุช ุงููุญุฐููุฉ (2 ูููุงุช):
1. ๐๏ธ `imageExtractor.js` - โ ุชู ุญุฐูู ูุฏูุฌู ูู `imageProcessor.js`
2. ๐๏ธ `promptBuilder.js` - โ ุชู ุญุฐูู (ุงููุธุงุฆู ููุฌูุฏุฉ ูู `responseGenerator.js`)

### ๐ ูููุงุช ุงูุชูุซูู (1 ููู):
1. ๐ `README.md` - โ ุชู ุชุญุฏูุซู

---

## ๐ง ุงูุชูุตูุงุช ุงููููุฐุฉ

### 1. โ ุงูุญูุงุธ ุนูู ุงููููุงุช ุงููุณุชุฎุฏูุฉ
ุฌููุน ุงููููุงุช ุงููุณุชุฎุฏูุฉ ูููุฏุฉ ูุชุนูู ุจุดูู ุฌูุฏ - **ูุง ุชุบููุฑ ูุทููุจ**

### 2. โ ุญุฐู `promptBuilder.js`
โ **ุชู ุงูุญุฐู** - ุงููุธุงุฆู ููุฌูุฏุฉ ูู `responseGenerator.js` ุจุดูู ุฃูุถู

### 3. โ ุฏูุฌ `imageExtractor.js` ูุน `imageProcessor.js`
โ **ุชู ุงูุฏูุฌ** - ุชู ููู `extractImagesFromRAGData()` ุฅูู `imageProcessor.js` ูุญุฐู `imageExtractor.js`

### 4. โ ุชุญุฏูุซ `README.md`
โ **ุชู ุงูุชุญุฏูุซ** - ุชุญุฏูุซ ุงููุนูููุงุช ูุชุนูุณ ุงููุถุน ุงูุญุงูู ูุงููููุงุช ุงููุณุชุฎุฏูุฉ

### 5. ๐ ุฅุถุงูุฉ ุชูุซูู ุฃูุถู (ูุณุชูุจูู)
ุฅุถุงูุฉ JSDoc comments ุฃูุถู ููู ุฏุงูุฉ ูุชุณููู ุงูุตูุงูุฉ

---

## ๐ ุงูุฅุญุตุงุฆูุงุช

- **ุฅุฌูุงูู ุงููููุงุช:** 11 ููู (ุจุนุฏ ุงูุญุฐู)
- **ุงููููุงุช ุงููุณุชุฎุฏูุฉ:** 10 ูููุงุช (91%)
- **ุงููููุงุช ุงููุญุฐููุฉ:** 2 ูููุงุช (ุชู ุญุฐูููุง)
- **ูููุงุช ุงูุชูุซูู:** 1 ููู (9%)

---

## โ ุงูุฎูุงุตุฉ ุงูููุงุฆูุฉ

**ุงููุฌูุฏ ูููุฏ ุฌุฏุงู** - ุฌููุน ุงููููุงุช ุงููุณุชุฎุฏูุฉ ุชุนูู ุจุดูู ุฌูุฏ. ุงููุธุงู ูุณุชุฎุฏู **Lazy Initialization Pattern** ูุชุญููู ุงูู modules ุนูุฏ ุงูุญุงุฌุฉ ููุทุ ููุง ูุญุณู ุงูุฃุฏุงุก.

**โ ุชู ุชูููุฐ ุฌููุน ุงูุชูุตูุงุช:**
- โ ุชู ุญุฐู `promptBuilder.js`
- โ ุชู ุฏูุฌ `imageExtractor.js` ูู `imageProcessor.js`
- โ ุชู ุชุญุฏูุซ `README.md`
- โ ุชู ุชุญุฏูุซ `aiAgentService.js` ูุงุณุชุฎุฏุงู `imageProcessor` ุจุฏูุงู ูู `imageExtractor`

**ุงูุชูุตูุฉ ุงูุนุงูุฉ:** โ **ุงููุฌูุฏ ูุธูู ูููุธู** - ุฌููุน ุงููููุงุช ูููุฏุฉ ููุณุชุฎุฏูุฉ

# ๐ ุชูุฑูุฑ ูุญุต ุฅุนุฏุงุฏุงุช ุดุฎุตูุฉ ุงููุณุงุนุฏ ุงูุฐูู

**ุงูุชุงุฑูุฎ:** $(date)  
**ุงูุดุฑูุฉ:** ุดุฑูุฉ ุงูุชุณููู (cmem8ayyr004cufakqkcsyn97)

---

## โ ุงูุฅุฌุงุจุฉ ุงููุจุงุดุฑุฉ

**ูุนูุ ุงููุธุงู ูุณุชุฎุฏู ุฅุนุฏุงุฏุงุช ุดุฎุตูุฉ ุงููุณุงุนุฏ ุงูุฐูู ุจุดูู ุตุญูุญ! โ**

---

## ๐ ุงูุชูุงุตูู

### 1. ุงููุตุฏุฑ ุงููุณุชุฎุฏู

ุงููุธุงู ูุณุชุฎุฏู `personalityPrompt` ูู **AISettings** (ุงูุฃููููุฉ ุงูุซุงููุฉ)

**ุงูุฃููููุฉ ูู ุงูุจุญุซ:**
1. โ **SystemPrompt** (ุงูุฃููููุฉ ุงูุฃุนูู) - ุบูุฑ ููุฌูุฏ ุฃู ุบูุฑ ูุดุท
2. โ **AISettings** (ุงูุฃููููุฉ ุงูุซุงููุฉ) - **ูุณุชุฎุฏู ุญุงููุงู** โ
3. โ **Company table** - ูุง ูุญุชูู ุนูู personalityPrompt ูู ุงูุฅุตุฏุงุฑ ุงูุญุงูู

### 2. ูุญุชูู personalityPrompt

- **ุงูุทูู:** 298 ุญุฑู
- **ุงููุตุฏุฑ:** `ai_settings`
- **ุงููุญุชูู (ุฃูู 200 ุญุฑู):**
  ```
  ุฃูุช ูุณุงุนุฏ ุฐูู ูุญุชุฑู ููุฏูุฏ ููุชุฌุฑ ุฅููุชุฑููู.
  ุชุชุญุฏุซูู ุจุดูู ุทุจูุนู ููุญุชุฑู ูุน ุงูุนููุงุก ุจุงููุบุฉ ุงูุนุฑุจูุฉ.
  ุชุณุงุนุฏูู ูู ุงูุงุณุชูุณุงุฑุงุช ุนู ุงูููุชุฌุงุชุ ุงูุทูุจุงุชุ ุงูุฃุณุนุงุฑุ ูุทุฑู ุงูุฏูุน ูุงูุดุญู.
  ุชููููู ูุชุนุงููุฉ ูุตุจูุฑุฉุ ูุชูุฏููู ู...
  ```

### 3. ููููุฉ ุงูุงุณุชุฎุฏุงู

ุงููุธุงู ูุณุชุฎุฏู `personalityPrompt` ูู:
- โ `buildAdvancedPrompt()` - ูู `responseGenerator.js`
- โ `buildPrompt()` - ูู `aiAgentService.js`
- โ ูุชู ุฅุถุงูุชู ูู ุจุฏุงูุฉ ูู prompt ูุชู ุฅุฑุณุงูู ููุฐูุงุก ุงูุตูุงุนู

**ุงูููุฏ ุงููุณุชุฎุฏู:**
```javascript
// ูู responseGenerator.js ู aiAgentService.js
if (!companyPrompts.personalityPrompt || companyPrompts.personalityPrompt.trim() === '') {
  throw new Error('MISSING_PERSONALITY_PROMPT: ูุฌุจ ุฅุนุฏุงุฏ ุดุฎุตูุฉ ุงููุณุงุนุฏ ุงูุฐูู ูู ููุญุฉ ุงูุชุญูู ุฃููุงู');
}

prompt += `${companyPrompts.personalityPrompt.trim()}\n\n`;
```

---

## โ ุงููุชูุฌุฉ

### โ ูุง ุชูุฌุฏ ูุดุงูู

- โ `personalityPrompt` ููุฌูุฏ
- โ ูุชู ุงุณุชุฎุฏุงูู ุจุดูู ุตุญูุญ
- โ ุงูุทูู ููุงุณุจ (298 ุญุฑู)
- โ ุงููุธุงู ูุนูู ุจุดูู ุตุญูุญ

---

## ๐ ููุงุญุธุงุช

### 1. SystemPrompt ุบูุฑ ูุดุท

- ููุฌุฏ SystemPrompt ููู ุบูุฑ ูุดุท
- ุฅุฐุง ุชู ุชูุนูู SystemPromptุ ุณูุตุจุญ ูู ุงููุณุชุฎุฏู (ุงูุฃููููุฉ ุงูุฃุนูู)

### 2. responsePrompt ุบูุฑ ููุฌูุฏ

- `responsePrompt` ุบูุฑ ููุฌูุฏ ูู AISettings
- ุงููุธุงู ูุณุชุฎุฏู ููุงุนุฏ ุงูุชุฑุงุถูุฉ ููุฑุฏ

### 3. Company table

- Company table ูุง ูุญุชูู ุนูู `personalityPrompt` ูู ุงูุฅุตุฏุงุฑ ุงูุญุงูู
- ูุฐุง ุทุจูุนู - ุชู ููู personalityPrompt ุฅูู SystemPrompt ู AISettings

---

## ๐ ููู ูุนูู ุงููุธุงู

### ุชุฑุชูุจ ุงูุฃููููุฉ:

1. **SystemPrompt** (isActive: true) - ุงูุฃููููุฉ ุงูุฃุนูู
   - ุฅุฐุง ูุงู ููุฌูุฏ ููุดุทุ ูุชู ุงุณุชุฎุฏุงูู
   
2. **AISettings** (personalityPrompt) - ุงูุฃููููุฉ ุงูุซุงููุฉ โ **ูุณุชุฎุฏู ุญุงููุงู**
   - ุฅุฐุง ูู ููุฌุฏ SystemPrompt ูุดุทุ ูุชู ุงุณุชุฎุฏุงู AISettings
   
3. **Company table** - ุบูุฑ ูุชููุฑ ูู ุงูุฅุตุฏุงุฑ ุงูุญุงูู
   - ุชู ุฅุฒุงูุฉ personalityPrompt ูู Company table

### ุงูููุฏ ุงููุณุคูู:

```javascript
// ูู aiAgentService.js - getCompanyPrompts()
async getCompanyPrompts(companyId, customPrompt = null) {
  // 1. SystemPrompt (ุงูุฃููููุฉ ุงูุฃุนูู)
  const activeSystemPrompt = await prisma.systemPrompt.findFirst({
    where: { isActive: true, companyId }
  });
  if (activeSystemPrompt) return { personalityPrompt: activeSystemPrompt.content, source: 'system_prompt' };
  
  // 2. AISettings (ุงูุฃููููุฉ ุงูุซุงููุฉ) โ
  const aiSettings = await prisma.aiSettings.findFirst({ where: { companyId } });
  if (aiSettings?.personalityPrompt) return { personalityPrompt: aiSettings.personalityPrompt, source: 'ai_settings' };
  
  // 3. Fallback
  return { personalityPrompt: null, source: 'default' };
}
```

---

## โ ุงูุฎูุงุตุฉ

**ุงูุฅุฌุงุจุฉ:** โ **ูุนูุ ุงููุธุงู ูุณุชุฎุฏู ุฅุนุฏุงุฏุงุช ุดุฎุตูุฉ ุงููุณุงุนุฏ ุงูุฐูู**

**ุงููุตุฏุฑ:** `ai_settings` (AISettings)

**ุงูุญุงูุฉ:** โ **ูุนูู ุจุดูู ุตุญูุญ - ูุง ุชูุฌุฏ ูุดุงูู**

**ุงูุชูุตูุฉ:** ูุง ุญุงุฌุฉ ูุฃู ุฅุฌุฑุงุก - ุงููุธุงู ูุนูู ุจุดูู ุตุญูุญ

---

**ุชู ุฅูุดุงุก ูุฐุง ุงูุชูุฑูุฑ ุจูุงุณุทุฉ:** AI Assistant  
**ุงูุชุงุฑูุฎ:** $(date)


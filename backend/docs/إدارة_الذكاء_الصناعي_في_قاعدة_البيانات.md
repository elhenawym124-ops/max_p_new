# ๐ ุฅุฏุงุฑุฉ ุงูุฐูุงุก ุงูุตูุงุนู - ููุงุถุน ุงูุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ูุชู ุญูุธ ุฌููุน ุจูุงูุงุช ุฅุฏุงุฑุฉ ุงูุฐูุงุก ุงูุตูุงุนู ูู ุนุฏุฉ ุฌุฏุงูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช. ูููุง ููู ุชูุงุตูู ูู ุฌุฏูู:

---

## ๐ ุงูุฌุฏุงูู ุงูุฑุฆูุณูุฉ

### 1. **ุฌุฏูู `ai_settings` (ุฅุนุฏุงุฏุงุช AI)**
**ุงูุงุณู ูู Prisma:** `AiSettings`  
**ุงูููู:** `backend/prisma/schema.prisma` (ุงูุณุทุฑ 483-547)

**ูุง ูุชู ุญูุธู:**
- โ ุฅุนุฏุงุฏุงุช ุงูุฑุฏ ุงูุชููุงุฆู (`autoReplyEnabled`)
- โ ุฅุนุฏุงุฏุงุช ุณุงุนุงุช ุงูุนูู (`workingHours`, `workingHoursEnabled`)
- โ ุนุฏุฏ ุงูุฑุฏูุฏ ููู ุนููู (`maxRepliesPerCustomer`)
- โ ุฅุนุฏุงุฏุงุช Multimodal ู RAG (`multimodalEnabled`, `ragEnabled`)
- โ ููุท ุงูุฑุฏ (`replyMode`: "all" ุฃู "new_only")
- โ ุงูุจุฑููุจุชุงุช (`personalityPrompt`, `responsePrompt`)
- โ ุฅุนุฏุงุฏุงุช ุงูุฐุงูุฑุฉ (`maxMessagesPerConversation`, `memoryRetentionDays`)
- โ ุฅุนุฏุงุฏุงุช ุงูุฌูุฏุฉ (`minQualityScore`, `enableLowQualityAlerts`)
- โ ุฅุนุฏุงุฏุงุช AI ุงููุชูุฏูุฉ (`aiTemperature`, `aiTopP`, `aiTopK`, `aiMaxTokens`)

**ุฃูู ูุชู ุงูุญูุธ:**
- `backend/routes/settingsRoutes.js` (ุงูุณุทุฑ 420, 644)
- `backend/services/aiAgent/settingsManager.js` (ุงูุณุทุฑ 380, 397)
- `backend/controller/aiController.js` (ุงูุณุทุฑ 1461, 1468)
- `backend/aiAgentService.js` (ุงูุณุทุฑ 8213, 8227)

---

### 2. **ุฌุฏูู `gemini_keys` (ููุงุชูุญ Gemini API)**
**ุงูุงุณู ูู Prisma:** `GeminiKey`  
**ุงูููู:** `backend/prisma/schema.prisma` (ุงูุณุทุฑ 881-903)

**ูุง ูุชู ุญูุธู:**
- โ ุงุณู ุงูููุชุงุญ (`name`)
- โ API Key (`apiKey`)
- โ ุงููููุฐุฌ ุงูุงูุชุฑุงุถู (`model`)
- โ ุญุงูุฉ ุงูููุชุงุญ (`isActive`)
- โ ุงูุงุณุชุฎุฏุงู (`usage`, `currentUsage`)
- โ ููุน ุงูููุชุงุญ (`keyType`: COMPANY ุฃู CENTRAL)
- โ ุงูุดุฑูุฉ ุงููุฑุชุจุทุฉ (`companyId`)

**ุฃูู ูุชู ุงูุญูุธ:**
- `backend/controller/adminGeminiKeysController.js` (ุงูุณุทุฑ 382, 548)
- `backend/controller/aiController.js` (ุงูุณุทุฑ 811)
- `backend/services/aiAgent/modelManager.js` (ุงูุณุทุฑ 1228, 1239, 1299)

---

### 3. **ุฌุฏูู `system_prompts` (System Prompts)**
**ุงูุงุณู ูู Prisma:** `SystemPrompt`  
**ุงูููู:** `backend/prisma/schema.prisma` (ุงูุณุทุฑ 942-957)

**ูุง ูุชู ุญูุธู:**
- โ ุงุณู ุงูุจุฑููุจุช (`name`)
- โ ูุญุชูู ุงูุจุฑููุจุช (`content`)
- โ ุงูุชุตููู (`category`)
- โ ุญุงูุฉ ุงูุชูุนูู (`isActive`)
- โ ุงูุดุฑูุฉ ุงููุฑุชุจุทุฉ (`companyId`)

**ุฃูู ูุชู ุงูุญูุธ:**
- `backend/controller/aiController.js` (ุงูุณุทุฑ 1226, 1262, 1268, 1314)

---

### 4. **ุฌุฏูู `ai_interactions` (ุชูุงุนูุงุช AI)**
**ุงูุงุณู ูู Prisma:** `AiInteraction`  
**ุงูููู:** `backend/prisma/schema.prisma` (ุงูุณุทุฑ 549-570)

**ูุง ูุชู ุญูุธู:**
- โ ุฑุณุงูุฉ ุงููุณุชุฎุฏู (`userMessage`)
- โ ุฑุฏ AI (`aiResponse`)
- โ ุงูููุฉ (`intent`)
- โ ุงููุดุงุนุฑ (`sentiment`)
- โ ุงูุซูุฉ (`confidence`)
- โ ุงููููุฐุฌ ุงููุณุชุฎุฏู (`modelUsed`)
- โ ููุช ุงูุงุณุชุฌุงุจุฉ (`responseTime`)
- โ Tokens ุงููุณุชุฎุฏูุฉ (`tokensUsed`)

**ุฃูู ูุชู ุงูุญูุธ:**
- ูุชู ุงูุญูุธ ุชููุงุฆูุงู ุนูุฏ ูู ุชูุงุนู ูุน AI ูู `backend/aiAgentService.js`

---

### 5. **ุฌุฏูู `conversation_memory` (ุฐุงูุฑุฉ ุงููุญุงุฏุซุงุช)**
**ุงูุงุณู ูู Prisma:** `ConversationMemory`  
**ุงูููู:** `backend/prisma/schema.prisma` (ุงูุณุทุฑ 806-830)

**ูุง ูุชู ุญูุธู:**
- โ ุฑุณุงูุฉ ุงููุณุชุฎุฏู (`userMessage`)
- โ ุฑุฏ AI (`aiResponse`)
- โ ุงูููุฉ (`intent`)
- โ ุงููุดุงุนุฑ (`sentiment`)
- โ ูุนุฑู ุงููุญุงุฏุซุฉ (`conversationId`)
- โ ูุนุฑู ุงููุฑุณู (`senderId`)
- โ ุงูุดุฑูุฉ (`companyId`)

**ุฃูู ูุชู ุงูุญูุธ:**
- `backend/services/memoryService.js` (ุงูุณุทุฑ 36, 800)

---

### 6. **ุฌุฏูู `knowledge_base` (ูุงุนุฏุฉ ุงููุนุฑูุฉ)**
**ุงูุงุณู ูู Prisma:** `KnowledgeBase`  
**ุงูููู:** `backend/prisma/schema.prisma` (ุงูุณุทุฑ 832-846)

**ูุง ูุชู ุญูุธู:**
- โ ุงูุนููุงู (`title`)
- โ ุงููุญุชูู (`content`)
- โ ุงูุชุตููู (`category`)
- โ ุงูุชุงุฌุงุช (`tags`)
- โ ุญุงูุฉ ุงูุชูุนูู (`isActive`)
- โ ุงูุฃููููุฉ (`priority`)

---

### 7. **ุฌุฏูู `ai_analytics` (ุชุญูููุงุช AI)**
**ุงูุงุณู ูู Prisma:** `AiAnalytics`  
**ุงูููู:** `backend/prisma/schema.prisma` (ุงูุณุทุฑ 848-862)

**ูุง ูุชู ุญูุธู:**
- โ ุงูุชุงุฑูุฎ (`date`)
- โ ุฅุฌูุงูู ุงูุฑุณุงุฆู (`totalMessages`)
- โ ุฑุฏูุฏ AI (`aiResponses`)
- โ ุงูุชุญูููุงุช ุงูุจุดุฑูุฉ (`humanHandoffs`)
- โ ูุชูุณุท ููุช ุงูุงุณุชุฌุงุจุฉ (`avgResponseTime`)
- โ ูุชูุณุท ุงูุซูุฉ (`avgConfidence`)

---

### 8. **ุฌุฏูู `learning_data` (ุจูุงูุงุช ุงูุชุนูู)**
**ุงูุงุณู ูู Prisma:** `LearningData`  
**ุงูููู:** `backend/prisma/schema.prisma` (ุงูุณุทุฑ 959-988)

**ูุง ูุชู ุญูุธู:**
- โ ููุน ุงูุจูุงูุงุช (`type`)
- โ ุฑุณุงูุฉ ุงููุณุชุฎุฏู (`userMessage`)
- โ ุฑุฏ AI (`aiResponse`)
- โ ุงูููุฉ (`intent`)
- โ ุงููุดุงุนุฑ (`sentiment`)
- โ ุงูุซูุฉ (`confidence`)
- โ ุงููุชูุฌุฉ (`outcome`)
- โ ุงูููุงุญุธุงุช (`insights`)

**ุฃูู ูุชู ุงูุญูุธ:**
- `backend/services/continuousLearningServiceV2.js` (ุงูุณุทุฑ 43)
- `backend/aiAgentService.js` (ุงูุณุทุฑ 6699)

---

### 9. **ุฌุฏูู `discovered_patterns` (ุงูุฃููุงุท ุงูููุชุดูุฉ)**
**ุงูุงุณู ูู Prisma:** `DiscoveredPattern`  
**ุงูููู:** `backend/prisma/schema.prisma` (ุงูุณุทุฑ 990-1011)

**ูุง ูุชู ุญูุธู:**
- โ ููุน ุงูููุท (`patternType`)
- โ ุงูููุท (`pattern`)
- โ ุงููุตู (`description`)
- โ ุงูุซูุฉ (`confidence`)
- โ ุนุฏุฏ ุงูุชูุฑุงุฑุงุช (`occurrences`)
- โ ุงูุณูุงูุงุช (`contexts`)
- โ ุงูุฑุคู ุงููุงุจูุฉ ููุชูููุฐ (`actionableInsights`)

**ุฃูู ูุชู ุงูุญูุธ:**
- `backend/services/patternDetector.js` (ุงูุณุทุฑ 1075)

---

### 10. **ุฌุฏูู `gemini_key_models` (ููุงุฐุฌ ุงูููุงุชูุญ)**
**ุงูุงุณู ูู Prisma:** `GeminiKeyModel`  
**ุงูููู:** `backend/prisma/schema.prisma` (ุงูุณุทุฑ 905-921)

**ูุง ูุชู ุญูุธู:**
- โ ูุนุฑู ุงูููุชุงุญ (`keyId`)
- โ ุงุณู ุงููููุฐุฌ (`model`)
- โ ุงูุงุณุชุฎุฏุงู (`usage`)
- โ ุญุงูุฉ ุงูุชูุนูู (`isEnabled`)
- โ ุงูุฃููููุฉ (`priority`)

---

## ๐ ููููุฉ ุงููุตูู ููุจูุงูุงุช

### ุงุณุชุฎุฏุงู Prisma Client:
```javascript
const { prisma } = require('./prisma/client');

// ุฌูุจ ุฅุนุฏุงุฏุงุช AI
const aiSettings = await prisma.aiSettings.findUnique({
  where: { companyId: 'company-id' }
});

// ุชุญุฏูุซ ุฅุนุฏุงุฏุงุช AI
await prisma.aiSettings.update({
  where: { companyId: 'company-id' },
  data: { autoReplyEnabled: true }
});

// ุฅูุดุงุก ุฅุนุฏุงุฏุงุช ุฌุฏูุฏุฉ
await prisma.aiSettings.create({
  data: {
    companyId: 'company-id',
    autoReplyEnabled: true,
    // ... ุจุงูู ุงูุญููู
  }
});
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูุนุฒู ุงูุฃููู:** ุฌููุน ุงูุฌุฏุงูู ูุฑุชุจุทุฉ ุจู `companyId` ูุถูุงู ุนุฒู ุจูุงูุงุช ูู ุดุฑูุฉ
2. **Cascade Delete:** ุนูุฏ ุญุฐู ุดุฑูุฉุ ูุชู ุญุฐู ุฌููุน ุจูุงูุงุช AI ุงููุฑุชุจุทุฉ ุจูุง ุชููุงุฆูุงู
3. **Indexes:** ุชู ุฅุถุงูุฉ ููุงุฑุณ ุนูู `companyId` ูุชุญุณูู ุงูุฃุฏุงุก
4. **Upsert Pattern:** ูุชู ุงุณุชุฎุฏุงู `upsert` ูู ูุนุธู ุงูุญุงูุงุช ูุถูุงู ุฅูุดุงุก ุงูุณุฌู ุฅุฐุง ูู ููู ููุฌูุฏุงู

---

## ๐๏ธ ุงููููุงุช ุงูุฑุฆูุณูุฉ

- **Schema:** `backend/prisma/schema.prisma`
- **Routes:** `backend/routes/settingsRoutes.js`
- **Settings Manager:** `backend/services/aiAgent/settingsManager.js`
- **AI Controller:** `backend/controller/aiController.js`
- **AI Agent Service:** `backend/aiAgentService.js`

---

**ุชู ุฅูุดุงุก ูุฐุง ุงููุณุชูุฏ:** $(date)  
**ุขุฎุฑ ุชุญุฏูุซ:** $(date)














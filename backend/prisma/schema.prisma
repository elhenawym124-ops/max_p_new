generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Company {
  id                     String                  @id @default(cuid())
  name                   String
  slug                   String?                 @unique // ğŸ”— Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø± Ù„Ù„Ù€ subdomain
  email                  String                  @unique
  phone                  String?
  website                String?
  logo                   String?
  address                String?
  currency               String                  @default("EGP")
  facebookUserAccessToken String?                // ğŸ”‘ Facebook User Access Token for Pixel API
  plan                   SubscriptionPlan        @default(BASIC)
  planConfigurationId    String?
  isActive               Boolean                 @default(true)
  settings               String?                 @db.Text
  createdAt              DateTime                @default(now())
  updatedAt              DateTime                @updatedAt
  aiInteractions         AiInteraction[]
  aiSettings             AiSettings?
  appliedImprovements    AppliedImprovement[]
  categories             Category[]
  conversations          Conversation[]
  conversationMemories   ConversationMemory[] // âœ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ù…Ø¹ Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
  conversationOutcomes   ConversationOutcome[]
  customers              Customer[]
  discoveredPatterns     DiscoveredPattern[]
  facebookPages          FacebookPage[]
  facebookComments       FacebookComment[] // NEW: Add relation to Facebook comments
  integrations           Integration[]
  learningData           LearningData[]
  learningSettings       LearningSettings?
  notifications          Notification[]
  orders                 Order[]
  products               Product[]
  responseEffectiveness  ResponseEffectiveness[]
  successPatterns        SuccessPattern[]
  patternPerformance     PatternPerformance[]
  patternUsage           PatternUsage[]
  users                  User[]
  userInvitations        UserInvitation[]
  warehouses             Warehouse[]
  planConfiguration      PlanConfiguration?      @relation(fields: [planConfigurationId], references: [id])
  subscriptions          Subscription[]
  invoices               Invoice[]
  payments               Payment[]
  geminiKeys             GeminiKey[] // ğŸ”‘ Ù…ÙØ§ØªÙŠØ­ Gemini Ø®Ø§ØµØ© Ø¨ÙƒÙ„ Ø´Ø±ÙƒØ©
  systemPrompts          SystemPrompt[] // ğŸ“ Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª Ø§Ù„Ù†Ø¸Ø§Ù…ÙŠØ© Ø®Ø§ØµØ© Ø¨ÙƒÙ„ Ø´Ø±ÙƒØ©
  tasks                  Task[] // ğŸ“‹ Ø§Ù„Ù…Ù‡Ø§Ù… Ø®Ø§ØµØ© Ø¨ÙƒÙ„ Ø´Ø±ÙƒØ©
  projects               Project[] // ğŸ“ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø®Ø§ØµØ© Ø¨ÙƒÙ„ Ø´Ø±ÙƒØ©
  broadcastCampaigns     BroadcastCampaign[] // ğŸ“¢ Ø­Ù…Ù„Ø§Øª Ø§Ù„Ø¨Ø±ÙˆØ¯ÙƒØ§Ø³Øª
  broadcastSettings      BroadcastSettings? // âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ø±ÙˆØ¯ÙƒØ§Ø³Øª
  customerLists          CustomerList[] // ğŸ“‹ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
  postResponseSettings   PostResponseSettings[] // ğŸ“ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª
  pageResponseSettings   PageResponseSettings[] // ğŸ“„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø©
  branches               Branch[] // ğŸª ÙØ±ÙˆØ¹ Ø§Ù„Ù…ØªØ¬Ø±
  shippingZones          ShippingZone[] // ğŸšš Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø´Ø­Ù†
  guestCarts             GuestCart[] // ğŸ›’ Ø³Ù„Ø§Øª Ø§Ù„Ø²ÙˆØ§Ø±
  guestOrders            GuestOrder[] // ğŸ“¦ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø²ÙˆØ§Ø±
  checkoutFormSettings   CheckoutFormSettings? // ğŸ“‹ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙÙˆØ±Ù… Ø§Ù„Ø´ÙŠÙƒ Ø£ÙˆØª
  imageGallery           ImageGallery[] // ğŸ–¼ï¸ Ø­Ø§ÙØ¸Ø© Ø§Ù„ØµÙˆØ±
  storePromotionSettings StorePromotionSettings? // ğŸ¯ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ±ÙˆÙŠØ¬
  storefrontSettings     StorefrontSettings? // ğŸ›ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…ØªØ¬Ø±
  deliveryOptions        DeliveryOption[] // ğŸšš Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„
  postTracking           PostTracking[] // ğŸ“Š ØªØªØ¨Ø¹ Ø§Ù„Ø¨ÙˆØ³ØªØ§Øª
  footerSettings         FooterSettings? // ğŸª Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙÙˆØªØ±
  wishlists              Wishlist[] // â¤ï¸ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø±ØºØ¨Ø§Øª
  recentlyViewed         RecentlyViewed[] // ğŸ‘ï¸ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ù…Ø¤Ø®Ø±Ø§Ù‹
  productReviews         ProductReview[] // â­ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª
  backInStockNotifications BackInStockNotification[] // ğŸ”” Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ø®Ø²ÙˆÙ†
  storePages             StorePage[] // ğŸ“„ ØµÙØ­Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±
  coupons                Coupon[] // ğŸŸï¸ ÙƒÙˆØ¨ÙˆÙ†Ø§Øª Ø§Ù„Ø®ØµÙ…

  @@map("companies")
}

model User {
  id                    String           @id @default(cuid())
  email                 String           @unique
  password              String
  firstName             String
  lastName              String
  avatar                String?
  phone                 String?
  role                  UserRole         @default(AGENT)
  isActive              Boolean          @default(true)
  isEmailVerified       Boolean          @default(false)
  emailVerifiedAt       DateTime?
  lastLoginAt           DateTime?
  passwordChangedAt     DateTime?
  resetPasswordToken    String?
  resetPasswordExpires  DateTime?
  companyId             String
  createdAt             DateTime         @default(now())
  updatedAt             DateTime         @updatedAt
  activities            Activity[]
  assignedConversations Conversation[]
  customerNotes         CustomerNote[]
  sentMessages          Message[]
  notifications         Notification[]
  sentInvitations       UserInvitation[]
  company               Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  assignedTasks         Task[]           @relation("TaskAssignedTo")
  createdTasks          Task[]           @relation("TaskCreatedBy")
  managedProjects       Project[]
  imageGallery          ImageGallery[]

  @@index([companyId], map: "users_companyId_idx")
  @@map("users")
}

model UserInvitation {
  id         String           @id @default(cuid())
  email      String
  firstName  String
  lastName   String
  role       String           @default("AGENT")
  token      String           @unique
  status     InvitationStatus @default(PENDING)
  invitedBy  String
  companyId  String
  expiresAt  DateTime
  acceptedAt DateTime?
  createdAt  DateTime         @default(now())
  updatedAt  DateTime         @updatedAt

  inviter User    @relation(fields: [invitedBy], references: [id], onDelete: Cascade)
  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId], map: "user_invitations_companyId_idx")
  @@index([token], map: "user_invitations_token_idx")
  @@map("user_invitations")
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  EXPIRED
  CANCELLED
}

model Customer {
  id                   String                  @id @default(cuid())
  firstName            String
  lastName             String
  email                String?
  phone                String?
  avatar               String?
  facebookId           String?
  whatsappId           String?
  telegramId           String?
  status               CustomerStatus          @default(LEAD)
  tags                 String?
  notes                String?
  metadata             String?                 @db.Text
  companyId            String
  createdAt            DateTime                @default(now())
  updatedAt            DateTime                @updatedAt
  activities           Activity[]
  aiInteractions       AiInteraction[]
  conversations        Conversation[]
  conversationOutcomes ConversationOutcome[]
  notes_rel            CustomerNote[]
  company              Company                 @relation(fields: [companyId], references: [id], onDelete: Cascade)
  orders               Order[]
  blockedOnPages       BlockedCustomerOnPage[] // ğŸš« Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„ØªÙŠ ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¹Ù„ÙŠÙ‡Ø§

  @@unique([facebookId, companyId], name: "customer_facebook_company")
  @@unique([whatsappId, companyId], name: "customer_whatsapp_company")
  @@unique([telegramId, companyId], name: "customer_telegram_company")
  @@index([companyId], map: "customers_companyId_idx")
  @@index([facebookId], map: "customers_facebookId_idx")
  @@index([status], map: "customers_status_idx")
  @@index([companyId, status], map: "customers_company_status_idx")
  @@map("customers")
}

model Conversation {
  id                  String               @id @default(cuid())
  customerId          String
  assignedUserId      String?
  channel             CommunicationChannel
  status              ConversationStatus   @default(ACTIVE)
  subject             String?
  priority            Int                  @default(1)
  tags                String?
  lastMessageAt       DateTime?
  lastMessagePreview  String?
  isRead              Boolean              @default(false)
  metadata            String?              @db.Text
  companyId           String
  aiEnabled           Boolean              @default(true)
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  assignedUser        User?                @relation(fields: [assignedUserId], references: [id])
  company             Company              @relation(fields: [companyId], references: [id], onDelete: Cascade)
  customer            Customer             @relation(fields: [customerId], references: [id], onDelete: Cascade)
  messages            Message[]
  orders              Order[]
  broadcastRecipients BroadcastRecipient[]

  @@index([assignedUserId], map: "conversations_assignedUserId_idx")
  @@index([companyId], map: "conversations_companyId_idx")
  @@index([customerId], map: "conversations_customerId_idx")
  @@index([lastMessageAt], map: "conversations_lastMessageAt_idx")
  @@index([status], map: "conversations_status_idx")
  @@index([companyId, lastMessageAt], map: "conversations_company_lastmsg_idx")
  @@index([companyId, status, lastMessageAt], map: "conversations_company_status_lastmsg_idx")
  @@map("conversations")
}

model Message {
  id             String       @id @default(cuid())
  conversationId String
  senderId       String?
  type           MessageType  @default(TEXT)
  content        String       @db.Text
  attachments    String?      @db.Text
  metadata       String?      @db.Text
  isFromCustomer Boolean      @default(true)
  isRead         Boolean      @default(false)
  readAt         DateTime?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender         User?        @relation(fields: [senderId], references: [id])

  @@index([conversationId], map: "messages_conversationId_idx")
  @@index([senderId], map: "messages_senderId_idx")
  @@index([createdAt], map: "messages_createdAt_idx")
  @@index([isFromCustomer], map: "messages_isFromCustomer_idx")
  @@index([conversationId, createdAt], map: "messages_conversation_created_idx")
  @@index([conversationId, isFromCustomer, createdAt], map: "messages_conv_customer_created_idx")
  @@map("messages")
}

model Category {
  id          String     @id @default(cuid())
  name        String
  description String?
  image       String?
  parentId    String?
  isActive    Boolean    @default(true)
  sortOrder   Int        @default(0)
  companyId   String
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  company     Company    @relation(fields: [companyId], references: [id], onDelete: Cascade)
  parent      Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children    Category[] @relation("CategoryHierarchy")
  products    Product[]

  @@index([companyId], map: "categories_companyId_idx")
  @@index([parentId], map: "categories_parentId_idx")
  @@map("categories")
}

model Product {
  id                 String                 @id @default(cuid())
  name               String
  description        String?
  sku                String?                @unique
  price              Decimal                @db.Decimal(10, 2)
  comparePrice       Decimal?               @db.Decimal(10, 2)
  cost               Decimal?               @db.Decimal(10, 2)
  images             String?                @db.Text
  stock              Int                    @default(0)
  trackInventory     Boolean                @default(true)
  weight             Decimal?               @db.Decimal(8, 2)
  dimensions         String?                @db.Text
  categoryId         String?
  isActive           Boolean                @default(true)
  isFeatured         Boolean                @default(false)
  hasPromotedAd      Boolean                @default(false)
  tags               String?
  metadata           String?                @db.Text
  companyId          String
  barcode            String?
  easyOrdersId       String?
  easyOrdersUrl      String?
  wooCommerceId      String?
  wooCommerceUrl     String?
  source             String?                @default("manual")
  enableCheckoutForm Boolean                @default(true) // âœ¨ ØªÙØ¹ÙŠÙ„ ÙÙˆØ±Ù… Ø§Ù„Ø´ÙŠÙƒ Ø£ÙˆØª Ù„Ù„Ù…Ù†ØªØ¬
  showAddToCartButton Boolean               @default(true) // ğŸ›’ Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ù…Ù†ØªØ¬
  saleStartDate      DateTime?              // ğŸ“… ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¹Ø±Ø¶/Ø§Ù„Ø®ØµÙ…
  saleEndDate        DateTime?              // ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¹Ø±Ø¶/Ø§Ù„Ø®ØµÙ…
  sizeGuide          String?                @db.Text // ğŸ“ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª
  createdAt          DateTime               @default(now())
  updatedAt          DateTime               @updatedAt
  inventory          Inventory[]
  orderItems         OrderItem[]
  variants           ProductVariant[]
  category           Category?              @relation(fields: [categoryId], references: [id])
  company            Company                @relation(fields: [companyId], references: [id], onDelete: Cascade)
  alerts             StockAlert[]
  movements          StockMovement[]
  featuredInPosts    PostResponseSettings[] // ğŸ¯ Ø§Ù„Ø¨ÙˆØ³ØªØ§Øª Ø§Ù„ØªÙŠ ØªÙ…ÙŠØ² Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬
  wishlists          Wishlist[] // â¤ï¸ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø±ØºØ¨Ø§Øª Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬
  recentlyViewed     RecentlyViewed[] // ğŸ‘ï¸ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ù…Ø¤Ø®Ø±Ø§Ù‹
  reviews            ProductReview[] // â­ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª
  backInStockNotifications BackInStockNotification[] // ğŸ”” Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ø®Ø²ÙˆÙ†

  @@index([categoryId], map: "products_categoryId_idx")
  @@index([companyId], map: "products_companyId_idx")
  @@map("products")
}

model ProductVariant {
  id             String      @id @default(cuid())
  productId      String
  name           String
  type           String      @default("color")
  sku            String?     @unique
  price          Decimal?    @db.Decimal(10, 2)
  comparePrice   Decimal?    @db.Decimal(10, 2)
  cost           Decimal?    @db.Decimal(10, 2)
  images         String?     @db.Text
  stock          Int         @default(0)
  trackInventory Boolean     @default(true)
  isActive       Boolean     @default(true)
  sortOrder      Int         @default(0)
  metadata       String?     @db.Text
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  orderItems     OrderItem[]
  product        Product     @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId], map: "product_variants_productId_idx")
  @@map("product_variants")
}

model Order {
  id                  String        @id @default(cuid())
  orderNumber         String        @unique
  customerId          String
  conversationId      String?
  status              OrderStatus   @default(PENDING)
  paymentStatus       PaymentStatus @default(PENDING)
  paymentMethod       PaymentMethod @default(CASH)
  subtotal            Decimal       @db.Decimal(10, 2)
  tax                 Decimal       @default(0.00) @db.Decimal(10, 2)
  shipping            Decimal       @default(0.00) @db.Decimal(10, 2)
  discount            Decimal       @default(0.00) @db.Decimal(10, 2)
  total               Decimal       @db.Decimal(10, 2)
  currency            String        @default("EGP") // ğŸ”„ ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„Ø© Ù…Ø¹ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…
  notes               String?
  shippingAddress     String?       @db.Text
  billingAddress      String?       @db.Text
  customerName        String?
  customerPhone       String?
  customerEmail       String?
  city                String?
  customerAddress     String?
  dataQuality         String?       @db.Text
  extractionMethod    String?       @default("ai_enhanced")
  confidence          Float?
  validationStatus    String?       @default("pending")
  sourceType          String?       @default("ai_conversation")
  extractionTimestamp DateTime?
  metadata            String?       @db.Text
  companyId           String
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  items               OrderItem[]
  company             Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  conversation        Conversation? @relation(fields: [conversationId], references: [id])
  customer            Customer      @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@index([companyId], map: "orders_companyId_idx")
  @@index([customerId], map: "orders_customerId_idx")
  @@index([conversationId], map: "orders_conversationId_idx")
  @@map("orders")
}

model OrderItem {
  id               String          @id @default(cuid())
  orderId          String
  productId        String?
  quantity         Int
  price            Decimal         @db.Decimal(10, 2)
  total            Decimal         @db.Decimal(10, 2)
  productName      String?
  productColor     String?
  productSize      String?
  productSku       String?
  metadata         String?         @db.Text
  variantId        String?
  extractionSource String?         @default("ai")
  confidence       Float?
  order            Order           @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product          Product?        @relation(fields: [productId], references: [id], onDelete: Cascade)
  variant          ProductVariant? @relation(fields: [variantId], references: [id])

  @@index([orderId], map: "order_items_orderId_idx")
  @@index([productId], map: "order_items_productId_idx")
  @@index([variantId], map: "order_items_variantId_idx")
  @@map("order_items")
}

model Notification {
  id        String    @id @default(cuid())
  userId    String?
  title     String
  message   String
  type      String    @default("info")
  isRead    Boolean   @default(false)
  readAt    DateTime?
  data      String?   @db.Text
  companyId String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  company   Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user      User?     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([companyId], map: "notifications_companyId_idx")
  @@index([userId], map: "notifications_userId_idx")
  @@map("notifications")
}

model AINotification {
  id        String    @id @default(cuid())
  companyId String
  type      String // 'no_response', 'consecutive_failures', 'high_failure_rate', etc.
  severity  String    @default("medium") // 'low', 'medium', 'high', 'critical'
  title     String
  message   String    @db.Text
  metadata  String?   @db.Text // JSON data
  isRead    Boolean   @default(false)
  readAt    DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@index([companyId])
  @@index([isRead])
  @@index([createdAt])
  @@map("ai_notifications")
}

model Integration {
  id          String    @id @default(cuid())
  name        String
  type        String
  platform    String
  externalId  String
  accessToken String?   @db.Text
  config      String    @db.Text
  settings    String?   @db.Text
  status      String    @default("ACTIVE")
  isActive    Boolean   @default(true)
  lastSyncAt  DateTime?
  companyId   String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  company     Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, platform, externalId])
  @@map("integrations")
}

model AiSettings {
  id                       String   @id @default(cuid())
  companyId                String   @unique
  promptTemplate           String?  @db.Text
  autoReplyEnabled         Boolean  @default(false)
  confidenceThreshold      Float    @default(0.7)
  escalationRules          String?  @db.Text
  createdAt                DateTime @default(now())
  updatedAt                DateTime @updatedAt
  autoCreateOrders         Boolean  @default(false)
  autoSuggestProducts      Boolean  @default(true)
  defaultProductId         String?
  includeImages            Boolean  @default(true)
  maxSuggestions           Int      @default(3)
  modelSettings            String?  @db.Text
  personalityPrompt        String?  @db.Text
  responsePrompt           String?  @db.Text
  memorySettings           String?  @db.Text
  useAdvancedTools         Boolean  @default(false)
  workingHours             String?  @db.Text
  workingHoursEnabled      Boolean  @default(true)
  maxRepliesPerCustomer    Int      @default(5)
  multimodalEnabled        Boolean  @default(true)
  ragEnabled               Boolean  @default(true)
  qualityEvaluationEnabled Boolean  @default(true)
  queueSettings            String?  @db.Text

  // âœ¨ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª AI Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
  aiTemperature Float? @default(0.7)
  aiTopP        Float? @default(0.9)

  // âœ… NEW: Reply Mode - ØªØ­Ø¯ÙŠØ¯ Ù…ØªÙ‰ ÙŠØ±Ø¯ Ø§Ù„Ù€ AI
  // "new_only" = ÙŠØ±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙ‚Ø·
  // "all" = ÙŠØ±Ø¯ Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
  replyMode       String  @default("all")
  aiTopK          Int?    @default(40)
  aiMaxTokens     Int?    @default(1024)
  aiResponseStyle String? @default("balanced") // formal, casual, balanced

  // âœ¨ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø°ÙƒÙŠ
  enableDiversityCheck    Boolean @default(true)
  enableToneAdaptation    Boolean @default(true)
  enableEmotionalResponse Boolean @default(true)
  enableSmartSuggestions  Boolean @default(false)
  enableLongTermMemory    Boolean @default(false)

  // âœ¨ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©
  maxMessagesPerConversation Int?    @default(50)
  memoryRetentionDays        Int?    @default(30)
  enablePatternApplication   Boolean @default(true)
  patternPriority            String? @default("balanced") // prompt, balanced, patterns

  // âœ¨ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬ÙˆØ¯Ø©
  minQualityScore        Float?  @default(70)
  enableLowQualityAlerts Boolean @default(true)

  // âœ… Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© (Ù…Ù† Memory Tab)
  maxConversationsPerUser Int?    @default(100)
  autoCleanup             Boolean @default(true)
  compressionEnabled      Boolean @default(false)

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@map("ai_settings")
}

model AiInteraction {
  id                        String   @id @default(cuid())
  companyId                 String
  customerId                String
  userMessage               String   @db.Text
  aiResponse                String   @db.Text
  intent                    String?
  sentiment                 String?
  confidence                Float?
  requiresHumanIntervention Boolean  @default(false)
  metadata                  String?  @db.Text
  createdAt                 DateTime @default(now())
  modelUsed                 String?
  responseTime              Int?
  tokensUsed                Int?
  company                   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  customer                  Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@index([companyId], map: "ai_interactions_companyId_idx")
  @@index([customerId], map: "ai_interactions_customerId_idx")
  @@map("ai_interactions")
}

model PromptTemplate {
  id           String   @id @default(cuid())
  name         String
  category     String
  businessType String?
  description  String?
  content      String   @db.Text
  variables    String?  @db.Text
  tags         String?  @db.Text
  isActive     Boolean  @default(true)
  usageCount   Int      @default(0)
  rating       Float    @default(0)
  createdBy    String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("prompt_templates")
}

// ğŸ“š Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨ØªØ§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© Ù…Ù† SuperAdmin
model PromptLibrary {
  id                String   @id @default(cuid())
  name              String // Ø§Ø³Ù… Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª
  nameAr            String? // Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ
  description       String   @db.Text // ÙˆØµÙ Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª
  descriptionAr     String?  @db.Text // Ø§Ù„ÙˆØµÙ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ
  category          String // Ø§Ù„ØªØµÙ†ÙŠÙ: sales, support, general, etc.
  businessType      String? // Ù†ÙˆØ¹ Ø§Ù„Ø¨ÙŠØ²Ù†Ø³: ecommerce, restaurant, etc.
  promptContent     String   @db.Text // Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª
  personalityPrompt String?  @db.Text // Ø¨Ø±ÙˆÙ…Ø¨Øª Ø§Ù„Ø´Ø®ØµÙŠØ©
  responsePrompt    String?  @db.Text // Ø¨Ø±ÙˆÙ…Ø¨Øª Ø§Ù„Ø±Ø¯ÙˆØ¯
  variables         String?  @db.Text // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (JSON)
  tags              String?  @db.Text // ØªØ§Ø¬Ø§Øª Ù„Ù„Ø¨Ø­Ø«
  icon              String? // Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª
  previewImage      String? // ØµÙˆØ±Ø© Ù…Ø¹Ø§ÙŠÙ†Ø©
  isActive          Boolean  @default(true) // Ù‡Ù„ Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª Ù†Ø´Ø·
  isFeatured        Boolean  @default(false) // Ù‡Ù„ Ù…Ù…ÙŠØ²
  usageCount        Int      @default(0) // Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
  rating            Float    @default(0) // Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
  sortOrder         Int      @default(0) // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ø±Ø¶
  createdBy         String? // Ù…Ù† Ø£Ù†Ø´Ø£Ù‡ (superadmin)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([category])
  @@index([isActive])
  @@index([isFeatured])
  @@index([businessType])
  @@map("prompt_library")
}

model CustomerNote {
  id         String   @id @default(cuid())
  customerId String
  authorId   String
  content    String   @db.Text
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  author     User     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@index([authorId], map: "customer_notes_authorId_idx")
  @@index([customerId], map: "customer_notes_customerId_idx")
  @@map("customer_notes")
}

model Activity {
  id          String    @id @default(cuid())
  userId      String?
  customerId  String?
  action      String
  description String
  metadata    String?   @db.Text
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime  @default(now())
  customer    Customer? @relation(fields: [customerId], references: [id])
  user        User?     @relation(fields: [userId], references: [id])

  @@index([customerId], map: "activities_customerId_idx")
  @@index([userId], map: "activities_userId_idx")
  @@map("activities")
}

model FacebookPage {
  id               String                  @id @default(cuid())
  pageId           String                  @unique
  pageAccessToken  String                  @db.Text
  pageName         String
  companyId        String?
  status           String                  @default("connected")
  connectedAt      DateTime                @default(now())
  disconnectedAt   DateTime? // New field for tracking disconnection time
  createdAt        DateTime                @default(now())
  updatedAt        DateTime                @updatedAt
  company          Company?                @relation(fields: [companyId], references: [id], onDelete: Cascade)
  blockedCustomers BlockedCustomerOnPage[] // ğŸš« Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙŠÙ† Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©

  @@index([companyId], map: "facebook_pages_companyId_idx")
  @@map("facebook_pages")
}

// ğŸš« Ø¬Ø¯ÙˆÙ„ Ù„Ø­Ø¸Ø± Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¹Ù„Ù‰ ØµÙØ­Ø§Øª Ø§Ù„ÙÙŠØ³ Ø¨ÙˆÙƒ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
model BlockedCustomerOnPage {
  id             String   @id @default(cuid())
  facebookPageId String // ID ØµÙØ­Ø© Ø§Ù„ÙÙŠØ³ Ø¨ÙˆÙƒ (Ù…Ù† Ø¬Ø¯ÙˆÙ„ FacebookPage)
  pageId         String // Facebook Page ID (Ù„Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ø±ÙŠØ¹)
  customerId     String // ID Ø§Ù„Ø¹Ù…ÙŠÙ„
  facebookId     String // Facebook ID Ù„Ù„Ø¹Ù…ÙŠÙ„ (Ù„Ù„ØªØ³Ù‡ÙŠÙ„ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«)
  blockedBy      String? // ID Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø°ÙŠ Ù‚Ø§Ù… Ø¨Ø§Ù„Ø­Ø¸Ø±
  reason         String?  @db.Text // Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø¸Ø±
  metadata       String?  @db.Text // Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ù†ØªÙŠØ¬Ø© Facebook API)
  blockedAt      DateTime @default(now())
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  facebookPage FacebookPage @relation(fields: [facebookPageId], references: [id], onDelete: Cascade)
  customer     Customer     @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@unique([facebookPageId, customerId], name: "blocked_customer_page_unique")
  @@unique([pageId, facebookId], name: "blocked_facebook_page_unique")
  @@index([facebookPageId], map: "blocked_customers_facebookPageId_idx")
  @@index([pageId], map: "blocked_customers_pageId_idx")
  @@index([customerId], map: "blocked_customers_customerId_idx")
  @@index([facebookId], map: "blocked_customers_facebookId_idx")
  @@map("blocked_customers_on_page")
}

model SkippedFacebookPage {
  id                   String    @id @default(cuid())
  pageId               String
  pageName             String
  reason               String // Ø§Ù„Ø³Ø¨Ø¨: already_connected_to_another_company
  attemptedCompanyId   String // Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ù„ÙŠ Ø­Ø§ÙˆÙ„Øª ØªØ±Ø¨Ø· Ø§Ù„ØµÙØ­Ø©
  connectedToCompanyId String? // Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ù…Ø±Ø¨ÙˆØ·Ø© Ø¨ÙŠÙ‡Ø§ Ø­Ø§Ù„ÙŠØ§Ù‹
  isResolved           Boolean   @default(false) // Ù‡Ù„ ØªÙ… Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©
  resolvedAt           DateTime?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt

  @@index([attemptedCompanyId])
  @@index([isResolved])
  @@index([createdAt])
  @@map("skipped_facebook_pages")
}

model Warehouse {
  id        String          @id @default(cuid())
  name      String
  location  String?
  type      String          @default("main")
  capacity  Int?
  isActive  Boolean         @default(true)
  companyId String
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  inventory Inventory[]
  alerts    StockAlert[]
  movements StockMovement[]
  company   Company         @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("warehouses")
}

model Inventory {
  id              String    @id @default(cuid())
  productId       String
  warehouseId     String
  quantity        Int       @default(0)
  reserved        Int       @default(0)
  available       Int       @default(0)
  minStock        Int       @default(0)
  maxStock        Int?
  reorderPoint    Int       @default(0)
  reorderQuantity Int       @default(0)
  cost            Decimal?  @db.Decimal(10, 2)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  product         Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  warehouse       Warehouse @relation(fields: [warehouseId], references: [id], onDelete: Cascade)

  @@unique([productId, warehouseId])
  @@index([productId])
  @@index([warehouseId])
  @@map("inventory")
}

model StockMovement {
  id          String              @id @default(cuid())
  productId   String
  warehouseId String
  type        StockMovementType
  reason      StockMovementReason
  quantity    Int
  cost        Decimal?            @db.Decimal(10, 2)
  reference   String?
  notes       String?
  userId      String?
  userName    String?
  createdAt   DateTime            @default(now())
  product     Product             @relation(fields: [productId], references: [id], onDelete: Cascade)
  warehouse   Warehouse           @relation(fields: [warehouseId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([warehouseId])
  @@index([createdAt])
  @@map("stock_movements")
}

model StockAlert {
  id              String        @id @default(cuid())
  type            AlertType
  priority        AlertPriority
  productId       String
  productName     String
  warehouseId     String
  warehouseName   String
  message         String
  currentStock    Int?
  reorderPoint    Int?
  reorderQuantity Int?
  isRead          Boolean       @default(false)
  createdAt       DateTime      @default(now())
  product         Product       @relation(fields: [productId], references: [id], onDelete: Cascade)
  warehouse       Warehouse     @relation(fields: [warehouseId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([warehouseId])
  @@index([isRead])
  @@index([priority])
  @@map("stock_alerts")
}

model ConversationMemory {
  id             String   @id @default(cuid())
  conversationId String
  senderId       String
  companyId      String // ğŸ” Ø¥Ø¬Ø¨Ø§Ø±ÙŠ Ø¨Ø¯ÙˆÙ† Ù‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© - ÙŠØ¬Ø¨ ØªÙ…Ø±ÙŠØ± companyId ØµØ­ÙŠØ­ Ø¯Ø§Ø¦Ù…Ø§Ù‹
  userMessage    String
  aiResponse     String
  intent         String?
  sentiment      String?
  timestamp      DateTime @default(now())
  metadata       String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ù…Ø¹ Ø§Ù„Ø´Ø±ÙƒØ©
  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([senderId])
  @@index([companyId]) // ğŸ” ÙÙ‡Ø±Ø³ Ù„Ù„Ø¹Ø²Ù„ Ø§Ù„Ø£Ù…Ù†ÙŠ
  @@index([companyId, conversationId]) // âš¡ ÙÙ‡Ø±Ø³ Ù…Ø±ÙƒØ¨ Ù„Ù„Ø£Ø¯Ø§Ø¡
  @@index([companyId, senderId]) // âš¡ ÙÙ‡Ø±Ø³ Ù…Ø±ÙƒØ¨ Ù„Ù„Ø£Ø¯Ø§Ø¡
  @@index([timestamp])
  @@map("conversation_memory")
}

model KnowledgeBase {
  id        String   @id @default(cuid())
  title     String
  content   String
  category  String
  tags      String?
  isActive  Boolean  @default(true)
  priority  Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([category])
  @@index([isActive])
  @@map("knowledge_base")
}

model AiAnalytics {
  id                    String   @id @default(cuid())
  date                  DateTime @db.Date
  totalMessages         Int      @default(0)
  aiResponses           Int      @default(0)
  humanHandoffs         Int      @default(0)
  avgResponseTime       Float?
  avgConfidence         Float?
  topIntents            String?
  sentimentDistribution String?
  createdAt             DateTime @default(now())

  @@index([date])
  @@map("ai_analytics")
}

model MediaFile {
  id             String   @id @default(cuid())
  conversationId String
  senderId       String
  fileName       String
  fileType       String
  fileSize       Int?
  fileUrl        String
  analysis       String?
  processed      Boolean  @default(false)
  createdAt      DateTime @default(now())

  @@index([conversationId])
  @@index([fileType])
  @@map("media_files")
}

model GeminiKey {
  id                String           @id @default(cuid())
  name              String
  apiKey            String           @unique
  model             String           @default("gemini-1.5-flash")
  isActive          Boolean          @default(true)
  usage             String           @default("{\"used\": 0, \"limit\": 1000000}")
  currentUsage      Int              @default(0)
  maxRequestsPerDay Int              @default(1500)
  priority          Int              @default(1)
  description       String?
  companyId         String // ğŸ¢ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø²Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø´Ø±ÙƒØ§Øª
  company           Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  models            GeminiKeyModel[]

  @@index([isActive, priority])
  @@index([companyId, isActive])
  @@map("gemini_keys")
}

model GeminiKeyModel {
  id        String    @id @default(cuid())
  keyId     String
  model     String
  usage     String    @default("{\"used\": 0, \"limit\": 1000000, \"resetDate\": null}")
  isEnabled Boolean   @default(true)
  priority  Int       @default(1)
  lastUsed  DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  key       GeminiKey @relation(fields: [keyId], references: [id], onDelete: Cascade)

  @@unique([keyId, model])
  @@index([isEnabled, priority])
  @@index([keyId, model])
  @@map("gemini_key_models")
}

model SystemPrompt {
  id        String   @id @default(cuid())
  name      String
  content   String   @db.Text
  category  String   @default("general")
  isActive  Boolean  @default(false)
  companyId String? // Ø¥Ø¶Ø§ÙØ© companyId Ù„Ù„Ø¹Ø²Ù„ Ø§Ù„Ø£Ù…Ù†ÙŠ
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ù…Ø¹ Ø§Ù„Ø´Ø±ÙƒØ©
  company Company? @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("system_prompts")
}

model LearningData {
  id             String   @id @default(cuid())
  companyId      String
  customerId     String?
  conversationId String?
  type           String
  data           String?  @db.Text
  userMessage    String?  @db.Text
  aiResponse     String?  @db.Text
  intent         String?
  sentiment      String?
  processingTime Int?
  ragDataUsed    Boolean  @default(false)
  memoryUsed     Boolean  @default(false)
  model          String?
  confidence     Float?
  outcome        String?
  feedback       String?  @db.Text
  insights       String?  @db.Text
  metadata       String?  @db.Text
  createdAt      DateTime @default(now())
  company        Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([type])
  @@index([createdAt])
  @@index([confidence])
  @@index([intent])
  @@map("learning_data")
}

model DiscoveredPattern {
  id                 String               @id @default(cuid())
  companyId          String
  patternType        String
  pattern            String
  description        String
  confidence         Float
  occurrences        Int                  @default(0)
  contexts           String?              @db.Text
  actionableInsights String?              @db.Text
  impact             String?              @db.Text
  status             String               @default("discovered")
  discoveredAt       DateTime             @default(now())
  lastValidated      DateTime?
  improvements       AppliedImprovement[]
  company            Company              @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([patternType])
  @@index([status])
  @@map("discovered_patterns")
}

model AppliedImprovement {
  id                String             @id @default(cuid())
  companyId         String
  patternId         String?
  type              String
  description       String
  implementation    String             @db.Text
  rolloutPercentage Int                @default(10)
  status            String             @default("testing")
  beforeMetrics     String?            @db.Text
  afterMetrics      String?            @db.Text
  improvementScore  Float?
  createdAt         DateTime           @default(now())
  lastEvaluated     DateTime?
  company           Company            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  pattern           DiscoveredPattern? @relation(fields: [patternId], references: [id])

  @@index([companyId])
  @@index([type])
  @@index([status])
  @@index([patternId], map: "applied_improvements_patternId_idx")
  @@map("applied_improvements")
}

model LearningSettings {
  id                    String   @id @default(cuid())
  companyId             String   @unique
  enabled               Boolean  @default(true)
  learningSpeed         String   @default("medium")
  autoApplyImprovements Boolean  @default(false)
  dataRetentionDays     Int      @default(90)
  minimumSampleSize     Int      @default(50)
  confidenceThreshold   Float    @default(0.8)
  settings              String?  @db.Text
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  company               Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@map("learning_settings")
}

model SuccessPattern {
  id              String    @id @default(cuid())
  companyId       String
  patternType     String // 'word_usage', 'timing', 'response_style', 'emotional_tone'
  pattern         String    @db.Text // JSON string with pattern details
  description     String    @db.Text // ØªØºÙŠÙŠØ± Ù…Ù† String Ø¥Ù„Ù‰ Text Ù„Ø¯Ø¹Ù… Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø·ÙˆÙŠÙ„Ø©
  successRate     Float // Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ (0-1)
  sampleSize      Int // Ø¹Ø¯Ø¯ Ø§Ù„Ø¹ÙŠÙ†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©
  confidenceLevel Float // Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ù‚Ø© (0-1)
  isActive        Boolean   @default(true)
  isApproved      Boolean   @default(false)
  approvedBy      String?
  approvedAt      DateTime?
  metadata        String?   @db.Text // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  company         Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  // Relations
  performance PatternPerformance[]
  usage       PatternUsage[]

  @@index([companyId])
  @@index([patternType])
  @@index([isActive])
  @@index([isApproved])
  @@index([successRate])
  @@map("success_patterns")
}

model PatternPerformance {
  id                 String    @id @default(cuid())
  patternId          String
  companyId          String
  conversationId     String?
  usageCount         Int       @default(0) // Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
  successCount       Int       @default(0) // Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ù†Ø¬Ø§Ø­
  failureCount       Int       @default(0) // Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„ÙØ´Ù„
  currentSuccessRate Float     @default(0) // Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­ Ø§Ù„Ø­Ø§Ù„ÙŠ
  lastUsedAt         DateTime? // Ø¢Ø®Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù…
  performanceTrend   String    @default("stable") // "up", "down", "stable"
  impactScore        Float     @default(0) // Ø¯Ø±Ø¬Ø© Ø§Ù„ØªØ£Ø«ÙŠØ± (0-10)
  roi                Float     @default(0) // Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±
  metadata           String?   @db.Text // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  // Relations
  pattern SuccessPattern @relation(fields: [patternId], references: [id], onDelete: Cascade)
  company Company        @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([patternId])
  @@index([companyId])
  @@index([currentSuccessRate])
  @@index([lastUsedAt])
  @@index([performanceTrend])
  @@map("pattern_performance")
}

model PatternUsage {
  id               String   @id @default(cuid())
  patternId        String
  conversationId   String
  companyId        String
  applied          Boolean  @default(true) // ØªÙ… ØªØ·Ø¨ÙŠÙ‚Ù‡ Ø£Ù… Ù„Ø§
  effectiveness    Float? // ÙØ¹Ø§Ù„ÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (0-1)
  customerReaction String? // Ø±Ø¯ ÙØ¹Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„
  outcomeImpact    String? // ØªØ£Ø«ÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªÙŠØ¬Ø©
  responseTime     Int? // ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©
  metadata         String?  @db.Text
  createdAt        DateTime @default(now())

  // Relations
  pattern SuccessPattern @relation(fields: [patternId], references: [id], onDelete: Cascade)
  company Company        @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([patternId])
  @@index([conversationId])
  @@index([companyId])
  @@index([applied])
  @@index([createdAt])
  @@map("pattern_usage")
}

model ConversationOutcome {
  id                   String   @id @default(cuid())
  conversationId       String
  customerId           String
  companyId            String
  outcome              String // 'purchase', 'abandoned', 'escalated', 'resolved'
  outcomeValue         Float? // Ù‚ÙŠÙ…Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© (Ù…Ø¨Ù„Øº Ø§Ù„Ø´Ø±Ø§Ø¡ Ù…Ø«Ù„Ø§Ù‹)
  responseQuality      Float? // ØªÙ‚ÙŠÙŠÙ… Ø¬ÙˆØ¯Ø© Ø§Ù„Ø±Ø¯ÙˆØ¯ (0-10)
  customerSatisfaction Float? // Ø±Ø¶Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ (0-5)
  conversionTime       Int? // ÙˆÙ‚Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚
  messageCount         Int? // Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
  aiResponseCount      Int? // Ø¹Ø¯Ø¯ Ø±Ø¯ÙˆØ¯ AI
  humanHandoff         Boolean  @default(false)
  metadata             String?  @db.Text
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  company              Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  customer             Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([companyId])
  @@index([outcome])
  @@index([createdAt])
  @@map("conversation_outcomes")
}

model ResponseEffectiveness {
  id                 String   @id @default(cuid())
  companyId          String
  messageId          String? // ID Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©
  conversationId     String
  responseText       String   @db.Text
  responseType       String // 'greeting', 'product_info', 'price_quote', 'closing'
  customerReaction   String? // 'positive', 'negative', 'neutral', 'purchase'
  effectivenessScore Float // Ø¯Ø±Ø¬Ø© Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ© (0-10)
  leadToPurchase     Boolean  @default(false)
  responseTime       Int? // ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø¨Ø§Ù„Ù…ÙŠÙ„ÙŠ Ø«Ø§Ù†ÙŠØ©
  wordCount          Int? // Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª
  sentimentScore     Float? // Ø¯Ø±Ø¬Ø© Ø§Ù„Ù…Ø´Ø§Ø¹Ø±
  keywords           String?  @db.Text // Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©
  metadata           String?  @db.Text
  createdAt          DateTime @default(now())
  company            Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([conversationId])
  @@index([responseType])
  @@index([effectivenessScore])
  @@index([leadToPurchase])
  @@index([createdAt])
  @@map("response_effectiveness")
}

// Task Management Models
model Task {
  id             String       @id @default(cuid())
  projectId      String?
  title          String
  description    String       @db.Text
  status         TaskStatus   @default(PENDING)
  priority       TaskPriority @default(MEDIUM)
  type           String       @default("general")
  assignedTo     String
  createdBy      String
  dueDate        DateTime?
  estimatedHours Int          @default(0)
  actualHours    Int          @default(0)
  progress       Int          @default(0) // 0-100
  tags           Json?
  dependencies   Json?
  companyId      String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  // Relations
  project       Project? @relation(fields: [projectId], references: [id])
  company       Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  assignedUser  User     @relation("TaskAssignedTo", fields: [assignedTo], references: [id])
  createdByUser User     @relation("TaskCreatedBy", fields: [createdBy], references: [id])

  @@index([companyId])
  @@index([projectId])
  @@index([assignedTo])
  @@index([status])
  @@index([priority])
  @@index([dueDate])
  @@map("tasks")
}

model Project {
  id          String        @id @default(cuid())
  name        String
  description String        @db.Text
  status      ProjectStatus @default(PLANNING)
  priority    TaskPriority  @default(MEDIUM)
  startDate   DateTime?
  endDate     DateTime?
  budget      Decimal?      @db.Decimal(10, 2)
  spentBudget Decimal?      @default(0.00) @db.Decimal(10, 2)
  progress    Int           @default(0) // 0-100
  managerId   String
  teamMembers Json?
  tags        Json?
  companyId   String
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  // Relations
  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  manager User    @relation(fields: [managerId], references: [id])
  tasks   Task[]

  @@index([companyId])
  @@index([managerId])
  @@index([status])
  @@index([priority])
  @@map("projects")
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum ProjectStatus {
  PLANNING
  ACTIVE
  COMPLETED
  ON_HOLD
}

enum UserRole {
  SUPER_ADMIN
  COMPANY_ADMIN
  MANAGER
  AGENT
}

enum SubscriptionPlan {
  BASIC
  PRO
  ENTERPRISE
}

enum SubscriptionStatus {
  ACTIVE
  INACTIVE
  CANCELLED
  EXPIRED
  TRIAL
  SUSPENDED
}

enum InvoiceStatus {
  DRAFT
  SENT
  PAID
  OVERDUE
  CANCELLED
  REFUNDED
}

enum InvoiceType {
  SUBSCRIPTION
  ONE_TIME
  UPGRADE
  DOWNGRADE
  REFUND
}

enum CustomerStatus {
  LEAD
  PROSPECT
  CUSTOMER
  VIP
  INACTIVE
}

enum CommunicationChannel {
  FACEBOOK
  WHATSAPP
  TELEGRAM
  EMAIL
  SMS
  PHONE
  WEBSITE
  TEST
}

enum ConversationStatus {
  ACTIVE
  PENDING
  RESOLVED
  CLOSED
}

enum MessageType {
  TEXT
  IMAGE
  VIDEO
  AUDIO
  FILE
  LOCATION
  STICKER
  EMOJI
  TEMPLATE
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum PaymentMethod {
  CASH
  CREDIT_CARD
  BANK_TRANSFER
  PAYPAL
  STRIPE
}

enum StockMovementType {
  IN
  OUT
  ADJUSTMENT
  TRANSFER
  RETURN
}

enum StockMovementReason {
  PURCHASE
  SALE
  DAMAGE
  EXPIRED
  LOST
  FOUND
  TRANSFER
  RETURN
  ADJUSTMENT
}

enum AlertPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum AlertType {
  LOW_STOCK
  OUT_OF_STOCK
  OVERSTOCK
  EXPIRY_WARNING
}

model PlanConfiguration {
  id            String    @id @default(cuid())
  planType      String    @unique
  price         Float
  currency      String    @default("EGP")
  billingCycle  String    @default("monthly")
  features      Json
  description   String?
  descriptionEn String?
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  companies     Company[]

  @@map("plan_configurations")
}

model Subscription {
  id              String             @id @default(cuid())
  companyId       String
  planType        SubscriptionPlan
  status          SubscriptionStatus @default(ACTIVE)
  startDate       DateTime           @default(now())
  endDate         DateTime?
  nextBillingDate DateTime?
  billingCycle    String             @default("monthly") // monthly, yearly
  price           Float
  currency        String             @default("EGP")
  autoRenew       Boolean            @default(true)
  trialEndDate    DateTime?
  cancelledAt     DateTime?
  cancelReason    String?
  metadata        Json?
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt

  // Relations
  company  Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  invoices Invoice[]
  payments Payment[]

  @@map("subscriptions")
}

model Invoice {
  id             String        @id @default(cuid())
  invoiceNumber  String        @unique
  subscriptionId String?
  companyId      String
  status         InvoiceStatus @default(DRAFT)
  type           InvoiceType   @default(SUBSCRIPTION)
  issueDate      DateTime      @default(now())
  dueDate        DateTime
  paidDate       DateTime?
  subtotal       Float
  taxAmount      Float         @default(0)
  discountAmount Float         @default(0)
  totalAmount    Float
  currency       String        @default("EGP")
  notes          String?
  paymentTerms   String?       @default("Net 30")
  metadata       Json?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  // Relations
  company         Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  subscription    Subscription?    @relation(fields: [subscriptionId], references: [id])
  items           InvoiceItem[]
  payments        Payment[]
  paymentReceipts PaymentReceipt[]

  @@map("invoices")
}

model InvoiceItem {
  id          String   @id @default(cuid())
  invoiceId   String
  description String
  quantity    Float    @default(1)
  unitPrice   Float
  totalPrice  Float
  metadata    Json?
  createdAt   DateTime @default(now())

  // Relations
  invoice Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@map("invoice_items")
}

model Payment {
  id               String        @id @default(cuid())
  paymentNumber    String        @unique
  invoiceId        String?
  subscriptionId   String?
  companyId        String
  amount           Float
  currency         String        @default("EGP")
  status           PaymentStatus @default(PENDING)
  method           PaymentMethod @default(BANK_TRANSFER)
  gateway          String? // stripe, paypal, etc.
  gatewayPaymentId String?
  transactionId    String?
  paidAt           DateTime?
  failedAt         DateTime?
  failureReason    String?
  metadata         Json?
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  // Relations
  company      Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  invoice      Invoice?      @relation(fields: [invoiceId], references: [id])
  subscription Subscription? @relation(fields: [subscriptionId], references: [id])

  @@map("payments")
}

// Ø¬Ø¯ÙˆÙ„ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù…Ø­Ø§ÙØ¸
model WalletNumber {
  id        String   @id @default(cuid())
  name      String // "ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´"
  number    String // "01234567890"
  isActive  Boolean  @default(true)
  icon      String // "ğŸ“±"
  color     String // "#E60026"
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  paymentReceipts PaymentReceipt[]

  @@map("wallet_numbers")
}

// Ø¬Ø¯ÙˆÙ„ Ø¥ÙŠØµØ§Ù„Ø§Øª Ø§Ù„Ø¯ÙØ¹
model PaymentReceipt {
  id             String    @id @default(cuid())
  invoiceId      String
  walletNumberId String
  receiptImage   String // Ù…Ø³Ø§Ø± Ø§Ù„ØµÙˆØ±Ø©
  status         String    @default("PENDING") // PENDING, APPROVED, REJECTED
  submittedAt    DateTime  @default(now())
  reviewedAt     DateTime?
  reviewedBy     String? // Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹
  notes          String? // Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  // Relations
  invoice      Invoice      @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  walletNumber WalletNumber @relation(fields: [walletNumberId], references: [id], onDelete: Cascade)

  @@map("payment_receipts")
}

enum NotificationType {
  ERROR
  WARNING
  INFO
  SUCCESS
  SYSTEM_ALERT
}

model SystemSettings {
  id               String    @id @default(cuid())
  systemName       String    @unique
  displayName      String
  description      String?
  category         String    @default("general")
  isEnabled        Boolean   @default(true)
  config           Json?
  resourceUsage    Json?
  lastStatusChange DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  @@map("system_settings")
}

// ==================== BROADCAST MODELS ====================

model BroadcastCampaign {
  id             String    @id @default(cuid())
  name           String
  message        String    @db.Text
  targetAudience String
  scheduledAt    DateTime?
  sentAt         DateTime?
  tags           Json?
  priority       String    @default("medium")
  includeImages  Boolean   @default(false)
  trackClicks    Boolean   @default(true)
  autoResend     Boolean   @default(false)
  images         Json?
  status         String    @default("draft")
  recipientCount Int       @default(0)
  sentCount      Int       @default(0)
  deliveredCount Int       @default(0)
  openedCount    Int       @default(0)
  clickedCount   Int       @default(0)
  failedCount    Int       @default(0)
  companyId      String
  creatorId      String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  company    Company              @relation(fields: [companyId], references: [id], onDelete: Cascade)
  recipients BroadcastRecipient[]

  @@index([companyId])
  @@index([status])
  @@index([scheduledAt])
  @@map("broadcast_campaigns")
}

model BroadcastSettings {
  id                           String   @id @default(cuid())
  companyId                    String   @unique
  defaultSendTime              String   @default("10:00")
  timezone                     String   @default("Asia/Riyadh")
  maxRecipientsPerCampaign     Int      @default(5000)
  maxCampaignsPerDay           Int      @default(10)
  enableDeliveryReports        Boolean  @default(true)
  enableOpenTracking           Boolean  @default(true)
  enableClickTracking          Boolean  @default(true)
  enableUnsubscribeTracking    Boolean  @default(true)
  notifyOnCampaignSent         Boolean  @default(true)
  notifyOnHighUnsubscribeRate  Boolean  @default(true)
  notifyOnLowDeliveryRate      Boolean  @default(true)
  adminEmail                   String?
  requireApprovalForHighVolume Boolean  @default(false)
  highVolumeThreshold          Int      @default(1000)
  enableContentFiltering       Boolean  @default(false)
  blockedWords                 Json?
  messagesPerMinute            Int      @default(60)
  messagesPerHour              Int      @default(1000)
  messagesPerDay               Int      @default(10000)
  defaultFooter                String?  @db.Text
  unsubscribeText              String   @default("Ù„Ù„Ø¥Ù„ØºØ§Ø¡ Ø§ÙƒØªØ¨ STOP")
  companyName                  String?
  companyAddress               String?
  createdAt                    DateTime @default(now())
  updatedAt                    DateTime @updatedAt

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@map("broadcast_settings")
}

model BroadcastRecipient {
  id              String    @id @default(cuid())
  campaignId      String
  conversationId  String
  customerPhone   String
  customerName    String?
  messengerUserId String?
  status          String    @default("pending")
  sentAt          DateTime?
  deliveredAt     DateTime?
  openedAt        DateTime?
  clickedAt       DateTime?
  repliedAt       DateTime?
  failureReason   String?   @db.Text
  messageId       String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  campaign     BroadcastCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  conversation Conversation      @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([campaignId])
  @@index([conversationId])
  @@index([status])
  @@map("broadcast_recipients")
}

model CustomerList {
  id          String   @id @default(cuid())
  name        String
  description String?  @db.Text
  criteria    Json
  count       Int      @default(0)
  isDefault   Boolean  @default(false)
  companyId   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("customer_lists")
}

// NEW: Model for Facebook Comments
model FacebookComment {
  id          String    @id @default(cuid())
  commentId   String    @unique
  postId      String
  senderId    String
  senderName  String
  message     String    @db.Text
  response    String?   @db.Text
  createdTime DateTime
  respondedAt DateTime?
  pageId      String?
  companyId   String? // Make it optional like FacebookPage
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  company Company? @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([commentId])
  @@index([postId])
  @@index([senderId])
  @@index([companyId])
  @@index([createdTime])
  @@map("facebook_comments")
}

// NEW: Model for Post Response Settings
model PostResponseSettings {
  id                    String   @id @default(cuid())
  postId                String
  companyId             String
  responseMethod        String // 'ai', 'fixed', 'manual'
  commentMessages       String?  @db.Text // JSON array of comment response variations
  fixedMessengerMessage String?  @db.Text // Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø«Ø§Ø¨ØªØ© ÙÙŠ Ø§Ù„Ù…Ø§Ø³Ù†Ø¬Ø±
  aiPrompt              String?  @db.Text // Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ù€ AI Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¨ÙˆØ³Øª
  featuredProductId     String? // ğŸ¯ Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù…Ù…ÙŠØ² Ù„Ù„Ø¨ÙˆØ³Øª
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  company         Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  featuredProduct Product? @relation(fields: [featuredProductId], references: [id], onDelete: SetNull)

  @@unique([postId, companyId])
  @@index([postId])
  @@index([companyId])
  @@index([featuredProductId])
  @@map("post_response_settings")
}

// NEW: Model for Page Response Settings (Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø©)
model PageResponseSettings {
  id                    String   @id @default(cuid())
  pageId                String
  companyId             String
  responseMethod        String // 'ai', 'fixed', 'manual'
  commentMessages       String?  @db.Text // JSON array of comment response variations
  fixedMessengerMessage String?  @db.Text // Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø«Ø§Ø¨ØªØ© ÙÙŠ Ø§Ù„Ù…Ø§Ø³Ù†Ø¬Ø±
  aiPrompt              String?  @db.Text // Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ù€ AI Ù„Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([pageId, companyId])
  @@index([pageId])
  @@index([companyId])
  @@map("page_response_settings")
}

// ğŸª Model for Store Branches
model Branch {
  id           String   @id @default(cuid())
  name         String
  address      String? // Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„Ù„ÙØ±ÙˆØ¹ Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†
  city         String? // Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„Ù„ÙØ±ÙˆØ¹ Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†
  phone        String
  email        String?
  workingHours String?
  isActive     Boolean  @default(true)
  companyId    String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([isActive])
  @@map("branches")
}

// ğŸšš Model for Shipping Zones
model ShippingZone {
  id           String   @id @default(cuid())
  governorates Json // Array of governorate name variations stored as single JSON field
  price        Decimal  @db.Decimal(10, 2)
  deliveryTime String // e.g., "1-2 Ø£ÙŠØ§Ù…"
  isActive     Boolean  @default(true)
  companyId    String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([isActive])
  @@map("shipping_zones")
}

// ğŸ›’ Model for Guest Carts (Public Storefront)
model GuestCart {
  id        String   @id @default(cuid())
  cartId    String   @unique // UUID for cart identification
  items     Json // Array of cart items with product details
  total     Decimal  @default(0) @db.Decimal(10, 2)
  companyId String
  expiresAt DateTime // Cart expiration date
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([cartId])
  @@index([companyId])
  @@index([expiresAt])
  @@map("guest_carts")
}

// ğŸ“¦ Model for Guest Orders (Public Storefront)
model GuestOrder {
  id              String   @id @default(cuid())
  orderNumber     String   @unique // Human-readable order number
  guestEmail      String
  guestPhone      String
  guestName       String
  items           Json // Array of order items with product details
  total           Decimal  @db.Decimal(10, 2)
  shippingCost    Decimal  @default(0) @db.Decimal(10, 2)
  discountAmount  Decimal  @default(0) @db.Decimal(10, 2)
  finalTotal      Decimal  @db.Decimal(10, 2)
  shippingAddress Json // Shipping address details
  paymentMethod   String // e.g., "cash_on_delivery", "credit_card"
  status          String   @default("pending") // e.g., "pending", "confirmed", "shipped", "delivered", "cancelled"
  notes           String?  @db.Text
  companyId       String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([orderNumber])
  @@index([guestEmail])
  @@index([companyId])
  @@index([status])
  @@index([createdAt])
  @@map("guest_orders")
}

// ğŸ“‹ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙÙˆØ±Ù… Ø§Ù„Ø´ÙŠÙƒ Ø£ÙˆØª
model CheckoutFormSettings {
  id        String @id @default(cuid())
  companyId String @unique

  // Ø­Ù‚ÙˆÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
  showGuestName     Boolean @default(true)
  requireGuestName  Boolean @default(true)
  showGuestPhone    Boolean @default(true)
  requireGuestPhone Boolean @default(true)
  showGuestEmail    Boolean @default(true)
  requireGuestEmail Boolean @default(false)

  // Ø­Ù‚ÙˆÙ„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø´Ø­Ù†
  showCity               Boolean @default(true)
  requireCity            Boolean @default(true)
  showShippingAddress    Boolean @default(true)
  requireShippingAddress Boolean @default(true)

  // Ø­Ù‚ÙˆÙ„ Ø¥Ø¶Ø§ÙÙŠØ©
  showPaymentMethod Boolean @default(true)
  showNotes         Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("checkout_form_settings")
}

// ============================================
// ğŸ¯ AOV Optimization Models (Ø²ÙŠØ§Ø¯Ø© Ù…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨)
// ============================================

// ğŸ“¦ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ±ÙˆÙŠØ¬ Ù„Ù„Ù…ØªØ¬Ø± (Ø§Ù„Ø´Ø­Ù† Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ)
model StorePromotionSettings {
  id        String @id @default(cuid())
  companyId String @unique

  // Free Shipping Settings
  freeShippingEnabled   Boolean @default(false)
  freeShippingThreshold Decimal @default(0) @db.Decimal(10, 2)
  freeShippingMessage   String? @db.Text // "Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø´Ø­Ù† Ù…Ø¬Ø§Ù†ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨Ù€ {amount} Ø¬Ù†ÙŠÙ‡"

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("store_promotion_settings")
}

// ğŸ›ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…ØªØ¬Ø± (Storefront Features)
model StorefrontSettings {
  id        String @id @default(cuid())
  companyId String @unique

  // Quick View Settings
  quickViewEnabled       Boolean @default(true)
  quickViewShowAddToCart Boolean @default(true)
  quickViewShowWishlist  Boolean @default(true)

  // Product Comparison Settings
  comparisonEnabled     Boolean @default(true)
  maxComparisonProducts Int     @default(4)
  comparisonShowPrice   Boolean @default(true)
  comparisonShowSpecs   Boolean @default(true)

  // Wishlist Settings
  wishlistEnabled      Boolean @default(true)
  wishlistRequireLogin Boolean @default(false)
  wishlistMaxItems     Int     @default(100)

  // Advanced Filters Settings
  advancedFiltersEnabled Boolean @default(true)
  filterByPrice          Boolean @default(true)
  filterByRating         Boolean @default(true)
  filterByBrand          Boolean @default(false)
  filterByAttributes     Boolean @default(true)

  // Reviews & Ratings Settings
  reviewsEnabled           Boolean @default(true)
  reviewsRequirePurchase   Boolean @default(false)
  reviewsModerationEnabled Boolean @default(true)
  reviewsShowRating        Boolean @default(true)
  minRatingToDisplay       Int     @default(1)

  // Countdown Timer Settings
  countdownEnabled       Boolean @default(true)
  countdownShowOnProduct Boolean @default(true)
  countdownShowOnListing Boolean @default(false)

  // Back in Stock Settings
  backInStockEnabled     Boolean @default(true)
  backInStockNotifyEmail Boolean @default(true)
  backInStockNotifySMS   Boolean @default(false)

  // Recently Viewed Settings
  recentlyViewedEnabled Boolean @default(true)
  recentlyViewedCount   Int     @default(8)
  recentlyViewedDays    Int     @default(30)

  // Image Zoom Settings
  imageZoomEnabled Boolean @default(true)
  imageZoomType    String  @default("hover") // "hover" | "click" | "both"

  // Product Videos Settings
  productVideosEnabled Boolean @default(true)
  videoAutoplay        Boolean @default(false)
  videoShowControls    Boolean @default(true)

  // Size Guide Settings
  sizeGuideEnabled       Boolean @default(true)
  sizeGuideShowOnProduct Boolean @default(true)

  // Social Sharing Settings
  socialSharingEnabled Boolean @default(true)
  shareFacebook        Boolean @default(true)
  shareTwitter         Boolean @default(true)
  shareWhatsApp        Boolean @default(true)
  shareTelegram        Boolean @default(true)

  // Product Badges Settings
  badgesEnabled   Boolean @default(true)
  badgeNew        Boolean @default(true)
  badgeBestSeller Boolean @default(true)
  badgeOnSale     Boolean @default(true)
  badgeOutOfStock Boolean @default(true)

  // Product Tabs Settings
  tabsEnabled       Boolean @default(true)
  tabDescription    Boolean @default(true)
  tabSpecifications Boolean @default(true)
  tabReviews        Boolean @default(true)
  tabShipping       Boolean @default(true)

  // Sticky Add to Cart Settings
  stickyAddToCartEnabled     Boolean @default(true)
  stickyShowOnMobile         Boolean @default(true)
  stickyShowOnDesktop        Boolean @default(true)
  stickyScrollThreshold      Int     @default(300) // Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨Ø§Ù„Ø¨ÙƒØ³Ù„ Ù‚Ø¨Ù„ Ø§Ù„Ø¸Ù‡ÙˆØ±
  stickyShowBuyNow           Boolean @default(true) // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± "Ø´Ø±Ø§Ø¡ Ø§Ù„Ø¢Ù†"
  stickyShowAddToCartButton  Boolean @default(true) // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± "Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©"
  stickyShowQuantity         Boolean @default(true) // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙƒÙ…ÙŠØ©
  stickyShowProductImage     Boolean @default(true) // Ø¥Ø¸Ù‡Ø§Ø± ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬
  stickyShowProductName      Boolean @default(true) // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬
  stickyTrackAnalytics       Boolean @default(true) // ØªØªØ¨Ø¹ Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª
  stickyAutoScrollToCheckout Boolean @default(false) // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„ØµÙØ­Ø© Ø§Ù„Ø´Ø±Ø§Ø¡

  // SEO Settings
  seoEnabled         Boolean @default(true)
  seoMetaDescription Boolean @default(true)
  seoStructuredData  Boolean @default(true)
  seoSitemap         Boolean @default(true)
  seoOpenGraph       Boolean @default(true)

  // Multi-language Settings
  multiLanguageEnabled Boolean @default(false)
  defaultLanguage      String  @default("ar")
  supportedLanguages   Json // ["ar", "en", "fr"]

  // ==========================================
  // ğŸ“Š Facebook Pixel Settings (Browser-side)
  // ==========================================
  facebookPixelEnabled       Boolean @default(false)
  facebookPixelId            String?
  pixelTrackPageView         Boolean @default(true)
  pixelTrackViewContent      Boolean @default(true)
  pixelTrackAddToCart        Boolean @default(true)
  pixelTrackInitiateCheckout Boolean @default(true)
  pixelTrackPurchase         Boolean @default(true)
  pixelTrackSearch           Boolean @default(true)
  pixelTrackAddToWishlist    Boolean @default(false)

  // ==========================================
  // ğŸš€ Facebook Conversions API (Server-side)
  // ==========================================
  facebookConvApiEnabled     Boolean @default(false)
  facebookConvApiToken       String? @db.Text
  facebookConvApiTestCode    String?
  capiTrackPageView          Boolean @default(true)
  capiTrackViewContent       Boolean @default(true)
  capiTrackAddToCart         Boolean @default(true)
  capiTrackInitiateCheckout  Boolean @default(true)
  capiTrackPurchase          Boolean @default(true)
  capiTrackSearch            Boolean @default(true)

  // ==========================================
  // âš™ï¸ Advanced Settings
  // ==========================================
  eventDeduplicationEnabled Boolean  @default(true)
  eventMatchQualityTarget   Int      @default(8)
  gdprCompliant             Boolean  @default(true)
  hashUserData              Boolean  @default(true)
  lastPixelTest             DateTime?
  lastCapiTest              DateTime?
  pixelStatus               String?  @default("not_configured") // not_configured, active, error
  capiStatus                String?  @default("not_configured")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([facebookPixelEnabled])
  @@index([facebookConvApiEnabled])
  @@map("storefront_settings")
}

// ğŸšš Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„ Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©
model DeliveryOption {
  id           String   @id @default(cuid())
  name         String // "ØªÙˆØµÙŠÙ„ Ø¹Ø§Ø¯ÙŠ", "ØªÙˆØµÙŠÙ„ Ø³Ø±ÙŠØ¹", "ØªÙˆØµÙŠÙ„ ÙÙˆØ±ÙŠ"
  description  String?  @db.Text
  deliveryTime String // "3-5 Ø£ÙŠØ§Ù…", "1-2 ÙŠÙˆÙ…", "Ù†ÙØ³ Ø§Ù„ÙŠÙˆÙ…"
  price        Decimal  @db.Decimal(10, 2)
  isDefault    Boolean  @default(false)
  isActive     Boolean  @default(true)
  icon         String? // Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù„Ù„Ø¹Ø±Ø¶
  sortOrder    Int      @default(0)
  companyId    String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([isActive])
  @@map("delivery_options")
}

// ğŸ–¼ï¸ Ø­Ø§ÙØ¸Ø© Ø§Ù„ØµÙˆØ± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
model ImageGallery {
  id        String   @id @default(cuid())
  userId    String
  companyId String
  filename  String
  fileUrl   String
  fileType  String // e.g., "image/jpeg", "image/png"
  fileSize  Int // size in bytes
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([companyId])
  @@index([createdAt])
  @@map("image_gallery")
}

// ğŸ“Š Model for Post Tracking (ØªØªØ¨Ø¹ Ø§Ù„Ø¨ÙˆØ³ØªØ§Øª)
model PostTracking {
  id           String   @id @default(cuid())
  postId       String
  companyId    String
  visitCount   Int      @default(1) // Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª
  firstVisitAt DateTime @default(now()) // ØªØ§Ø±ÙŠØ® Ø£ÙˆÙ„ Ø²ÙŠØ§Ø±Ø©
  lastVisitAt  DateTime @default(now()) // ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± Ø²ÙŠØ§Ø±Ø©
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([postId, companyId])
  @@index([postId])
  @@index([companyId])
  @@index([lastVisitAt])
  @@map("post_tracking")
}

// ğŸª Model for Footer Settings (Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙÙˆØªØ±)
model FooterSettings {
  id        String @id @default(cuid())
  companyId String @unique

  // About Store Section
  aboutStore     String? @db.Text
  showAboutStore Boolean @default(true)

  // Contact Information
  email       String?
  showEmail   Boolean @default(true)
  phone       String?
  showPhone   Boolean @default(true)
  address     String? @db.Text
  showAddress Boolean @default(true)

  // Quick Links Section
  showQuickLinks Boolean @default(true)

  // Copyright
  copyrightText String? @db.Text
  showCopyright Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("footer_settings")
}

// â¤ï¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±ØºØ¨Ø§Øª (Wishlist)
model Wishlist {
  id          String   @id @default(cuid())
  sessionId   String
  customerId  String?
  productId   String
  variantId   String?
  companyId   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  @@unique([sessionId, productId, variantId, companyId])
  @@index([sessionId])
  @@index([customerId])
  @@index([companyId])
  @@map("wishlists")
}

// ğŸ‘ï¸ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ù…Ø¤Ø®Ø±Ø§Ù‹ (Recently Viewed)
model RecentlyViewed {
  id          String   @id @default(cuid())
  sessionId   String
  productId   String
  companyId   String
  viewedAt    DateTime @default(now())
  
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  @@unique([sessionId, productId, companyId])
  @@index([sessionId, companyId])
  @@index([viewedAt])
  @@map("recently_viewed")
}

// â­ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª (Reviews & Ratings)
model ProductReview {
  id              String   @id @default(cuid())
  productId       String
  companyId       String
  customerName    String
  customerEmail   String?
  customerPhone   String?
  rating          Int      // 1-5
  title           String?
  comment         String?  @db.Text
  isVerified      Boolean  @default(false) // ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø´Ø±Ø§Ø¡
  isApproved      Boolean  @default(false) // ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
  helpfulCount    Int      @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  product         Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  company         Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  @@index([productId])
  @@index([companyId])
  @@index([isApproved])
  @@index([rating])
  @@map("product_reviews")
}

// ğŸ”” Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ø®Ø²ÙˆÙ† (Back in Stock Notifications)
model BackInStockNotification {
  id          String   @id @default(cuid())
  productId   String
  companyId   String
  customerName String
  customerEmail String?
  customerPhone String?
  notifyEmail Boolean  @default(true)
  notifySMS   Boolean  @default(false)
  isNotified  Boolean  @default(false)
  notifiedAt  DateTime?
  createdAt   DateTime @default(now())
  
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  @@index([productId])
  @@index([companyId])
  @@index([isNotified])
  @@map("back_in_stock_notifications")
}

// ğŸ“„ ØµÙØ­Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ®ØµÙŠØµ (Store Pages)
model StorePage {
  id          String   @id @default(cuid())
  companyId   String
  
  // Page Information
  title       String
  slug        String   // URL-friendly identifier (e.g., "shipping-policy")
  content     String   @db.Text
  
  // Page Type
  pageType    StorePageType @default(CUSTOM)
  
  // Display Settings
  isActive    Boolean  @default(true)
  showInFooter Boolean @default(true)
  showInMenu  Boolean  @default(false)
  order       Int      @default(0) // Display order
  
  // SEO
  metaTitle       String?
  metaDescription String? @db.Text
  
  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  @@unique([companyId, slug])
  @@index([companyId])
  @@index([slug])
  @@index([isActive])
  @@map("store_pages")
}

enum StorePageType {
  SHIPPING_POLICY      // Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø´Ø­Ù†
  RETURN_POLICY        // Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹
  REFUND_POLICY        // Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ù…Ø§Ù„ÙŠ
  PRIVACY_POLICY       // Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©
  TERMS_CONDITIONS     // Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…
  ABOUT_US             // Ø¹Ù† Ø§Ù„Ù…ØªØ¬Ø±
  CONTACT_US           // Ø§ØªØµÙ„ Ø¨Ù†Ø§
  FAQ                  // Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
  PAYMENT_METHODS      // Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹
  CUSTOM               // ØµÙØ­Ø© Ù…Ø®ØµØµØ©
}

// ğŸŸï¸ Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª ÙˆØ§Ù„Ø®ØµÙˆÙ…Ø§Øª
model Coupon {
  id                String       @id @default(cuid())
  companyId         String
  
  // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†
  code              String       // ÙƒÙˆØ¯ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ† (Ù…Ø«Ù„: SUMMER2024)
  name              String       // Ø§Ø³Ù… Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†
  description       String?      @db.Text
  
  // Ù†ÙˆØ¹ Ø§Ù„Ø®ØµÙ…
  type              CouponType   @default(PERCENTAGE)
  value             Decimal      @db.Decimal(10, 2) // Ø§Ù„Ù‚ÙŠÙ…Ø© (Ù†Ø³Ø¨Ø© Ù…Ø¦ÙˆÙŠØ© Ø£Ùˆ Ù…Ø¨Ù„Øº Ø«Ø§Ø¨Øª)
  
  // Ø´Ø±ÙˆØ· Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
  minOrderAmount    Decimal?     @db.Decimal(10, 2) // Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨
  maxDiscountAmount Decimal?     @db.Decimal(10, 2) // Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø®ØµÙ… (Ù„Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©)
  
  // Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
  usageLimit        Int?         // Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒÙ„ÙŠ
  usageCount        Int          @default(0) // Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙØ¹Ù„ÙŠ
  userUsageLimit    Int?         // Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù„ÙƒÙ„ Ø¹Ù…ÙŠÙ„
  
  // ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†
  validFrom         DateTime
  validTo           DateTime
  
  // Ø§Ù„Ø­Ø§Ù„Ø©
  isActive          Boolean      @default(true)
  
  // ÙØ¦Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©
  customerSegments  String?      @db.Text // JSON array: ["all", "new", "VIP", "regular"]
  
  // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØµÙÙŠØ©
  metadata          String?      @db.Text // Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
  
  // Ù…Ù† Ø£Ù†Ø´Ø£ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†
  createdBy         String?
  
  // Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  
  company           Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  usages            CouponUsage[]
  
  @@unique([companyId, code])
  @@index([companyId])
  @@index([code])
  @@index([isActive])
  @@index([validFrom, validTo])
  @@map("coupons")
}

// ğŸ“Š Ø³Ø¬Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª
model CouponUsage {
  id          String   @id @default(cuid())
  couponId    String
  companyId   String
  customerId  String?
  orderId     String?
  
  // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
  discountAmount Decimal @db.Decimal(10, 2)
  orderAmount    Decimal @db.Decimal(10, 2)
  
  // Ø§Ù„ØªØ§Ø±ÙŠØ®
  usedAt      DateTime @default(now())
  
  coupon      Coupon   @relation(fields: [couponId], references: [id], onDelete: Cascade)
  
  @@index([couponId])
  @@index([companyId])
  @@index([customerId])
  @@index([orderId])
  @@index([usedAt])
  @@map("coupon_usages")
}

enum CouponType {
  PERCENTAGE     // Ù†Ø³Ø¨Ø© Ù…Ø¦ÙˆÙŠØ© (Ù…Ø«Ù„: 10%)
  FIXED          // Ù…Ø¨Ù„Øº Ø«Ø§Ø¨Øª (Ù…Ø«Ù„: 50 Ø¬Ù†ÙŠÙ‡)
  FREE_SHIPPING  // Ø´Ø­Ù† Ù…Ø¬Ø§Ù†ÙŠ
}

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Company {
  id                         String                      @id @default(cuid())
  name                       String
  email                      String                      @unique
  phone                      String?
  website                    String?
  logo                       String?
  address                    String?
  currency                   String                      @default("EGP")
  plan                       SubscriptionPlan            @default(BASIC)
  planConfigurationId        String?
  isActive                   Boolean                     @default(true)
  settings                   String?                     @db.Text
  createdAt                  DateTime                    @default(now())
  updatedAt                  DateTime                    @updatedAt
  slug                       String?                     @unique
  facebookUserAccessToken    String?                     @db.Text
  facebookPixelAccessToken   String?                     @db.Text
  useCentralKeys             Boolean                     @default(false)
  facebookAdsAccessToken     String?                     @db.Text
  supportTickets             SupportTicket[]
  aiInteractions             AiInteraction[]
  aiSettings                 AiSettings?
  appliedImprovements        AppliedImprovement[]
  backInStockNotifications   BackInStockNotification[]
  branches                   Branch[]
  broadcastCampaigns         BroadcastCampaign[]
  broadcastSettings          BroadcastSettings?
  categories                 Category[]
  checkoutFormSettings       CheckoutFormSettings?
  planConfiguration          PlanConfiguration?          @relation(fields: [planConfigurationId], references: [id])
  conversationMemories       ConversationMemory[]
  conversationOutcomes       ConversationOutcome[]
  conversations              Conversation[]
  coupons                    Coupon[]
  customerLists              CustomerList[]
  customers                  Customer[]
  deliveryOptions            DeliveryOption[]
  discoveredPatterns         DiscoveredPattern[]
  facebookAdAccounts         FacebookAdAccount[]
  facebookAdTests            FacebookAdTest[]
  facebookCampaigns          FacebookCampaign[]
  facebookComments           FacebookComment[]
  facebookCustomAudiences    FacebookCustomAudience[]
  facebookDynamicAds         FacebookDynamicAd[]
  facebookLookalikeAudiences FacebookLookalikeAudience[]
  facebookPages              FacebookPage[]
  facebookProductCatalogs    FacebookProductCatalog[]
  footerSettings             FooterSettings?
  geminiKeys                 GeminiKey[]
  guestCarts                 GuestCart[]
  guestOrders                GuestOrder[]
  homepageTemplates          HomepageTemplate[]
  attendance                 Attendance[]
  benefitEnrollments         BenefitEnrollment[]
  benefits                   Benefit[]
  departments                Department[]
  employeeDocuments          EmployeeDocument[]
  employeeTrainings          EmployeeTraining[]
  employeeWarnings           EmployeeWarning[]
  employees                  Employee[]
  feedback                   Feedback[]
  goals                      Goal[]
  leaveRequests              LeaveRequest[]
  payrolls                   Payroll[]
  performanceReviews         PerformanceReview[]
  positions                  Position[]
  resignations               Resignation[]
  salaryHistory              SalaryHistory[]
  hrSettings                 HRSettings?
  shiftAssignments           ShiftAssignment[]
  shifts                     Shift[]
  imageGallery               ImageGallery[]
  integrations               Integration[]
  invoices                   Invoice[]
  learningData               LearningData[]
  learningSettings           LearningSettings?
  notifications              Notification[]
  orderStatusConfigs         OrderStatusConfig[]
  orders                     Order[]
  pageResponseSettings       PageResponseSettings[]
  patternPerformance         PatternPerformance[]
  patternUsage               PatternUsage[]
  payments                   Payment[]
  postResponseSettings       PostResponseSettings[]
  postTracking               PostTracking[]
  productReviews             ProductReview[]
  products                   Product[]
  projects                   Project[]
  recentlyViewed             RecentlyViewed[]
  responseEffectiveness      ResponseEffectiveness[]
  shippingZones              ShippingZone[]
  storePages                 StorePage[]
  storePromotionSettings     StorePromotionSettings?
  storefrontSettings         StorefrontSettings?
  subscriptions              Subscription[]
  successPatterns            SuccessPattern[]
  systemPrompts              SystemPrompt[]
  taskActivities             TaskActivity[]
  taskAttachments            TaskAttachment[]
  taskCategories             TaskCategory[]
  taskChecklists             TaskChecklist[]
  taskComments               TaskComment[]
  taskDependencies           TaskDependency[]
  taskNotifications          TaskNotification[]
  taskTemplates              TaskTemplate[]
  taskWatchers               TaskWatcher[]
  tasks                      Task[]
  telegramConfigs            TelegramConfig[]
  textGallery                TextGallery[]
  timeEntries                TimeEntry[]
  userInvitations            UserInvitation[]
  users                      User[]
  warehouses                 Warehouse[]
  whatsappQuickReplies       WhatsAppQuickReply[]
  whatsappSessions           WhatsAppSession[]
  whatsappSettings           WhatsAppSettings?
  wishlists                  Wishlist[]
  wooCommerceSettings        WooCommerceSettings?
  wooCommerceSyncLogs        WooCommerceSyncLog[]

  @@index([planConfigurationId], map: "companies_planConfigurationId_fkey")
  @@map("companies")
}

model TelegramConfig {
  id            String   @id @default(cuid())
  companyId     String
  botToken      String?  @db.Text
  botName       String?
  botUsername   String?
  apiId         String?  @db.Text
  apiHash       String?  @db.Text
  isActive      Boolean  @default(false)
  clientSession String?  @db.Text
  clientPhone   String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  label         String   @default("Official Bot")
  sessionString String?  @db.Text
  type          String   @default("BOT")
  company       Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, type])
  @@index([companyId])
  @@index([type])
  @@map("telegram_configs")
}

model User {
  id                      String              @id @default(cuid())
  email                   String              @unique
  password                String
  firstName               String
  lastName                String
  avatar                  String?
  phone                   String?
  role                    UserRole            @default(AGENT)
  isActive                Boolean             @default(true)
  isEmailVerified         Boolean             @default(false)
  emailVerifiedAt         DateTime?
  lastLoginAt             DateTime?
  passwordChangedAt       DateTime?
  companyId               String
  createdAt               DateTime            @default(now())
  updatedAt               DateTime            @updatedAt
  resetPasswordExpires    DateTime?
  resetPasswordToken      String?
  supportMessages         SupportMessage[]
  supportTickets          SupportTicket[]
  activities              Activity[]
  assignedConversations   Conversation[]
  customerNotes           CustomerNote[]
  employee                Employee?
  imageGallery            ImageGallery[]
  sentMessages            Message[]
  notifications           Notification[]
  managedProjects         Project[]
  taskActivities          TaskActivity[]
  taskAttachments         TaskAttachment[]
  completedChecklistItems TaskChecklistItem[]
  taskComments            TaskComment[]
  taskNotifications       TaskNotification[]
  taskTemplates           TaskTemplate[]
  taskWatchers            TaskWatcher[]
  assignedTasks           Task[]              @relation("TaskAssignedTo")
  createdTasks            Task[]              @relation("TaskCreatedBy")
  textGallery             TextGallery[]
  timeEntries             TimeEntry[]
  sentInvitations         UserInvitation[]
  company                 Company             @relation(fields: [companyId], references: [id], onDelete: Cascade)
  whatsappMessages        WhatsAppMessage[]

  @@index([companyId])
  @@map("users")
}

model UserInvitation {
  id         String           @id @default(cuid())
  email      String
  firstName  String
  lastName   String
  role       String           @default("AGENT")
  token      String           @unique
  status     InvitationStatus @default(PENDING)
  invitedBy  String
  companyId  String
  expiresAt  DateTime
  acceptedAt DateTime?
  createdAt  DateTime         @default(now())
  updatedAt  DateTime         @updatedAt
  company    Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  inviter    User             @relation(fields: [invitedBy], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([token])
  @@index([invitedBy], map: "user_invitations_invitedBy_fkey")
  @@map("user_invitations")
}

model Customer {
  id                   String                  @id @default(cuid())
  firstName            String
  lastName             String
  email                String?
  phone                String?
  avatar               String?
  facebookId           String?
  whatsappId           String?
  telegramId           String?
  status               CustomerStatus          @default(LEAD)
  tags                 String?
  notes                String?
  metadata             String?                 @db.Text
  companyId            String
  createdAt            DateTime                @default(now())
  updatedAt            DateTime                @updatedAt
  activities           Activity[]
  aiInteractions       AiInteraction[]
  blockedOnPages       BlockedCustomerOnPage[]
  conversationOutcomes ConversationOutcome[]
  conversations        Conversation[]
  notes_rel            CustomerNote[]
  company              Company                 @relation(fields: [companyId], references: [id], onDelete: Cascade)
  orders               Order[]
  whatsappContacts     WhatsAppContact[]

  @@unique([facebookId, companyId], name: "customer_facebook_company")
  @@unique([whatsappId, companyId], name: "customer_whatsapp_company")
  @@unique([telegramId, companyId], name: "customer_telegram_company")
  @@index([companyId])
  @@index([facebookId])
  @@index([status])
  @@index([companyId, status], map: "customers_company_status_idx")
  @@map("customers")
}

model Conversation {
  id                       String               @id @default(cuid())
  customerId               String
  assignedUserId           String?
  channel                  CommunicationChannel
  status                   ConversationStatus   @default(ACTIVE)
  subject                  String?
  priority                 Int                  @default(1)
  tags                     String?
  lastMessageAt            DateTime?
  lastMessagePreview       String?
  isRead                   Boolean              @default(false)
  metadata                 String?              @db.Text
  companyId                String
  createdAt                DateTime             @default(now())
  updatedAt                DateTime             @updatedAt
  aiEnabled                Boolean              @default(true)
  lastMessageIsFromCustomer Boolean             @default(false)
  unreadCount              Int                  @default(0)
  broadcastRecipients BroadcastRecipient[]
  assignedUser        User?                @relation(fields: [assignedUserId], references: [id])
  company             Company              @relation(fields: [companyId], references: [id], onDelete: Cascade)
  customer            Customer             @relation(fields: [customerId], references: [id], onDelete: Cascade)
  messages            Message[]
  orders              Order[]

  @@index([assignedUserId])
  @@index([companyId])
  @@index([customerId])
  @@index([lastMessageAt])
  @@index([status])
  @@index([companyId, lastMessageAt], map: "conversations_company_lastmsg_idx")
  @@index([companyId, status, lastMessageAt], map: "conversations_company_status_lastmsg_idx")
  @@index([companyId, lastMessageIsFromCustomer, status], map: "conversations_unreplied_idx")
  @@map("conversations")
}

model Message {
  id             String       @id @default(cuid())
  conversationId String
  senderId       String?
  type           MessageType  @default(TEXT)
  content        String       @db.Text
  attachments    String?      @db.Text
  metadata       String?      @db.Text
  isFromCustomer Boolean      @default(true)
  isRead         Boolean      @default(false)
  readAt         DateTime?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender         User?        @relation(fields: [senderId], references: [id])

  @@index([conversationId])
  @@index([senderId])
  @@index([createdAt])
  @@index([isFromCustomer])
  @@index([conversationId, createdAt], map: "messages_conversation_created_idx")
  @@index([conversationId, isFromCustomer, createdAt], map: "messages_conv_customer_created_idx")
  @@map("messages")
}

model Category {
  id              String     @id @default(cuid())
  name            String
  description     String?    @db.Text
  image           String?
  parentId        String?
  isActive        Boolean    @default(true)
  sortOrder       Int        @default(0)
  companyId       String
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  displayType     String     @default("default")
  metaDescription String?    @db.Text
  metaTitle       String?
  slug            String?
  company         Company    @relation(fields: [companyId], references: [id], onDelete: Cascade)
  parent          Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children        Category[] @relation("CategoryHierarchy")
  products        Product[]

  @@unique([companyId, slug])
  @@index([companyId])
  @@index([parentId])
  @@index([slug])
  @@map("categories")
}

model Product {
  id                       String                    @id @default(cuid())
  name                     String
  description              String?                   @db.Text
  sku                      String?                   @unique
  price                    Decimal                   @db.Decimal(10, 2)
  comparePrice             Decimal?                  @db.Decimal(10, 2)
  cost                     Decimal?                  @db.Decimal(10, 2)
  images                   String?                   @db.Text
  stock                    Int                       @default(0)
  trackInventory           Boolean                   @default(true)
  weight                   Decimal?                  @db.Decimal(8, 2)
  dimensions               String?                   @db.Text
  categoryId               String?
  isActive                 Boolean                   @default(true)
  isFeatured               Boolean                   @default(false)
  tags                     String?
  metadata                 String?                   @db.Text
  companyId                String
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime                  @updatedAt
  barcode                  String?
  easyOrdersId             String?
  easyOrdersUrl            String?
  source                   String?                   @default("manual")
  wooCommerceId            String?
  wooCommerceUrl           String?
  hasPromotedAd            Boolean                   @default(false)
  enableCheckoutForm       Boolean                   @default(true)
  showAddToCartButton      Boolean                   @default(true)
  saleStartDate            DateTime?
  saleEndDate              DateTime?
  sizeGuide                String?                   @db.Text
  isPreOrder               Boolean                   @default(false)
  preOrderDate             DateTime?
  preOrderMessage          String?                   @db.Text
  backInStockNotifications BackInStockNotification[]
  facebookCatalogProducts  FacebookCatalogProduct[]
  inventory                Inventory[]
  orderItems               OrderItem[]
  featuredInPosts          PostResponseSettings[]
  reviews                  ProductReview[]
  variants                 ProductVariant[]
  category                 Category?                 @relation(fields: [categoryId], references: [id])
  company                  Company                   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  recentlyViewed           RecentlyViewed[]
  alerts                   StockAlert[]
  movements                StockMovement[]
  wishlists                Wishlist[]

  @@index([categoryId])
  @@index([companyId])
  @@map("products")
}

model ProductVariant {
  id             String      @id @default(cuid())
  productId      String
  name           String
  type           String      @default("color")
  sku            String?     @unique
  price          Decimal?    @db.Decimal(10, 2)
  comparePrice   Decimal?    @db.Decimal(10, 2)
  cost           Decimal?    @db.Decimal(10, 2)
  images         String?     @db.Text
  stock          Int         @default(0)
  trackInventory Boolean     @default(true)
  isActive       Boolean     @default(true)
  sortOrder      Int         @default(0)
  metadata       String?     @db.Text
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  orderItems     OrderItem[]
  product        Product     @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@map("product_variants")
}

model Order {
  id                     String        @id @default(cuid())
  orderNumber            String        @unique
  customerId             String
  conversationId         String?
  status                 OrderStatus   @default(PENDING)
  paymentStatus          PaymentStatus @default(PENDING)
  paymentMethod          PaymentMethod @default(CASH)
  subtotal               Decimal       @db.Decimal(10, 2)
  tax                    Decimal       @default(0.00) @db.Decimal(10, 2)
  shipping               Decimal       @default(0.00) @db.Decimal(10, 2)
  discount               Decimal       @default(0.00) @db.Decimal(10, 2)
  total                  Decimal       @db.Decimal(10, 2)
  currency               String        @default("EGP")
  notes                  String?
  shippingAddress        String?       @db.Text
  billingAddress         String?       @db.Text
  customerName           String?
  customerPhone          String?
  customerEmail          String?
  city                   String?
  customerAddress        String?
  dataQuality            String?       @db.Text
  extractionMethod       String?       @default("ai_enhanced")
  confidence             Float?
  validationStatus       String?       @default("pending")
  sourceType             String?       @default("ai_conversation")
  extractionTimestamp    DateTime?
  metadata               String?       @db.Text
  companyId              String
  createdAt              DateTime      @default(now())
  updatedAt              DateTime      @updatedAt
  lastSyncAt             DateTime?
  syncedFromWoo          Boolean       @default(false)
  syncedToWoo            Boolean       @default(false)
  wooCommerceDateCreated DateTime?
  wooCommerceId          String?
  wooCommerceOrderKey    String?
  wooCommerceStatus      String?
  wooCommerceUrl         String?
  items                  OrderItem[]
  company                Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  conversation           Conversation? @relation(fields: [conversationId], references: [id])
  customer               Customer      @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([customerId])
  @@index([conversationId])
  @@index([wooCommerceId])
  @@map("orders")
}

model OrderItem {
  id               String          @id @default(cuid())
  orderId          String
  productId        String?
  quantity         Int
  price            Decimal         @db.Decimal(10, 2)
  total            Decimal         @db.Decimal(10, 2)
  productName      String?
  productColor     String?
  productSize      String?
  productSku       String?
  metadata         String?         @db.Text
  variantId        String?
  extractionSource String?         @default("ai")
  confidence       Float?
  order            Order           @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product          Product?        @relation(fields: [productId], references: [id], onDelete: Cascade)
  variant          ProductVariant? @relation(fields: [variantId], references: [id])

  @@index([orderId])
  @@index([productId])
  @@index([variantId])
  @@map("order_items")
}

model Notification {
  id        String    @id @default(cuid())
  userId    String?
  title     String
  message   String
  type      String    @default("info")
  isRead    Boolean   @default(false)
  readAt    DateTime?
  data      String?   @db.Text
  companyId String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  company   Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user      User?     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([userId])
  @@map("notifications")
}

model AINotification {
  id        String    @id @default(cuid())
  companyId String
  type      String
  severity  String    @default("medium")
  title     String
  message   String    @db.Text
  metadata  String?   @db.Text
  isRead    Boolean   @default(false)
  readAt    DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@index([companyId])
  @@index([isRead])
  @@index([createdAt])
  @@map("ai_notifications")
}

model Integration {
  id          String    @id @default(cuid())
  name        String
  type        String
  platform    String
  externalId  String
  accessToken String?   @db.Text
  config      String    @db.Text
  settings    String?   @db.Text
  status      String    @default("ACTIVE")
  isActive    Boolean   @default(true)
  lastSyncAt  DateTime?
  companyId   String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  company     Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, platform, externalId])
  @@map("integrations")
}

model AiSettings {
  id                         String   @id @default(cuid())
  companyId                  String   @unique
  promptTemplate             String?  @db.Text
  autoReplyEnabled           Boolean  @default(false)
  confidenceThreshold        Float    @default(0.7)
  escalationRules            String?  @db.Text
  createdAt                  DateTime @default(now())
  updatedAt                  DateTime @updatedAt
  autoCreateOrders           Boolean  @default(false)
  autoSuggestProducts        Boolean  @default(true)
  defaultProductId           String?
  includeImages              Boolean  @default(true)
  maxSuggestions             Int      @default(3)
  modelSettings              String?  @db.Text
  personalityPrompt          String?  @db.Text
  responsePrompt             String?  @db.Text
  memorySettings             String?  @db.Text
  useAdvancedTools           Boolean  @default(false)
  workingHours               String?  @db.Text
  workingHoursEnabled        Boolean  @default(true)
  maxRepliesPerCustomer      Int      @default(5)
  multimodalEnabled          Boolean  @default(true)
  ragEnabled                 Boolean  @default(true)
  qualityEvaluationEnabled   Boolean  @default(true)
  queueSettings              String?  @db.Text
  aiMaxTokens                Int?     @default(2048)
  aiResponseStyle            String?  @default("balanced")
  aiTemperature              Float?   @default(0.7)
  aiTopK                     Int?     @default(40)
  aiTopP                     Float?   @default(0.9)
  enableDiversityCheck       Boolean  @default(true)
  enableEmotionalResponse    Boolean  @default(true)
  enableLongTermMemory       Boolean  @default(false)
  enableLowQualityAlerts     Boolean  @default(true)
  enablePatternApplication   Boolean  @default(true)
  enableSmartSuggestions     Boolean  @default(false)
  enableToneAdaptation       Boolean  @default(true)
  maxMessagesPerConversation Int?     @default(50)
  memoryRetentionDays        Int?     @default(30)
  minQualityScore            Float?   @default(70)
  patternPriority            String?  @default("balanced")
  replyMode                  String   @default("all")
  autoCleanup                Boolean  @default(true)
  compressionEnabled         Boolean  @default(false)
  maxConversationsPerUser    Int?     @default(100)
  responseRules              String?  @db.Text
  company                    Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@map("ai_settings")
}

model AiInteraction {
  id                        String   @id @default(cuid())
  companyId                 String
  customerId                String
  userMessage               String   @db.Text
  aiResponse                String   @db.Text
  intent                    String?
  sentiment                 String?
  confidence                Float?
  requiresHumanIntervention Boolean  @default(false)
  metadata                  String?  @db.Text
  createdAt                 DateTime @default(now())
  modelUsed                 String?
  responseTime              Int?
  tokensUsed                Int?
  company                   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  customer                  Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([customerId])
  @@map("ai_interactions")
}

model PromptTemplate {
  id           String   @id @default(cuid())
  name         String
  category     String
  businessType String?
  description  String?
  content      String   @db.Text
  variables    String?  @db.Text
  tags         String?  @db.Text
  isActive     Boolean  @default(true)
  usageCount   Int      @default(0)
  rating       Float    @default(0)
  createdBy    String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("prompt_templates")
}

model PromptLibrary {
  id                String   @id @default(cuid())
  name              String
  nameAr            String?
  description       String   @db.Text
  descriptionAr     String?  @db.Text
  category          String
  businessType      String?
  promptContent     String   @db.Text
  personalityPrompt String?  @db.Text
  responsePrompt    String?  @db.Text
  variables         String?  @db.Text
  tags              String?  @db.Text
  icon              String?
  previewImage      String?
  isActive          Boolean  @default(true)
  isFeatured        Boolean  @default(false)
  usageCount        Int      @default(0)
  rating            Float    @default(0)
  sortOrder         Int      @default(0)
  createdBy         String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([category])
  @@index([isActive])
  @@index([isFeatured])
  @@index([businessType])
  @@map("prompt_library")
}

model CustomerNote {
  id         String   @id @default(cuid())
  customerId String
  authorId   String
  content    String   @db.Text
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  author     User     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@index([authorId])
  @@index([customerId])
  @@map("customer_notes")
}

model Activity {
  id          String    @id @default(cuid())
  userId      String?
  customerId  String?
  action      String
  description String
  metadata    String?   @db.Text
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime  @default(now())
  customer    Customer? @relation(fields: [customerId], references: [id])
  user        User?     @relation(fields: [userId], references: [id])

  @@index([customerId])
  @@index([userId])
  @@map("activities")
}

model FacebookPage {
  id               String                  @id @default(cuid())
  pageId           String                  @unique
  pageAccessToken  String                  @db.Text
  pageName         String
  companyId        String?
  status           String                  @default("connected")
  connectedAt      DateTime                @default(now())
  createdAt        DateTime                @default(now())
  updatedAt        DateTime                @updatedAt
  disconnectedAt   DateTime?
  blockedCustomers BlockedCustomerOnPage[]
  company          Company?                @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("facebook_pages")
}

model BlockedCustomerOnPage {
  id             String       @id @default(cuid())
  facebookPageId String
  pageId         String
  customerId     String
  facebookId     String
  blockedBy      String?
  reason         String?      @db.Text
  blockedAt      DateTime     @default(now())
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  metadata       String?      @db.Text
  customer       Customer     @relation(fields: [customerId], references: [id], onDelete: Cascade)
  facebookPage   FacebookPage @relation(fields: [facebookPageId], references: [id], onDelete: Cascade)

  @@unique([facebookPageId, customerId], name: "blocked_customer_page_unique")
  @@unique([pageId, facebookId], name: "blocked_facebook_page_unique")
  @@index([facebookPageId], map: "blocked_customers_facebookPageId_idx")
  @@index([pageId], map: "blocked_customers_pageId_idx")
  @@index([customerId], map: "blocked_customers_customerId_idx")
  @@index([facebookId], map: "blocked_customers_facebookId_idx")
  @@map("blocked_customers_on_page")
}

model SkippedFacebookPage {
  id                   String    @id @default(cuid())
  pageId               String
  pageName             String
  reason               String
  attemptedCompanyId   String
  connectedToCompanyId String?
  isResolved           Boolean   @default(false)
  resolvedAt           DateTime?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt

  @@index([attemptedCompanyId])
  @@index([isResolved])
  @@index([createdAt])
  @@map("skipped_facebook_pages")
}

model Warehouse {
  id        String          @id @default(cuid())
  name      String
  location  String?
  type      String          @default("main")
  capacity  Int?
  isActive  Boolean         @default(true)
  companyId String
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  inventory Inventory[]
  alerts    StockAlert[]
  movements StockMovement[]
  company   Company         @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("warehouses")
}

model Inventory {
  id              String    @id @default(cuid())
  productId       String
  warehouseId     String
  quantity        Int       @default(0)
  reserved        Int       @default(0)
  available       Int       @default(0)
  minStock        Int       @default(0)
  maxStock        Int?
  reorderPoint    Int       @default(0)
  reorderQuantity Int       @default(0)
  cost            Decimal?  @db.Decimal(10, 2)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  product         Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  warehouse       Warehouse @relation(fields: [warehouseId], references: [id], onDelete: Cascade)

  @@unique([productId, warehouseId])
  @@index([productId])
  @@index([warehouseId])
  @@map("inventory")
}

model StockMovement {
  id          String              @id @default(cuid())
  productId   String
  warehouseId String
  type        StockMovementType
  reason      StockMovementReason
  quantity    Int
  cost        Decimal?            @db.Decimal(10, 2)
  reference   String?
  notes       String?
  userId      String?
  userName    String?
  createdAt   DateTime            @default(now())
  product     Product             @relation(fields: [productId], references: [id], onDelete: Cascade)
  warehouse   Warehouse           @relation(fields: [warehouseId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([warehouseId])
  @@index([createdAt])
  @@map("stock_movements")
}

model StockAlert {
  id              String        @id @default(cuid())
  type            AlertType
  priority        AlertPriority
  productId       String
  productName     String
  warehouseId     String
  warehouseName   String
  message         String
  currentStock    Int?
  reorderPoint    Int?
  reorderQuantity Int?
  isRead          Boolean       @default(false)
  createdAt       DateTime      @default(now())
  product         Product       @relation(fields: [productId], references: [id], onDelete: Cascade)
  warehouse       Warehouse     @relation(fields: [warehouseId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([warehouseId])
  @@index([isRead])
  @@index([priority])
  @@map("stock_alerts")
}

model ConversationMemory {
  id             String   @id @default(cuid())
  conversationId String
  senderId       String
  userMessage    String
  aiResponse     String
  intent         String?
  sentiment      String?
  timestamp      DateTime @default(now())
  metadata       String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  companyId      String
  company        Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([senderId])
  @@index([companyId])
  @@index([companyId, conversationId])
  @@index([companyId, senderId])
  @@index([timestamp])
  @@map("conversation_memory")
}

model KnowledgeBase {
  id        String   @id @default(cuid())
  title     String
  content   String
  category  String
  tags      String?
  isActive  Boolean  @default(true)
  priority  Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([category])
  @@index([isActive])
  @@map("knowledge_base")
}

model AiAnalytics {
  id                    String   @id @default(cuid())
  date                  DateTime @db.Date
  totalMessages         Int      @default(0)
  aiResponses           Int      @default(0)
  humanHandoffs         Int      @default(0)
  avgResponseTime       Float?
  avgConfidence         Float?
  topIntents            String?
  sentimentDistribution String?
  createdAt             DateTime @default(now())

  @@index([date])
  @@map("ai_analytics")
}

model MediaFile {
  id             String   @id @default(cuid())
  conversationId String
  senderId       String
  fileName       String
  fileType       String
  fileSize       Int?
  fileUrl        String
  analysis       String?
  processed      Boolean  @default(false)
  createdAt      DateTime @default(now())

  @@index([conversationId])
  @@index([fileType])
  @@map("media_files")
}

model GeminiKey {
  id                String           @id @default(cuid())
  name              String
  apiKey            String           @unique
  model             String           @default("gemini-1.5-flash")
  isActive          Boolean          @default(true)
  usage             String           @default("{\"used\": 0, \"limit\": 1000000}")
  currentUsage      Int              @default(0)
  maxRequestsPerDay Int              @default(1500)
  priority          Int              @default(1)
  description       String?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  companyId         String?
  keyType           GeminiKeyType    @default(COMPANY)
  models            GeminiKeyModel[]
  company           Company?         @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([isActive, priority])
  @@index([companyId, isActive])
  @@index([keyType, isActive])
  @@map("gemini_keys")
}

model GeminiKeyModel {
  id        String    @id @default(cuid())
  keyId     String
  model     String
  usage     String    @default("{\"used\": 0, \"limit\": 1000000, \"resetDate\": null, \"rpm\": {\"used\": 0, \"limit\": 0, \"windowStart\": null}, \"rph\": {\"used\": 0, \"limit\": 0, \"windowStart\": null}, \"rpd\": {\"used\": 0, \"limit\": 0, \"windowStart\": null}}") @db.Text
  isEnabled Boolean   @default(true)
  priority  Int       @default(1)
  lastUsed  DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  key       GeminiKey @relation(fields: [keyId], references: [id], onDelete: Cascade)

  @@unique([keyId, model])
  @@index([isEnabled, priority])
  @@index([keyId, model])
  @@map("gemini_key_models")
}

model ExcludedModel {
  id          String    @id @default(cuid())
  modelName   String
  keyId       String?
  companyId   String?
  reason      String
  excludedAt  DateTime  @default(now())
  retryAt     DateTime
  retryCount  Int       @default(0)
  lastRetryAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([modelName, keyId])
  @@index([retryAt])
  @@index([companyId])
  @@map("excluded_models")
}

model SystemPrompt {
  id        String   @id @default(cuid())
  name      String
  content   String   @db.Text
  category  String   @default("general")
  isActive  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  companyId String?
  company   Company? @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("system_prompts")
}

model LearningData {
  id             String   @id @default(cuid())
  companyId      String
  customerId     String?
  conversationId String?
  type           String
  data           String?  @db.Text
  userMessage    String?  @db.Text
  aiResponse     String?  @db.Text
  intent         String?
  sentiment      String?
  processingTime Int?
  ragDataUsed    Boolean  @default(false)
  memoryUsed     Boolean  @default(false)
  model          String?
  confidence     Float?
  outcome        String?
  feedback       String?  @db.Text
  insights       String?  @db.Text
  metadata       String?  @db.Text
  createdAt      DateTime @default(now())
  company        Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([type])
  @@index([createdAt])
  @@index([confidence])
  @@index([intent])
  @@map("learning_data")
}

model DiscoveredPattern {
  id                 String               @id @default(cuid())
  companyId          String
  patternType        String
  pattern            String
  description        String
  confidence         Float
  occurrences        Int                  @default(0)
  contexts           String?              @db.Text
  actionableInsights String?              @db.Text
  impact             String?              @db.Text
  status             String               @default("discovered")
  discoveredAt       DateTime             @default(now())
  lastValidated      DateTime?
  improvements       AppliedImprovement[]
  company            Company              @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([patternType])
  @@index([status])
  @@map("discovered_patterns")
}

model AppliedImprovement {
  id                String             @id @default(cuid())
  companyId         String
  patternId         String?
  type              String
  description       String
  implementation    String             @db.Text
  rolloutPercentage Int                @default(10)
  status            String             @default("testing")
  beforeMetrics     String?            @db.Text
  afterMetrics      String?            @db.Text
  improvementScore  Float?
  createdAt         DateTime           @default(now())
  lastEvaluated     DateTime?
  company           Company            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  pattern           DiscoveredPattern? @relation(fields: [patternId], references: [id])

  @@index([companyId])
  @@index([type])
  @@index([status])
  @@index([patternId])
  @@map("applied_improvements")
}

model LearningSettings {
  id                    String   @id @default(cuid())
  companyId             String   @unique
  enabled               Boolean  @default(true)
  learningSpeed         String   @default("medium")
  autoApplyImprovements Boolean  @default(false)
  dataRetentionDays     Int      @default(90)
  minimumSampleSize     Int      @default(50)
  confidenceThreshold   Float    @default(0.8)
  settings              String?  @db.Text
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  company               Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@map("learning_settings")
}

model SuccessPattern {
  id              String               @id @default(cuid())
  companyId       String
  patternType     String
  pattern         String               @db.Text
  description     String               @db.Text
  successRate     Float
  sampleSize      Int
  confidenceLevel Float
  isActive        Boolean              @default(true)
  isApproved      Boolean              @default(false)
  approvedBy      String?
  approvedAt      DateTime?
  metadata        String?              @db.Text
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  performance     PatternPerformance[]
  usage           PatternUsage[]
  company         Company              @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([patternType])
  @@index([isActive])
  @@index([isApproved])
  @@index([successRate])
  @@map("success_patterns")
}

model PatternPerformance {
  id                 String         @id @default(cuid())
  patternId          String
  companyId          String
  conversationId     String?
  usageCount         Int            @default(0)
  successCount       Int            @default(0)
  failureCount       Int            @default(0)
  currentSuccessRate Float          @default(0)
  lastUsedAt         DateTime?
  performanceTrend   String         @default("stable")
  impactScore        Float          @default(0)
  roi                Float          @default(0)
  metadata           String?        @db.Text
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt
  company            Company        @relation(fields: [companyId], references: [id], onDelete: Cascade)
  pattern            SuccessPattern @relation(fields: [patternId], references: [id], onDelete: Cascade)

  @@index([patternId])
  @@index([companyId])
  @@index([currentSuccessRate])
  @@index([lastUsedAt])
  @@index([performanceTrend])
  @@map("pattern_performance")
}

model PatternUsage {
  id               String         @id @default(cuid())
  patternId        String
  conversationId   String
  companyId        String
  applied          Boolean        @default(true)
  effectiveness    Float?
  customerReaction String?
  outcomeImpact    String?
  responseTime     Int?
  metadata         String?        @db.Text
  createdAt        DateTime       @default(now())
  company          Company        @relation(fields: [companyId], references: [id], onDelete: Cascade)
  pattern          SuccessPattern @relation(fields: [patternId], references: [id], onDelete: Cascade)

  @@index([patternId])
  @@index([conversationId])
  @@index([companyId])
  @@index([applied])
  @@index([createdAt])
  @@map("pattern_usage")
}

model ConversationOutcome {
  id                   String   @id @default(cuid())
  conversationId       String
  customerId           String
  companyId            String
  outcome              String
  outcomeValue         Float?
  responseQuality      Float?
  customerSatisfaction Float?
  conversionTime       Int?
  messageCount         Int?
  aiResponseCount      Int?
  humanHandoff         Boolean  @default(false)
  metadata             String?  @db.Text
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  company              Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  customer             Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([companyId])
  @@index([outcome])
  @@index([createdAt])
  @@index([customerId], map: "conversation_outcomes_customerId_fkey")
  @@map("conversation_outcomes")
}

model ResponseEffectiveness {
  id                 String   @id @default(cuid())
  companyId          String
  messageId          String?
  conversationId     String
  responseText       String   @db.Text
  responseType       String
  customerReaction   String?
  effectivenessScore Float
  leadToPurchase     Boolean  @default(false)
  responseTime       Int?
  wordCount          Int?
  sentimentScore     Float?
  keywords           String?  @db.Text
  metadata           String?  @db.Text
  createdAt          DateTime @default(now())
  company            Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([conversationId])
  @@index([responseType])
  @@index([effectivenessScore])
  @@index([leadToPurchase])
  @@index([createdAt])
  @@map("response_effectiveness")
}

model TaskCategory {
  id          String   @id @default(cuid())
  name        String
  description String?
  color       String   @default("#6366f1")
  icon        String?
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  companyId   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tasks       Task[]

  @@unique([companyId, name])
  @@index([companyId])
  @@index([isActive])
  @@map("task_categories")
}

model Task {
  id                String           @id @default(cuid())
  projectId         String?
  title             String
  description       String           @db.Text
  status            TaskStatus       @default(PENDING)
  priority          TaskPriority     @default(MEDIUM)
  type              String           @default("general")
  assignedTo        String
  createdBy         String
  dueDate           DateTime?
  estimatedHours    Int              @default(0)
  actualHours       Int              @default(0)
  progress          Int              @default(0)
  tags              String?          @db.LongText
  dependencies      String?          @db.LongText
  companyId         String
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  categoryId        String?
  color             String?
  completedDate     DateTime?
  isRecurring       Boolean          @default(false)
  order             Int              @default(0)
  parentTaskId      String?
  recurringRule     String?          @db.LongText
  startDate         DateTime?
  activities        TaskActivity[]
  attachments       TaskAttachment[]
  checklists        TaskChecklist[]
  comments          TaskComment[]
  dependedOnByTasks TaskDependency[] @relation("DependsOnTasks")
  taskDependencies  TaskDependency[] @relation("TaskDependencies")
  watchers          TaskWatcher[]
  assignedUser      User             @relation("TaskAssignedTo", fields: [assignedTo], references: [id])
  category          TaskCategory?    @relation(fields: [categoryId], references: [id])
  company           Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  createdByUser     User             @relation("TaskCreatedBy", fields: [createdBy], references: [id])
  parentTask        Task?            @relation("TaskSubtasks", fields: [parentTaskId], references: [id])
  subtasks          Task[]           @relation("TaskSubtasks")
  project           Project?         @relation(fields: [projectId], references: [id])
  timeEntries       TimeEntry[]

  @@index([companyId])
  @@index([projectId])
  @@index([categoryId])
  @@index([parentTaskId])
  @@index([assignedTo])
  @@index([status])
  @@index([priority])
  @@index([dueDate])
  @@index([order])
  @@index([createdBy], map: "tasks_createdBy_fkey")
  @@map("tasks")
}

model TaskComment {
  id              String        @id @default(cuid())
  taskId          String
  userId          String
  content         String        @db.Text
  parentCommentId String?
  mentions        String?       @db.LongText
  isEdited        Boolean       @default(false)
  editedAt        DateTime?
  companyId       String
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  company         Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  parentComment   TaskComment?  @relation("CommentReplies", fields: [parentCommentId], references: [id])
  replies         TaskComment[] @relation("CommentReplies")
  task            Task          @relation(fields: [taskId], references: [id], onDelete: Cascade)
  user            User          @relation(fields: [userId], references: [id])

  @@index([taskId])
  @@index([userId])
  @@index([companyId])
  @@index([parentCommentId])
  @@map("task_comments")
}

model TaskAttachment {
  id            String   @id @default(cuid())
  taskId        String
  userId        String
  fileName      String
  originalName  String
  fileSize      Int
  fileType      String
  filePath      String
  downloadCount Int      @default(0)
  companyId     String
  createdAt     DateTime @default(now())
  company       Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  task          Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  user          User     @relation(fields: [userId], references: [id])

  @@index([taskId])
  @@index([userId])
  @@index([companyId])
  @@map("task_attachments")
}

model TimeEntry {
  id          String    @id @default(cuid())
  taskId      String
  userId      String
  startTime   DateTime
  endTime     DateTime?
  duration    Int       @default(0)
  description String?   @db.Text
  isBillable  Boolean   @default(false)
  hourlyRate  Decimal?  @db.Decimal(10, 2)
  isRunning   Boolean   @default(false)
  companyId   String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  company     Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  task        Task      @relation(fields: [taskId], references: [id], onDelete: Cascade)
  user        User      @relation(fields: [userId], references: [id])

  @@index([taskId])
  @@index([userId])
  @@index([companyId])
  @@index([startTime])
  @@map("time_entries")
}

model TaskWatcher {
  id        String   @id @default(cuid())
  taskId    String
  userId    String
  companyId String
  createdAt DateTime @default(now())
  company   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  task      Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id])

  @@unique([taskId, userId])
  @@index([taskId])
  @@index([userId])
  @@index([companyId])
  @@map("task_watchers")
}

model TaskActivity {
  id          String   @id @default(cuid())
  taskId      String
  userId      String
  action      String
  field       String?
  oldValue    String?  @db.Text
  newValue    String?  @db.Text
  description String?  @db.Text
  companyId   String
  createdAt   DateTime @default(now())
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  task        Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  user        User     @relation(fields: [userId], references: [id])

  @@index([taskId])
  @@index([userId])
  @@index([companyId])
  @@index([createdAt])
  @@map("task_activities")
}

model TaskChecklist {
  id        String              @id @default(cuid())
  taskId    String
  title     String
  position  Int                 @default(0)
  companyId String
  createdAt DateTime            @default(now())
  updatedAt DateTime            @updatedAt
  items     TaskChecklistItem[]
  company   Company             @relation(fields: [companyId], references: [id], onDelete: Cascade)
  task      Task                @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([taskId])
  @@index([companyId])
  @@map("task_checklists")
}

model TaskChecklistItem {
  id            String        @id @default(cuid())
  checklistId   String
  content       String
  isCompleted   Boolean       @default(false)
  completedAt   DateTime?
  completedBy   String?
  position      Int           @default(0)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  checklist     TaskChecklist @relation(fields: [checklistId], references: [id], onDelete: Cascade)
  completedUser User?         @relation(fields: [completedBy], references: [id])

  @@index([checklistId])
  @@index([completedBy], map: "task_checklist_items_completedBy_fkey")
  @@map("task_checklist_items")
}

model TaskDependency {
  id          String   @id @default(cuid())
  taskId      String
  dependsOnId String
  type        String   @default("blocked_by")
  companyId   String
  createdAt   DateTime @default(now())
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  dependsOn   Task     @relation("DependsOnTasks", fields: [dependsOnId], references: [id], onDelete: Cascade)
  task        Task     @relation("TaskDependencies", fields: [taskId], references: [id], onDelete: Cascade)

  @@unique([taskId, dependsOnId])
  @@index([taskId])
  @@index([dependsOnId])
  @@index([companyId])
  @@map("task_dependencies")
}

model TaskTemplate {
  id              String       @id @default(cuid())
  name            String
  description     String?      @db.Text
  defaultStatus   TaskStatus   @default(PENDING)
  defaultPriority TaskPriority @default(MEDIUM)
  type            String       @default("general")
  estimatedHours  Int          @default(0)
  tags            String?      @db.LongText
  checklist       String?      @db.LongText
  isPublic        Boolean      @default(false)
  createdBy       String
  companyId       String
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  company         Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  createdByUser   User         @relation(fields: [createdBy], references: [id])

  @@index([companyId])
  @@index([createdBy])
  @@map("task_templates")
}

model TaskNotification {
  id        String    @id @default(cuid())
  userId    String
  taskId    String?
  projectId String?
  type      String
  title     String
  message   String    @db.Text
  isRead    Boolean   @default(false)
  readAt    DateTime?
  link      String?
  companyId String
  createdAt DateTime  @default(now())
  company   Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([companyId])
  @@index([isRead])
  @@index([createdAt])
  @@map("task_notifications")
}

model Project {
  id          String        @id @default(cuid())
  name        String
  description String        @db.Text
  status      ProjectStatus @default(PLANNING)
  priority    TaskPriority  @default(MEDIUM)
  startDate   DateTime?
  endDate     DateTime?
  budget      Decimal?      @db.Decimal(10, 2)
  spentBudget Decimal?      @default(0.00) @db.Decimal(10, 2)
  progress    Int           @default(0)
  managerId   String
  teamMembers String?       @db.LongText
  tags        String?       @db.LongText
  companyId   String
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  company     Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  manager     User          @relation(fields: [managerId], references: [id])
  tasks       Task[]

  @@index([companyId])
  @@index([managerId])
  @@index([status])
  @@index([priority])
  @@map("projects")
}

model PlanConfiguration {
  id            String    @id @default(cuid())
  planType      String    @unique
  price         Float
  currency      String    @default("EGP")
  billingCycle  String    @default("monthly")
  features      String    @db.LongText
  description   String?
  descriptionEn String?
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  companies     Company[]

  @@map("plan_configurations")
}

model Subscription {
  id              String             @id @default(cuid())
  companyId       String
  planType        SubscriptionPlan
  status          SubscriptionStatus @default(ACTIVE)
  startDate       DateTime           @default(now())
  endDate         DateTime?
  nextBillingDate DateTime?
  billingCycle    String             @default("monthly")
  price           Float
  currency        String             @default("EGP")
  autoRenew       Boolean            @default(true)
  trialEndDate    DateTime?
  cancelledAt     DateTime?
  cancelReason    String?
  metadata        String?            @db.LongText
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  invoices        Invoice[]
  payments        Payment[]
  company         Company            @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId], map: "subscriptions_companyId_fkey")
  @@map("subscriptions")
}

model Invoice {
  id              String           @id @default(cuid())
  invoiceNumber   String           @unique
  subscriptionId  String?
  companyId       String
  status          InvoiceStatus    @default(DRAFT)
  type            InvoiceType      @default(SUBSCRIPTION)
  issueDate       DateTime         @default(now())
  dueDate         DateTime
  paidDate        DateTime?
  subtotal        Float
  taxAmount       Float            @default(0)
  discountAmount  Float            @default(0)
  totalAmount     Float
  currency        String           @default("EGP")
  notes           String?
  paymentTerms    String?          @default("Net 30")
  metadata        String?          @db.LongText
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  items           InvoiceItem[]
  company         Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  subscription    Subscription?    @relation(fields: [subscriptionId], references: [id])
  paymentReceipts PaymentReceipt[]
  payments        Payment[]

  @@index([companyId], map: "invoices_companyId_fkey")
  @@index([subscriptionId], map: "invoices_subscriptionId_fkey")
  @@map("invoices")
}

model InvoiceItem {
  id          String   @id @default(cuid())
  invoiceId   String
  description String
  quantity    Float    @default(1)
  unitPrice   Float
  totalPrice  Float
  metadata    String?  @db.LongText
  createdAt   DateTime @default(now())
  invoice     Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId], map: "invoice_items_invoiceId_fkey")
  @@map("invoice_items")
}

model Payment {
  id               String        @id @default(cuid())
  paymentNumber    String        @unique
  invoiceId        String?
  subscriptionId   String?
  companyId        String
  amount           Float
  currency         String        @default("EGP")
  status           PaymentStatus @default(PENDING)
  method           PaymentMethod @default(BANK_TRANSFER)
  gateway          String?
  gatewayPaymentId String?
  transactionId    String?
  paidAt           DateTime?
  failedAt         DateTime?
  failureReason    String?
  metadata         String?       @db.LongText
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  company          Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  invoice          Invoice?      @relation(fields: [invoiceId], references: [id])
  subscription     Subscription? @relation(fields: [subscriptionId], references: [id])

  @@index([companyId], map: "payments_companyId_fkey")
  @@index([invoiceId], map: "payments_invoiceId_fkey")
  @@index([subscriptionId], map: "payments_subscriptionId_fkey")
  @@map("payments")
}

model WalletNumber {
  id              String           @id @default(cuid())
  name            String
  number          String
  isActive        Boolean          @default(true)
  icon            String
  color           String
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  paymentReceipts PaymentReceipt[]

  @@map("wallet_numbers")
}

model PaymentReceipt {
  id             String       @id @default(cuid())
  invoiceId      String
  walletNumberId String
  receiptImage   String
  status         String       @default("PENDING")
  submittedAt    DateTime     @default(now())
  reviewedAt     DateTime?
  reviewedBy     String?
  notes          String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  invoice        Invoice      @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  walletNumber   WalletNumber @relation(fields: [walletNumberId], references: [id], onDelete: Cascade)

  @@index([invoiceId], map: "payment_receipts_invoiceId_fkey")
  @@index([walletNumberId], map: "payment_receipts_walletNumberId_fkey")
  @@map("payment_receipts")
}

model SystemSettings {
  id               String    @id @default(cuid())
  systemName       String    @unique
  displayName      String
  description      String?
  category         String    @default("general")
  isEnabled        Boolean   @default(true)
  config           String?   @db.LongText
  resourceUsage    String?   @db.LongText
  lastStatusChange DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @default(now()) @updatedAt

  @@map("system_settings")
}

model BroadcastCampaign {
  id             String               @id @default(cuid())
  name           String
  message        String               @db.Text
  targetAudience String
  scheduledAt    DateTime?
  sentAt         DateTime?
  tags           String?              @db.LongText
  priority       String               @default("medium")
  includeImages  Boolean              @default(false)
  trackClicks    Boolean              @default(true)
  autoResend     Boolean              @default(false)
  images         String?              @db.LongText
  status         String               @default("draft")
  recipientCount Int                  @default(0)
  sentCount      Int                  @default(0)
  deliveredCount Int                  @default(0)
  openedCount    Int                  @default(0)
  clickedCount   Int                  @default(0)
  failedCount    Int                  @default(0)
  companyId      String
  creatorId      String?
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt
  company        Company              @relation(fields: [companyId], references: [id], onDelete: Cascade)
  recipients     BroadcastRecipient[]

  @@index([companyId])
  @@index([status])
  @@index([scheduledAt])
  @@map("broadcast_campaigns")
}

model BroadcastSettings {
  id                           String   @id @default(cuid())
  companyId                    String   @unique
  defaultSendTime              String   @default("10:00")
  timezone                     String   @default("Asia/Riyadh")
  maxRecipientsPerCampaign     Int      @default(5000)
  maxCampaignsPerDay           Int      @default(10)
  enableDeliveryReports        Boolean  @default(true)
  enableOpenTracking           Boolean  @default(true)
  enableClickTracking          Boolean  @default(true)
  enableUnsubscribeTracking    Boolean  @default(true)
  notifyOnCampaignSent         Boolean  @default(true)
  notifyOnHighUnsubscribeRate  Boolean  @default(true)
  notifyOnLowDeliveryRate      Boolean  @default(true)
  adminEmail                   String?
  requireApprovalForHighVolume Boolean  @default(false)
  highVolumeThreshold          Int      @default(1000)
  enableContentFiltering       Boolean  @default(false)
  blockedWords                 String?  @db.LongText
  messagesPerMinute            Int      @default(60)
  messagesPerHour              Int      @default(1000)
  messagesPerDay               Int      @default(10000)
  defaultFooter                String?  @db.Text
  unsubscribeText              String   @default("  STOP")
  companyName                  String?
  companyAddress               String?
  createdAt                    DateTime @default(now())
  updatedAt                    DateTime @updatedAt
  company                      Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@map("broadcast_settings")
}

model BroadcastRecipient {
  id              String            @id @default(cuid())
  campaignId      String
  conversationId  String
  customerPhone   String
  customerName    String?
  messengerUserId String?
  status          String            @default("pending")
  sentAt          DateTime?
  deliveredAt     DateTime?
  openedAt        DateTime?
  clickedAt       DateTime?
  repliedAt       DateTime?
  failureReason   String?           @db.Text
  messageId       String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  campaign        BroadcastCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  conversation    Conversation      @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([campaignId])
  @@index([conversationId])
  @@index([status])
  @@map("broadcast_recipients")
}

model CustomerList {
  id          String   @id @default(cuid())
  name        String
  description String?  @db.Text
  criteria    String   @db.LongText
  count       Int      @default(0)
  isDefault   Boolean  @default(false)
  companyId   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("customer_lists")
}

model FacebookComment {
  id          String    @id @default(cuid())
  commentId   String    @unique
  postId      String
  senderId    String
  senderName  String
  message     String    @db.Text
  response    String?   @db.Text
  createdTime DateTime
  respondedAt DateTime?
  pageId      String?
  companyId   String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  company     Company?  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([commentId])
  @@index([postId])
  @@index([senderId])
  @@index([companyId])
  @@index([createdTime])
  @@map("facebook_comments")
}

model PostResponseSettings {
  id                    String   @id @default(cuid())
  postId                String
  companyId             String
  responseMethod        String
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  aiPrompt              String?  @db.Text
  fixedMessengerMessage String?  @db.Text
  commentMessages       String?  @db.Text
  featuredProductId     String?
  company               Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  featuredProduct       Product? @relation(fields: [featuredProductId], references: [id])

  @@unique([postId, companyId])
  @@index([postId])
  @@index([companyId])
  @@index([featuredProductId])
  @@map("post_response_settings")
}

model PageResponseSettings {
  id                    String   @id @default(cuid())
  pageId                String
  companyId             String
  responseMethod        String
  fixedMessengerMessage String?  @db.Text
  aiPrompt              String?  @db.Text
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  commentMessages       String?  @db.Text
  company               Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([pageId, companyId])
  @@index([pageId])
  @@index([companyId])
  @@map("page_response_settings")
}

model Branch {
  id           String   @id @default(cuid())
  name         String
  address      String?
  city         String?
  phone        String
  email        String?
  workingHours String?
  isActive     Boolean  @default(true)
  companyId    String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  company      Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([isActive])
  @@map("branches")
}

model ShippingZone {
  id           String   @id @default(cuid())
  governorates String   @db.LongText
  price        Decimal  @db.Decimal(10, 2)
  deliveryTime String
  isActive     Boolean  @default(true)
  companyId    String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  company      Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([isActive])
  @@map("shipping_zones")
}

model GuestCart {
  id        String   @id @default(cuid())
  cartId    String   @unique
  items     String   @db.LongText
  total     Decimal  @default(0.00) @db.Decimal(10, 2)
  companyId String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  expiresAt DateTime
  company   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([cartId])
  @@index([companyId])
  @@index([expiresAt])
  @@map("guest_carts")
}

model GuestOrder {
  id              String   @id @default(cuid())
  orderNumber     String   @unique
  guestEmail      String
  guestPhone      String
  guestName       String
  items           String   @db.LongText
  total           Decimal  @db.Decimal(10, 2)
  shippingCost    Decimal  @default(0.00) @db.Decimal(10, 2)
  discountAmount  Decimal  @default(0.00) @db.Decimal(10, 2)
  finalTotal      Decimal  @db.Decimal(10, 2)
  shippingAddress String   @db.LongText
  paymentMethod   String
  status          String   @default("pending")
  notes           String?  @db.Text
  companyId       String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @default(now()) @updatedAt
  company         Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([orderNumber])
  @@index([guestEmail])
  @@index([companyId])
  @@index([status])
  @@index([createdAt])
  @@map("guest_orders")
}

model CheckoutFormSettings {
  id                     String   @id @default(cuid())
  companyId              String   @unique
  showGuestName          Boolean  @default(true)
  requireGuestName       Boolean  @default(true)
  showGuestPhone         Boolean  @default(true)
  requireGuestPhone      Boolean  @default(true)
  showGuestEmail         Boolean  @default(true)
  requireGuestEmail      Boolean  @default(false)
  showCity               Boolean  @default(true)
  requireCity            Boolean  @default(true)
  showShippingAddress    Boolean  @default(true)
  requireShippingAddress Boolean  @default(true)
  showPaymentMethod      Boolean  @default(true)
  showNotes              Boolean  @default(true)
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  company                Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("checkout_form_settings")
}

model StorePromotionSettings {
  id                    String   @id @default(cuid())
  companyId             String   @unique
  freeShippingEnabled   Boolean  @default(false)
  freeShippingThreshold Decimal  @default(0.00) @db.Decimal(10, 2)
  freeShippingMessage   String?  @db.Text
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  company               Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("store_promotion_settings")
}

model StorefrontSettings {
  id                               String    @id @default(cuid())
  companyId                        String    @unique
  quickViewEnabled                 Boolean   @default(true)
  quickViewShowAddToCart           Boolean   @default(true)
  quickViewShowWishlist            Boolean   @default(true)
  comparisonEnabled                Boolean   @default(true)
  maxComparisonProducts            Int       @default(4)
  comparisonShowPrice              Boolean   @default(true)
  comparisonShowSpecs              Boolean   @default(true)
  wishlistEnabled                  Boolean   @default(true)
  wishlistRequireLogin             Boolean   @default(false)
  wishlistMaxItems                 Int       @default(100)
  advancedFiltersEnabled           Boolean   @default(true)
  filterByPrice                    Boolean   @default(true)
  filterByRating                   Boolean   @default(true)
  filterByBrand                    Boolean   @default(false)
  filterByAttributes               Boolean   @default(true)
  reviewsEnabled                   Boolean   @default(true)
  reviewsRequirePurchase           Boolean   @default(false)
  reviewsModerationEnabled         Boolean   @default(true)
  reviewsShowRating                Boolean   @default(true)
  minRatingToDisplay               Int       @default(1)
  countdownEnabled                 Boolean   @default(true)
  countdownShowOnProduct           Boolean   @default(true)
  countdownShowOnListing           Boolean   @default(false)
  backInStockEnabled               Boolean   @default(true)
  backInStockNotifyEmail           Boolean   @default(true)
  backInStockNotifySMS             Boolean   @default(false)
  recentlyViewedEnabled            Boolean   @default(true)
  recentlyViewedCount              Int       @default(8)
  recentlyViewedDays               Int       @default(30)
  imageZoomEnabled                 Boolean   @default(true)
  imageZoomType                    String    @default("hover")
  productVideosEnabled             Boolean   @default(true)
  videoAutoplay                    Boolean   @default(false)
  videoShowControls                Boolean   @default(true)
  sizeGuideEnabled                 Boolean   @default(true)
  sizeGuideShowOnProduct           Boolean   @default(true)
  socialSharingEnabled             Boolean   @default(true)
  shareFacebook                    Boolean   @default(true)
  shareTwitter                     Boolean   @default(true)
  shareWhatsApp                    Boolean   @default(true)
  shareTelegram                    Boolean   @default(true)
  badgesEnabled                    Boolean   @default(true)
  badgeNew                         Boolean   @default(true)
  badgeBestSeller                  Boolean   @default(true)
  badgeOnSale                      Boolean   @default(true)
  badgeOutOfStock                  Boolean   @default(true)
  tabsEnabled                      Boolean   @default(true)
  tabDescription                   Boolean   @default(true)
  tabSpecifications                Boolean   @default(true)
  tabReviews                       Boolean   @default(true)
  tabShipping                      Boolean   @default(true)
  stickyAddToCartEnabled           Boolean   @default(true)
  stickyShowOnMobile               Boolean   @default(true)
  stickyShowOnDesktop              Boolean   @default(true)
  seoEnabled                       Boolean   @default(true)
  seoMetaDescription               Boolean   @default(true)
  seoStructuredData                Boolean   @default(true)
  seoSitemap                       Boolean   @default(true)
  seoOpenGraph                     Boolean   @default(true)
  multiLanguageEnabled             Boolean   @default(false)
  defaultLanguage                  String    @default("ar")
  supportedLanguages               String    @db.LongText
  createdAt                        DateTime  @default(now())
  updatedAt                        DateTime  @updatedAt
  capiStatus                       String?   @default("not_configured")
  capiTrackAddToCart               Boolean   @default(true)
  capiTrackInitiateCheckout        Boolean   @default(true)
  capiTrackPageView                Boolean   @default(true)
  capiTrackPurchase                Boolean   @default(true)
  capiTrackSearch                  Boolean   @default(true)
  capiTrackViewContent             Boolean   @default(true)
  eventDeduplicationEnabled        Boolean   @default(true)
  eventMatchQualityTarget          Int       @default(8)
  facebookConvApiEnabled           Boolean   @default(false)
  facebookConvApiTestCode          String?
  facebookConvApiToken             String?   @db.Text
  facebookPixelEnabled             Boolean   @default(false)
  facebookPixelId                  String?
  gdprCompliant                    Boolean   @default(true)
  hashUserData                     Boolean   @default(true)
  lastCapiTest                     DateTime?
  lastPixelTest                    DateTime?
  pixelStatus                      String?   @default("not_configured")
  pixelTrackAddToCart              Boolean   @default(true)
  pixelTrackAddToWishlist          Boolean   @default(false)
  pixelTrackInitiateCheckout       Boolean   @default(true)
  pixelTrackPageView               Boolean   @default(true)
  pixelTrackPurchase               Boolean   @default(true)
  pixelTrackSearch                 Boolean   @default(true)
  pixelTrackViewContent            Boolean   @default(true)
  stickyAutoScrollToCheckout       Boolean   @default(false)
  stickyScrollThreshold            Int       @default(300)
  stickyShowBuyNow                 Boolean   @default(true)
  stickyTrackAnalytics             Boolean   @default(true)
  stickyShowAddToCartButton        Boolean   @default(true)
  stickyShowProductImage           Boolean   @default(true)
  stickyShowProductName            Boolean   @default(true)
  stickyShowQuantity               Boolean   @default(true)
  badgeBuyerProtection             Boolean   @default(true)
  badgeCashOnDelivery              Boolean   @default(true)
  badgeCustom1                     Boolean   @default(false)
  badgeCustom1Text                 String?
  badgeCustom2                     Boolean   @default(false)
  badgeCustom2Text                 String?
  badgeFreeShipping                Boolean   @default(true)
  badgeHighRating                  Boolean   @default(true)
  badgeLayout                      String    @default("horizontal")
  badgeQualityGuarantee            Boolean   @default(true)
  badgeSecurePayment               Boolean   @default(true)
  keyboardShortcuts                Boolean   @default(true)
  navigationEnabled                Boolean   @default(false)
  navigationType                   String    @default("sameCategory")
  onlineVisitorsEnabled            Boolean   @default(false)
  onlineVisitorsMax                Int       @default(50)
  onlineVisitorsMin                Int       @default(5)
  onlineVisitorsText               String    @default("{count}     ")
  onlineVisitorsType               String    @default("fake")
  onlineVisitorsUpdateInterval     Int       @default(30)
  reasonsToPurchaseEnabled         Boolean   @default(false)
  reasonsToPurchaseList            String?   @db.Text
  reasonsToPurchaseMaxItems        Int       @default(4)
  reasonsToPurchaseStyle           String    @default("list")
  reasonsToPurchaseType            String    @default("global")
  securityBadgesEnabled            Boolean   @default(false)
  showNavigationButtons            Boolean   @default(true)
  soldNumberEnabled                Boolean   @default(false)
  soldNumberMax                    Int       @default(500)
  soldNumberMin                    Int       @default(10)
  soldNumberText                   String    @default("  {count} ")
  soldNumberType                   String    @default("real")
  stockProgressEnabled             Boolean   @default(false)
  stockProgressHighColor           String    @default("#10b981")
  stockProgressLowColor            String    @default("#ef4444")
  stockProgressMediumColor         String    @default("#f59e0b")
  stockProgressThreshold           Int       @default(10)
  stockProgressType                String    @default("percentage")
  variantColorShowName             Boolean   @default(true)
  variantColorSize                 String    @default("medium")
  variantColorStyle                String    @default("buttons")
  variantSizeShowGuide             Boolean   @default(false)
  variantSizeShowStock             Boolean   @default(true)
  variantSizeStyle                 String    @default("buttons")
  estimatedDeliveryDefaultText     String    @default("  {time}")
  estimatedDeliveryEnabled         Boolean   @default(false)
  estimatedDeliveryShowOnProduct   Boolean   @default(true)
  fomoDelay                        Int       @default(30)
  fomoEnabled                      Boolean   @default(false)
  fomoMessage                      String?   @db.Text
  fomoShowOncePerSession           Boolean   @default(true)
  fomoTrigger                      String    @default("time")
  fomoType                         String    @default("soldCount")
  productPageLayoutEnabled         Boolean   @default(false)
  productPageOrder                 String?   @db.Text
  productPageShowActions           Boolean   @default(true)
  productPageShowBackInStock       Boolean   @default(true)
  productPageShowBadges            Boolean   @default(true)
  productPageShowCategory          Boolean   @default(true)
  productPageShowCheckoutForm      Boolean   @default(true)
  productPageShowCountdown         Boolean   @default(true)
  productPageShowDescription       Boolean   @default(true)
  productPageShowEstimatedDelivery Boolean   @default(true)
  productPageShowFreeShipping      Boolean   @default(true)
  productPageShowOnlineVisitors    Boolean   @default(true)
  productPageShowPreOrder          Boolean   @default(true)
  productPageShowPrice             Boolean   @default(true)
  productPageShowQuantity          Boolean   @default(true)
  productPageShowReasonsToPurchase Boolean   @default(true)
  productPageShowSKU               Boolean   @default(true)
  productPageShowSecurityBadges    Boolean   @default(true)
  productPageShowSizeGuide         Boolean   @default(true)
  productPageShowSocialSharing     Boolean   @default(true)
  productPageShowSoldNumber        Boolean   @default(true)
  productPageShowStockProgress     Boolean   @default(true)
  productPageShowStockStatus       Boolean   @default(true)
  productPageShowTabs              Boolean   @default(true)
  productPageShowTitle             Boolean   @default(true)
  productPageShowVariants          Boolean   @default(true)
  productPageShowVolumeDiscounts   Boolean   @default(true)
  galleryLayout                    String    @default("bottom")
  galleryStyle                     String    @default("slider")
  imageBorderRadius                Int       @default(8)
  imageHoverEffect                 String    @default("zoom")
  imageLoadingEffect               String    @default("skeleton")
  imagePlaceholder                 String    @default("?")
  imageShadow                      Boolean   @default(true)
  lightboxBackgroundColor          String    @default("rgba(0,0,0,0.9)")
  lightboxCloseOnOverlay           Boolean   @default(true)
  lightboxEnabled                  Boolean   @default(true)
  lightboxKeyboardNav              Boolean   @default(true)
  lightboxShowArrows               Boolean   @default(true)
  lightboxShowCounter              Boolean   @default(true)
  lightboxShowThumbnails           Boolean   @default(true)
  lightboxZoomEnabled              Boolean   @default(true)
  mainImageAspectRatio             String    @default("1:1")
  mobileFullscreenOnTap            Boolean   @default(true)
  mobileGalleryLayout              String    @default("slider")
  mobilePinchZoom                  Boolean   @default(true)
  mobileShowThumbnails             Boolean   @default(false)
  mobileSwipeEnabled               Boolean   @default(true)
  mouseWheelZoom                   Boolean   @default(false)
  sliderAutoplay                   Boolean   @default(false)
  sliderAutoplaySpeed              Int       @default(3000)
  sliderEnabled                    Boolean   @default(true)
  sliderInfiniteLoop               Boolean   @default(true)
  sliderShowArrows                 Boolean   @default(true)
  sliderShowDots                   Boolean   @default(false)
  sliderTransitionEffect           String    @default("slide")
  sliderTransitionSpeed            Int       @default(300)
  thumbnailBorderRadius            Int       @default(8)
  thumbnailSize                    String    @default("medium")
  thumbnailSpacing                 Int       @default(8)
  thumbnailsPerRow                 Int       @default(4)
  variationImagesAnimation         String    @default("fade")
  variationImagesBehavior          String    @default("replace")
  variationImagesEnabled           Boolean   @default(true)
  videoMuted                       Boolean   @default(true)
  videoPlayMode                    String    @default("inline")
  videoPosition                    String    @default("end")
  videoSources                     String    @default("[\"youtube\", \"vimeo\", \"self-hosted\"]")
  videoThumbnailIcon               Boolean   @default(true)
  view360AutoRotate                Boolean   @default(true)
  view360Enabled                   Boolean   @default(false)
  view360RotateSpeed               Int       @default(5)
  view360ShowControls              Boolean   @default(true)
  zoomLensShape                    String    @default("square")
  zoomLensSize                     Int       @default(150)
  zoomLevel                        Float     @default(2.5)
  zoomStyle                        String    @default("side")
  zoomWindowPosition               String    @default("right")
  zoomWindowSize                   Int       @default(400)
  mobileBottomNavbarEnabled        Boolean   @default(true)
  mobileBottomNavbarShowAccount    Boolean   @default(true)
  mobileBottomNavbarShowCart       Boolean   @default(false)
  mobileBottomNavbarShowCompare    Boolean   @default(true)
  mobileBottomNavbarShowHome       Boolean   @default(true)
  mobileBottomNavbarShowSearch     Boolean   @default(false)
  mobileBottomNavbarShowShop       Boolean   @default(true)
  mobileBottomNavbarShowWishlist   Boolean   @default(true)
  company                          Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([facebookPixelEnabled])
  @@index([facebookConvApiEnabled])
  @@map("storefront_settings")
}

model DeliveryOption {
  id           String   @id @default(cuid())
  name         String
  description  String?  @db.Text
  deliveryTime String
  price        Decimal  @db.Decimal(10, 2)
  isDefault    Boolean  @default(false)
  isActive     Boolean  @default(true)
  icon         String?
  sortOrder    Int      @default(0)
  companyId    String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  company      Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([isActive])
  @@map("delivery_options")
}

model ImageGallery {
  id        String   @id @default(cuid())
  userId    String
  companyId String
  filename  String
  fileUrl   String
  fileType  String
  fileSize  Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  company   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([companyId])
  @@index([createdAt])
  @@map("image_gallery")
}

model TextGallery {
  id        String   @id @default(cuid())
  userId    String
  companyId String
  title     String?
  content   String   @db.Text
  imageUrls String?  @db.LongText
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  isPinned  Boolean  @default(false)
  company   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([companyId])
  @@index([createdAt])
  @@map("text_gallery")
}

model PostTracking {
  id           String   @id @default(cuid())
  postId       String
  companyId    String
  visitCount   Int      @default(1)
  firstVisitAt DateTime @default(now())
  lastVisitAt  DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  company      Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([postId, companyId])
  @@index([postId])
  @@index([companyId])
  @@index([lastVisitAt])
  @@map("post_tracking")
}

model FooterSettings {
  id             String   @id @default(cuid())
  companyId      String   @unique
  aboutStore     String?  @db.Text
  showAboutStore Boolean  @default(true)
  email          String?
  showEmail      Boolean  @default(true)
  phone          String?
  showPhone      Boolean  @default(true)
  address        String?  @db.Text
  showAddress    Boolean  @default(true)
  showQuickLinks Boolean  @default(true)
  copyrightText  String?  @db.Text
  showCopyright  Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  company        Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("footer_settings")
}

model Wishlist {
  id         String   @id @default(cuid())
  sessionId  String
  customerId String?
  productId  String
  variantId  String?
  companyId  String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  company    Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  product    Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([sessionId, productId, variantId, companyId])
  @@index([sessionId])
  @@index([customerId])
  @@index([companyId])
  @@index([productId], map: "wishlists_productId_fkey")
  @@map("wishlists")
}

model RecentlyViewed {
  id        String   @id @default(cuid())
  sessionId String
  productId String
  companyId String
  viewedAt  DateTime @default(now())
  company   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([sessionId, productId, companyId])
  @@index([sessionId, companyId])
  @@index([viewedAt])
  @@index([companyId], map: "recently_viewed_companyId_fkey")
  @@index([productId], map: "recently_viewed_productId_fkey")
  @@map("recently_viewed")
}

model ProductReview {
  id            String   @id @default(cuid())
  productId     String
  companyId     String
  customerName  String
  customerEmail String?
  customerPhone String?
  rating        Int
  title         String?
  comment       String?  @db.Text
  isVerified    Boolean  @default(false)
  isApproved    Boolean  @default(false)
  helpfulCount  Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  company       Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  product       Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([companyId])
  @@index([isApproved])
  @@index([rating])
  @@map("product_reviews")
}

model BackInStockNotification {
  id            String    @id @default(cuid())
  productId     String
  companyId     String
  customerName  String
  customerEmail String?
  customerPhone String?
  notifyEmail   Boolean   @default(true)
  notifySMS     Boolean   @default(false)
  isNotified    Boolean   @default(false)
  notifiedAt    DateTime?
  createdAt     DateTime  @default(now())
  company       Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  product       Product   @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([companyId])
  @@index([isNotified])
  @@map("back_in_stock_notifications")
}

model StorePage {
  id              String        @id @default(cuid())
  companyId       String
  title           String
  slug            String
  content         String        @db.Text
  pageType        StorePageType @default(CUSTOM)
  isActive        Boolean       @default(true)
  showInFooter    Boolean       @default(true)
  showInMenu      Boolean       @default(false)
  order           Int           @default(0)
  metaTitle       String?
  metaDescription String?       @db.Text
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  company         Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, slug])
  @@index([companyId])
  @@index([slug])
  @@index([isActive])
  @@map("store_pages")
}

model Coupon {
  id                String        @id @default(cuid())
  companyId         String
  code              String
  name              String
  description       String?       @db.Text
  type              CouponType    @default(PERCENTAGE)
  value             Decimal       @db.Decimal(10, 2)
  minOrderAmount    Decimal?      @db.Decimal(10, 2)
  maxDiscountAmount Decimal?      @db.Decimal(10, 2)
  usageLimit        Int?
  usageCount        Int           @default(0)
  userUsageLimit    Int?
  validFrom         DateTime
  validTo           DateTime
  isActive          Boolean       @default(true)
  customerSegments  String?       @db.Text
  metadata          String?       @db.Text
  createdBy         String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  usages            CouponUsage[]
  company           Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, code])
  @@index([companyId])
  @@index([code])
  @@index([isActive])
  @@index([validFrom, validTo])
  @@map("coupons")
}

model CouponUsage {
  id             String   @id @default(cuid())
  couponId       String
  companyId      String
  customerId     String?
  orderId        String?
  discountAmount Decimal  @db.Decimal(10, 2)
  orderAmount    Decimal  @db.Decimal(10, 2)
  usedAt         DateTime @default(now())
  coupon         Coupon   @relation(fields: [couponId], references: [id], onDelete: Cascade)

  @@index([couponId])
  @@index([companyId])
  @@index([customerId])
  @@index([orderId])
  @@index([usedAt])
  @@map("coupon_usages")
}

model HomepageTemplate {
  id          String   @id @default(cuid())
  companyId   String
  name        String
  description String?  @db.Text
  content     String   @db.LongText
  thumbnail   String?  @db.Text
  isActive    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([isActive])
  @@map("homepage_templates")
}

model WhatsAppSession {
  id                  String                @id @default(cuid())
  companyId           String
  name                String
  phoneNumber         String?
  status              WhatsAppSessionStatus @default(DISCONNECTED)
  lastConnectedAt     DateTime?
  lastDisconnectedAt  DateTime?
  authState           String?               @db.LongText
  isDefault           Boolean               @default(false)
  aiEnabled           Boolean               @default(true)
  autoReply           Boolean               @default(false)
  aiMode              String                @default("suggest")
  welcomeMessage      String?               @db.Text
  awayMessage         String?               @db.Text
  workingHoursEnabled Boolean               @default(false)
  workingHours        String?               @db.Text
  metadata            String?               @db.Text
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  profileName         String?
  profilePictureUrl   String?               @db.Text
  profileStatus       String?
  contacts            WhatsAppContact[]
  messages            WhatsAppMessage[]
  company             Company               @relation(fields: [companyId], references: [id], onDelete: Cascade)
  statuses            WhatsAppStatus[]

  @@index([companyId])
  @@index([status])
  @@index([phoneNumber])
  @@map("whatsapp_sessions")
}

model WhatsAppMessage {
  id              String                @id @default(cuid())
  sessionId       String
  remoteJid       String
  messageId       String                @unique
  fromMe          Boolean
  messageType     WhatsAppMessageType   @default(TEXT)
  content         String?               @db.Text
  mediaUrl        String?               @db.Text
  mediaType       String?
  mediaMimeType   String?
  mediaSize       Int?
  mediaFileName   String?
  quotedMessageId String?
  quotedContent   String?               @db.Text
  status          WhatsAppMessageStatus @default(SENT)
  timestamp       DateTime
  isAIResponse    Boolean               @default(false)
  aiConfidence    Float?
  interactiveData String?               @db.Text
  metadata        String?               @db.Text
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt
  senderId        String?
  participant     String?
  sender          User?                 @relation(fields: [senderId], references: [id])
  session         WhatsAppSession       @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@index([remoteJid])
  @@index([timestamp])
  @@index([sessionId, remoteJid])
  @@index([sessionId, timestamp])
  @@index([senderId], map: "whatsapp_messages_senderId_fkey")
  @@map("whatsapp_messages")
}

model WhatsAppContact {
  id            String          @id @default(cuid())
  sessionId     String
  jid           String
  phoneNumber   String
  name          String?
  pushName      String?
  profilePicUrl String?         @db.Text
  isGroup       Boolean         @default(false)
  isBlocked     Boolean         @default(false)
  customerId    String?
  category      String?         @default("LEAD")
  tags          String?         @db.Text
  notes         String?         @db.Text
  lastMessageAt DateTime?
  unreadCount   Int             @default(0)
  totalMessages Int             @default(0)
  isArchived    Boolean         @default(false)
  isPinned      Boolean         @default(false)
  isMuted       Boolean         @default(false)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  customer      Customer?       @relation(fields: [customerId], references: [id])
  session       WhatsAppSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@unique([sessionId, jid])
  @@index([sessionId])
  @@index([phoneNumber])
  @@index([customerId])
  @@index([lastMessageAt])
  @@index([category])
  @@map("whatsapp_contacts")
}

model WhatsAppStatus {
  id            String                 @id @default(cuid())
  sessionId     String
  remoteJid     String
  messageId     String                 @unique
  type          whatsapp_statuses_type @default(TEXT)
  content       String?                @db.Text
  mediaUrl      String?                @db.Text
  mediaType     String?
  mediaMimeType String?
  timestamp     DateTime
  expiresAt     DateTime
  isViewed      Boolean                @default(false)
  viewedAt      DateTime?
  metadata      String?                @db.Text
  createdAt     DateTime               @default(now())
  updatedAt     DateTime               @updatedAt
  session       WhatsAppSession        @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@index([remoteJid])
  @@index([expiresAt])
  @@index([timestamp])
  @@map("whatsapp_statuses")
}

model WhatsAppQuickReply {
  id         String    @id @default(cuid())
  companyId  String
  title      String
  shortcut   String?
  content    String    @db.Text
  category   String    @default("general")
  variables  String?   @db.Text
  mediaUrl   String?   @db.Text
  mediaType  String?
  usageCount Int       @default(0)
  lastUsedAt DateTime?
  isActive   Boolean   @default(true)
  sortOrder  Int       @default(0)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  company    Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, shortcut])
  @@index([companyId])
  @@index([category])
  @@index([isActive])
  @@map("whatsapp_quick_replies")
}

model WhatsAppSettings {
  id                   String   @id @default(cuid())
  companyId            String   @unique
  isEnabled            Boolean  @default(true)
  maxSessions          Int      @default(3)
  notificationSound    Boolean  @default(true)
  browserNotifications Boolean  @default(true)
  defaultAIMode        String   @default("suggest")
  aiWelcomeEnabled     Boolean  @default(false)
  aiAwayEnabled        Boolean  @default(false)
  maxImageSize         Int      @default(16)
  maxVideoSize         Int      @default(64)
  maxDocumentSize      Int      @default(100)
  autoCompressImages   Boolean  @default(true)
  autoArchiveDays      Int?
  metadata             String?  @db.Text
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  company              Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@map("whatsapp_settings")
}

model WhatsAppEventLog {
  id        String   @id @default(cuid())
  sessionId String
  companyId String
  eventType String
  eventData String?  @db.Text
  level     String   @default("info")
  createdAt DateTime @default(now())

  @@index([sessionId])
  @@index([companyId])
  @@index([eventType])
  @@index([createdAt])
  @@map("whatsapp_event_logs")
}

model FacebookAdAccount {
  id                 String                      @id @default(cuid())
  companyId          String
  accountId          String
  name               String
  currency           String                      @default("USD")
  timezone           String?
  accessToken        String                      @db.Text
  isActive           Boolean                     @default(true)
  settings           String?                     @db.Text
  createdAt          DateTime                    @default(now())
  updatedAt          DateTime                    @updatedAt
  company            Company                     @relation(fields: [companyId], references: [id], onDelete: Cascade)
  campaigns          FacebookCampaign[]
  customAudiences    FacebookCustomAudience[]
  lookalikeAudiences FacebookLookalikeAudience[]
  productCatalogs    FacebookProductCatalog[]

  @@unique([companyId, accountId])
  @@index([companyId])
  @@index([accountId])
  @@map("facebook_ad_accounts")
}

model FacebookCampaign {
  id                 String             @id @default(cuid())
  companyId          String
  adAccountId        String?
  name               String
  objective          String
  status             String             @default("PAUSED")
  facebookCampaignId String?
  budgetType         String
  budgetAmount       Float
  startDate          DateTime?
  endDate            DateTime?
  pixelId            String?
  settings           String?            @db.Text
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  lastSyncAt         DateTime?
  adTests            FacebookAdTest[]
  adSets             FacebookAdSet[]
  adAccount          FacebookAdAccount? @relation(fields: [adAccountId], references: [id])
  company            Company            @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([status])
  @@index([facebookCampaignId])
  @@index([adAccountId], map: "facebook_campaigns_adAccountId_fkey")
  @@map("facebook_campaigns")
}

model FacebookAdSet {
  id                     String                      @id @default(cuid())
  campaignId             String
  name                   String
  status                 String                      @default("PAUSED")
  facebookAdSetId        String?
  targeting              String?                     @db.Text
  ageMin                 Int?
  ageMax                 Int?
  genders                String?                     @db.Text
  locations              String?                     @db.Text
  interests              String?                     @db.Text
  behaviors              String?                     @db.Text
  customAudiencesJson    String?                     @db.Text
  lookalikeAudiencesJson String?                     @db.Text
  budgetType             String
  budgetAmount           Float
  optimizationGoal       String?
  billingEvent           String?
  settings               String?                     @db.Text
  createdAt              DateTime                    @default(now())
  updatedAt              DateTime                    @updatedAt
  lastSyncAt             DateTime?
  testVariants           FacebookAdTestVariant[]
  ads                    FacebookAd[]
  campaign               FacebookCampaign            @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  dynamicAds             FacebookDynamicAd[]
  customAudiences        FacebookCustomAudience[]    @relation("AdSetCustomAudiences")
  lookalikeAudiences     FacebookLookalikeAudience[] @relation("AdSetLookalikeAudiences")

  @@index([campaignId])
  @@index([status])
  @@index([facebookAdSetId])
  @@map("facebook_adsets")
}

model FacebookAd {
  id             String                  @id @default(cuid())
  adSetId        String
  companyId      String
  name           String
  status         String                  @default("PAUSED")
  facebookAdId   String?
  creativeType   String
  primaryText    String                  @db.Text
  headline       String?
  description    String?                 @db.Text
  callToAction   String?
  imageUrl       String?
  videoUrl       String?
  imageHash      String?
  videoId        String?
  carouselImages String?                 @db.Text
  carouselCount  Int?                    @default(1)
  linkUrl        String?
  productId      String?
  creative       String?                 @db.Text
  createdAt      DateTime                @default(now())
  updatedAt      DateTime                @updatedAt
  lastSyncAt     DateTime?
  insights       FacebookAdInsight[]
  testVariants   FacebookAdTestVariant[]
  adSet          FacebookAdSet           @relation(fields: [adSetId], references: [id], onDelete: Cascade)

  @@index([adSetId])
  @@index([companyId])
  @@index([status])
  @@index([facebookAdId])
  @@map("facebook_ads")
}

model FacebookAdInsight {
  id               String     @id @default(cuid())
  adId             String
  date             DateTime
  impressions      Int        @default(0)
  clicks           Int        @default(0)
  ctr              Float      @default(0)
  cpc              Float      @default(0)
  spend            Float      @default(0)
  conversions      Int        @default(0)
  cpa              Float      @default(0)
  reach            Int        @default(0)
  frequency        Float      @default(0)
  linkClicks       Int        @default(0)
  costPerLinkClick Float      @default(0)
  landingPageViews Int        @default(0)
  purchases        Int        @default(0)
  purchaseValue    Float      @default(0)
  roas             Float      @default(0)
  breakdown        String?    @db.Text
  createdAt        DateTime   @default(now())
  ad               FacebookAd @relation(fields: [adId], references: [id], onDelete: Cascade)

  @@unique([adId, date])
  @@index([adId])
  @@index([date])
  @@map("facebook_ad_insights")
}

model FacebookCustomAudience {
  id                 String                      @id @default(cuid())
  companyId          String
  adAccountId        String?
  name               String
  description        String?                     @db.Text
  audienceType       String
  facebookAudienceId String?
  customerListId     String?
  matchRate          Float?
  pixelId            String?
  eventType          String?
  retentionDays      Int?                        @default(30)
  engagementType     String?
  videoId            String?
  videoViewDuration  Int?
  status             String                      @default("ACTIVE")
  audienceSize       Int?
  settings           String?                     @db.Text
  createdAt          DateTime                    @default(now())
  updatedAt          DateTime                    @updatedAt
  lastSyncAt         DateTime?
  adAccount          FacebookAdAccount?          @relation(fields: [adAccountId], references: [id])
  company            Company                     @relation(fields: [companyId], references: [id], onDelete: Cascade)
  lookalikeAudiences FacebookLookalikeAudience[]
  adSets             FacebookAdSet[]             @relation("AdSetCustomAudiences")

  @@index([companyId])
  @@index([adAccountId])
  @@index([status])
  @@index([facebookAudienceId])
  @@map("facebook_custom_audiences")
}

model FacebookLookalikeAudience {
  id                 String                 @id @default(cuid())
  companyId          String
  adAccountId        String?
  sourceAudienceId   String
  name               String
  description        String?                @db.Text
  facebookAudienceId String?
  lookalikeSpec      String
  country            String
  ratio              Int                    @default(1)
  status             String                 @default("ACTIVE")
  audienceSize       Int?
  settings           String?                @db.Text
  createdAt          DateTime               @default(now())
  updatedAt          DateTime               @updatedAt
  lastSyncAt         DateTime?
  adAccount          FacebookAdAccount?     @relation(fields: [adAccountId], references: [id])
  company            Company                @relation(fields: [companyId], references: [id], onDelete: Cascade)
  sourceAudience     FacebookCustomAudience @relation(fields: [sourceAudienceId], references: [id], onDelete: Cascade)
  adSets             FacebookAdSet[]        @relation("AdSetLookalikeAudiences")

  @@index([companyId])
  @@index([adAccountId])
  @@index([sourceAudienceId])
  @@index([status])
  @@index([facebookAudienceId])
  @@map("facebook_lookalike_audiences")
}

model FacebookProductCatalog {
  id                String                   @id @default(cuid())
  companyId         String
  adAccountId       String?
  name              String
  description       String?                  @db.Text
  facebookCatalogId String?
  catalogType       String                   @default("PRODUCTS")
  isActive          Boolean                  @default(true)
  status            String                   @default("ACTIVE")
  lastSyncAt        DateTime?
  lastSyncStatus    String?
  totalProducts     Int                      @default(0)
  syncedProducts    Int                      @default(0)
  settings          String?                  @db.Text
  createdAt         DateTime                 @default(now())
  updatedAt         DateTime                 @updatedAt
  products          FacebookCatalogProduct[]
  dynamicAds        FacebookDynamicAd[]
  adAccount         FacebookAdAccount?       @relation(fields: [adAccountId], references: [id])
  company           Company                  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  feeds             FacebookProductFeed[]

  @@unique([companyId, facebookCatalogId])
  @@index([companyId])
  @@index([adAccountId])
  @@index([status])
  @@index([facebookCatalogId])
  @@map("facebook_product_catalogs")
}

model FacebookCatalogProduct {
  id                 String                 @id @default(cuid())
  catalogId          String
  productId          String?
  name               String
  description        String?                @db.Text
  brand              String?
  category           String?
  sku                String?
  price              Decimal?               @db.Decimal(10, 2)
  currency           String?                @default("USD")
  availability       String                 @default("in stock")
  inventory          Int?
  imageUrl           String?
  imageHash          String?
  additionalImages   String?                @db.Text
  linkUrl            String?
  mobileLinkUrl      String?
  facebookProductId  String?
  facebookRetailerId String?
  syncStatus         String                 @default("PENDING")
  lastSyncedAt       DateTime?
  syncError          String?                @db.Text
  metadata           String?                @db.Text
  createdAt          DateTime               @default(now())
  updatedAt          DateTime               @updatedAt
  catalog            FacebookProductCatalog @relation(fields: [catalogId], references: [id], onDelete: Cascade)
  product            Product?               @relation(fields: [productId], references: [id])

  @@unique([catalogId, productId])
  @@unique([catalogId, sku])
  @@index([catalogId])
  @@index([productId])
  @@index([facebookProductId])
  @@index([syncStatus])
  @@map("facebook_catalog_products")
}

model FacebookProductFeed {
  id             String                 @id @default(cuid())
  catalogId      String
  name           String
  feedType       String                 @default("PRODUCT")
  format         String                 @default("CSV")
  fileUrl        String?
  fileName       String?
  fileSize       Int?
  facebookFeedId String?
  feedUrl        String?
  schedule       String?
  lastUploadedAt DateTime?
  nextUploadAt   DateTime?
  status         String                 @default("ACTIVE")
  uploadStatus   String?
  settings       String?                @db.Text
  createdAt      DateTime               @default(now())
  updatedAt      DateTime               @updatedAt
  catalog        FacebookProductCatalog @relation(fields: [catalogId], references: [id], onDelete: Cascade)

  @@index([catalogId])
  @@index([status])
  @@index([facebookFeedId])
  @@map("facebook_product_feeds")
}

model FacebookDynamicAd {
  id           String                 @id @default(cuid())
  companyId    String
  catalogId    String
  adSetId      String?
  name         String
  status       String                 @default("PAUSED")
  facebookAdId String?
  productSetId String?
  templateUrl  String?
  templateId   String?
  collectionId String?
  categoryId   String?
  headline     String?
  description  String?                @db.Text
  callToAction String?
  createdAt    DateTime               @default(now())
  updatedAt    DateTime               @updatedAt
  lastSyncAt   DateTime?
  adSet        FacebookAdSet?         @relation(fields: [adSetId], references: [id])
  catalog      FacebookProductCatalog @relation(fields: [catalogId], references: [id], onDelete: Cascade)
  company      Company                @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, facebookAdId])
  @@index([companyId])
  @@index([catalogId])
  @@index([adSetId])
  @@index([status])
  @@index([facebookAdId])
  @@map("facebook_dynamic_ads")
}

model FacebookAdTest {
  id               String                  @id @default(cuid())
  companyId        String
  name             String
  description      String?                 @db.Text
  testType         String
  status           String                  @default("DRAFT")
  campaignId       String?
  variants         String                  @db.Text
  winnerVariantId  String?
  confidenceLevel  Float?
  testDuration     Int?
  startDate        DateTime?
  endDate          DateTime?
  trafficSplit     Int                     @default(50)
  minimumResults   Int                     @default(100)
  autoPromote      Boolean                 @default(false)
  totalSpend       Float                   @default(0)
  totalImpressions Int                     @default(0)
  totalClicks      Int                     @default(0)
  totalConversions Int                     @default(0)
  settings         String?                 @db.Text
  createdAt        DateTime                @default(now())
  updatedAt        DateTime                @updatedAt
  variantsList     FacebookAdTestVariant[]
  campaign         FacebookCampaign?       @relation(fields: [campaignId], references: [id])
  company          Company                 @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([campaignId])
  @@index([status])
  @@index([testType])
  @@map("facebook_ad_tests")
}

model FacebookAdTestVariant {
  id              String         @id @default(cuid())
  testId          String
  name            String
  variantType     String
  variantData     String         @db.Text
  adSetId         String?
  adId            String?
  impressions     Int            @default(0)
  clicks          Int            @default(0)
  conversions     Int            @default(0)
  spend           Float          @default(0)
  ctr             Float          @default(0)
  cpc             Float          @default(0)
  cpa             Float          @default(0)
  roas            Float          @default(0)
  isWinner        Boolean        @default(false)
  pValue          Float?
  confidenceLevel Float?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  ad              FacebookAd?    @relation(fields: [adId], references: [id])
  adSet           FacebookAdSet? @relation(fields: [adSetId], references: [id])
  test            FacebookAdTest @relation(fields: [testId], references: [id], onDelete: Cascade)

  @@index([testId])
  @@index([adSetId])
  @@index([adId])
  @@index([variantType])
  @@map("facebook_ad_test_variants")
}

model WooCommerceSettings {
  id                  String    @id @default(cuid())
  companyId           String    @unique
  storeUrl            String
  consumerKey         String    @db.Text
  consumerSecret      String    @db.Text
  syncEnabled         Boolean   @default(false)
  syncDirection       String    @default("both")
  syncInterval        Int       @default(15)
  webhookSecret       String?   @db.Text
  webhookEnabled      Boolean   @default(false)
  webhookOrderCreated String?
  webhookOrderUpdated String?
  statusMapping       String?   @db.Text
  lastSyncAt          DateTime?
  lastSyncStatus      String?   @default("never")
  lastSyncMessage     String?   @db.Text
  isActive            Boolean   @default(true)
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  company             Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@map("woocommerce_settings")
}

model WooCommerceSyncLog {
  id            String    @id @default(cuid())
  companyId     String
  syncType      String
  syncDirection String
  status        String
  totalItems    Int       @default(0)
  successCount  Int       @default(0)
  failedCount   Int       @default(0)
  skippedCount  Int       @default(0)
  errorMessage  String?   @db.Text
  errorDetails  String?   @db.Text
  startedAt     DateTime  @default(now())
  completedAt   DateTime?
  duration      Int?
  triggeredBy   String?
  metadata      String?   @db.Text
  company       Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([syncType])
  @@index([status])
  @@index([startedAt])
  @@map("woocommerce_sync_logs")
}

model OrderStatusConfig {
  id                  String   @id @default(cuid())
  companyId           String
  code                String
  name                String
  nameEn              String?
  description         String?  @db.Text
  color               String   @default("#6B7280")
  icon                String?
  sortOrder           Int      @default(0)
  statusType          String   @default("order")
  source              String   @default("system")
  isSystemStatus      Boolean  @default(false)
  isActive            Boolean  @default(true)
  mapsToSystem        String?
  wooCommerceStatus   String?
  allowedNextStatuses String?  @db.Text
  autoActions         String?  @db.Text
  notifyCustomer      Boolean  @default(false)
  notifyAdmin         Boolean  @default(false)
  emailTemplate       String?  @db.Text
  smsTemplate         String?  @db.Text
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  company             Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, code])
  @@index([companyId])
  @@index([statusType])
  @@index([source])
  @@map("order_status_configs")
}

model Department {
  id          String       @id @default(cuid())
  companyId   String
  name        String
  nameEn      String?
  code        String?
  description String?      @db.Text
  managerId   String?
  parentId    String?
  color       String?      @default("#3B82F6")
  icon        String?
  isActive    Boolean      @default(true)
  sortOrder   Int          @default(0)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  company     Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  manager     Employee?    @relation("DepartmentManager", fields: [managerId], references: [id])
  parent      Department?  @relation("DepartmentHierarchy", fields: [parentId], references: [id])
  children    Department[] @relation("DepartmentHierarchy")
  employees   Employee[]   @relation("EmployeeDepartment")
  goals       Goal[]
  positions   Position[]

  @@unique([companyId, code])
  @@index([companyId])
  @@index([managerId])
  @@index([parentId], map: "hr_departments_parentId_fkey")
  @@map("hr_departments")
}

model Position {
  id               String      @id @default(cuid())
  companyId        String
  departmentId     String?
  title            String
  titleEn          String?
  code             String?
  description      String?     @db.Text
  level            Int         @default(1)
  minSalary        Decimal?    @db.Decimal(12, 2)
  maxSalary        Decimal?    @db.Decimal(12, 2)
  requirements     String?     @db.Text
  responsibilities String?     @db.Text
  isActive         Boolean     @default(true)
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt
  employees        Employee[]
  company          Company     @relation(fields: [companyId], references: [id], onDelete: Cascade)
  department       Department? @relation(fields: [departmentId], references: [id])

  @@unique([companyId, code])
  @@index([companyId])
  @@index([departmentId])
  @@map("hr_positions")
}

model Employee {
  id                 String              @id @default(cuid())
  companyId          String
  userId             String?             @unique
  employeeNumber     String
  firstName          String
  lastName           String
  firstNameEn        String?
  lastNameEn         String?
  email              String?
  phone              String?
  mobile             String?
  avatar             String?
  dateOfBirth        DateTime?
  gender             Gender?
  nationality        String?
  nationalId         String?
  passportNumber     String?
  maritalStatus      MaritalStatus?
  address            String?             @db.Text
  city               String?
  country            String?
  postalCode         String?
  departmentId       String?
  positionId         String?
  managerId          String?
  hireDate           DateTime
  probationEndDate   DateTime?
  contractType       ContractType        @default(FULL_TIME)
  contractEndDate    DateTime?
  workLocation       String?
  baseSalary         Decimal?            @db.Decimal(12, 2)
  currency           String              @default("EGP")
  bankName           String?
  bankAccountNumber  String?
  bankIban           String?
  annualLeaveBalance Int                 @default(21)
  sickLeaveBalance   Int                 @default(15)
  status             EmployeeStatus      @default(ACTIVE)
  terminationDate    DateTime?
  terminationReason  String?             @db.Text
  emergencyContact   String?             @db.Text
  documents          String?             @db.Text
  notes              String?             @db.Text
  metadata           String?             @db.Text
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  attendances        Attendance[]
  benefitEnrollments BenefitEnrollment[]
  managedDepartments Department[]        @relation("DepartmentManager")
  documents_rel      EmployeeDocument[]
  trainings          EmployeeTraining[]
  warnings           EmployeeWarning[]
  company            Company             @relation(fields: [companyId], references: [id], onDelete: Cascade)
  department         Department?         @relation("EmployeeDepartment", fields: [departmentId], references: [id])
  manager            Employee?           @relation("EmployeeManager", fields: [managerId], references: [id])
  subordinates       Employee[]          @relation("EmployeeManager")
  position           Position?           @relation(fields: [positionId], references: [id])
  user               User?               @relation(fields: [userId], references: [id])
  feedbackFrom       Feedback[]          @relation("FeedbackFrom")
  feedbackTo         Feedback[]          @relation("FeedbackTo")
  goals              Goal[]
  approvedLeaves     LeaveRequest[]      @relation("LeaveApprover")
  leaveRequests      LeaveRequest[]      @relation("EmployeeLeaves")
  payrolls           Payroll[]
  performanceReviews PerformanceReview[] @relation("EmployeeReviews")
  givenReviews       PerformanceReview[] @relation("ReviewerReviews")
  resignations       Resignation[]
  salaryHistory      SalaryHistory[]
  shiftAssignments   ShiftAssignment[]

  @@unique([companyId, employeeNumber])
  @@index([companyId])
  @@index([departmentId])
  @@index([positionId])
  @@index([managerId])
  @@index([status])
  @@map("hr_employees")
}

model Attendance {
  id                String           @id @default(cuid())
  companyId         String
  employeeId        String
  date              DateTime         @db.Date
  checkIn           DateTime?
  checkOut          DateTime?
  checkInLocation   String?
  checkOutLocation  String?
  checkInMethod     String?
  checkOutMethod    String?
  workHours         Decimal?         @db.Decimal(5, 2)
  overtimeHours     Decimal?         @db.Decimal(5, 2)
  lateMinutes       Int?             @default(0)
  earlyLeaveMinutes Int?             @default(0)
  status            AttendanceStatus @default(PRESENT)
  isApproved        Boolean          @default(false)
  approvedBy        String?
  notes             String?          @db.Text
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  company           Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  employee          Employee         @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([employeeId, date])
  @@index([companyId])
  @@index([employeeId])
  @@index([date])
  @@index([status])
  @@map("hr_attendance")
}

model LeaveRequest {
  id              String      @id @default(cuid())
  companyId       String
  employeeId      String
  type            LeaveType
  startDate       DateTime    @db.Date
  endDate         DateTime    @db.Date
  totalDays       Int
  isHalfDay       Boolean     @default(false)
  halfDayPeriod   String?
  reason          String?     @db.Text
  attachments     String?     @db.Text
  status          LeaveStatus @default(PENDING)
  approvedBy      String?
  approvedAt      DateTime?
  rejectionReason String?     @db.Text
  substituteId    String?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  approver        Employee?   @relation("LeaveApprover", fields: [approvedBy], references: [id])
  company         Company     @relation(fields: [companyId], references: [id], onDelete: Cascade)
  employee        Employee    @relation("EmployeeLeaves", fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([employeeId])
  @@index([status])
  @@index([startDate])
  @@index([approvedBy], map: "hr_leave_requests_approvedBy_fkey")
  @@map("hr_leave_requests")
}

model Payroll {
  id               String        @id @default(cuid())
  companyId        String
  employeeId       String
  month            Int
  year             Int
  periodStart      DateTime      @db.Date
  periodEnd        DateTime      @db.Date
  baseSalary       Decimal       @db.Decimal(12, 2)
  workingDays      Int           @default(30)
  actualWorkDays   Int           @default(30)
  allowances       String?       @db.Text
  totalAllowances  Decimal       @default(0.00) @db.Decimal(12, 2)
  deductions       String?       @db.Text
  totalDeductions  Decimal       @default(0.00) @db.Decimal(12, 2)
  overtimeHours    Decimal       @default(0.00) @db.Decimal(5, 2)
  overtimeRate     Decimal       @default(1.50) @db.Decimal(3, 2)
  overtimeAmount   Decimal       @default(0.00) @db.Decimal(12, 2)
  bonuses          Decimal       @default(0.00) @db.Decimal(12, 2)
  bonusNotes       String?       @db.Text
  socialInsurance  Decimal       @default(0.00) @db.Decimal(12, 2)
  taxAmount        Decimal       @default(0.00) @db.Decimal(12, 2)
  grossSalary      Decimal       @db.Decimal(12, 2)
  netSalary        Decimal       @db.Decimal(12, 2)
  status           PayrollStatus @default(DRAFT)
  paidAt           DateTime?
  paymentMethod    String?
  paymentReference String?
  notes            String?       @db.Text
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  company          Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  employee         Employee      @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([employeeId, month, year])
  @@index([companyId])
  @@index([employeeId])
  @@index([status])
  @@index([month, year])
  @@map("hr_payroll")
}

model PerformanceReview {
  id               String       @id @default(cuid())
  companyId        String
  employeeId       String
  reviewerId       String
  reviewPeriod     String
  periodStart      DateTime     @db.Date
  periodEnd        DateTime     @db.Date
  overallRating    Decimal      @db.Decimal(3, 2)
  ratings          String?      @db.Text
  goals            String?      @db.Text
  goalsAchievement Decimal?     @db.Decimal(5, 2)
  strengths        String?      @db.Text
  improvements     String?      @db.Text
  reviewerComments String?      @db.Text
  employeeComments String?      @db.Text
  recommendations  String?      @db.Text
  status           ReviewStatus @default(DRAFT)
  submittedAt      DateTime?
  acknowledgedAt   DateTime?
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  company          Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  employee         Employee     @relation("EmployeeReviews", fields: [employeeId], references: [id], onDelete: Cascade)
  reviewer         Employee     @relation("ReviewerReviews", fields: [reviewerId], references: [id])

  @@index([companyId])
  @@index([employeeId])
  @@index([reviewerId])
  @@index([status])
  @@map("hr_performance_reviews")
}

model EmployeeDocument {
  id         String    @id @default(cuid())
  companyId  String
  employeeId String
  name       String
  type       String
  fileUrl    String
  fileSize   Int?
  mimeType   String?
  expiryDate DateTime?
  isVerified Boolean   @default(false)
  verifiedBy String?
  verifiedAt DateTime?
  notes      String?   @db.Text
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  company    Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  employee   Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([employeeId])
  @@index([type])
  @@map("hr_employee_documents")
}

model SalaryHistory {
  id               String   @id @default(cuid())
  companyId        String
  employeeId       String
  previousSalary   Decimal  @db.Decimal(12, 2)
  newSalary        Decimal  @db.Decimal(12, 2)
  changeType       String
  changePercentage Decimal? @db.Decimal(5, 2)
  effectiveDate    DateTime @db.Date
  reason           String?  @db.Text
  approvedBy       String?
  createdAt        DateTime @default(now())
  company          Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  employee         Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([employeeId])
  @@map("hr_salary_history")
}

model EmployeeWarning {
  id               String      @id @default(cuid())
  companyId        String
  employeeId       String
  type             WarningType
  severity         String      @default("minor")
  title            String
  description      String      @db.Text
  incidentDate     DateTime    @db.Date
  actionTaken      String?     @db.Text
  issuedBy         String
  acknowledgedAt   DateTime?
  employeeResponse String?     @db.Text
  attachments      String?     @db.Text
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt
  company          Company     @relation(fields: [companyId], references: [id], onDelete: Cascade)
  employee         Employee    @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([employeeId])
  @@map("hr_employee_warnings")
}

model EmployeeTraining {
  id             String         @id @default(cuid())
  companyId      String
  employeeId     String
  trainingName   String
  provider       String?
  type           String
  description    String?        @db.Text
  startDate      DateTime       @db.Date
  endDate        DateTime?      @db.Date
  duration       Int?
  cost           Decimal?       @db.Decimal(12, 2)
  currency       String         @default("EGP")
  status         TrainingStatus @default(PLANNED)
  completionDate DateTime?
  certificateUrl String?
  score          Decimal?       @db.Decimal(5, 2)
  feedback       String?        @db.Text
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  company        Company        @relation(fields: [companyId], references: [id], onDelete: Cascade)
  employee       Employee       @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([employeeId])
  @@index([status])
  @@map("hr_employee_training")
}

model Shift {
  id            String            @id @default(cuid())
  companyId     String
  name          String
  startTime     String
  endTime       String
  breakDuration Int               @default(60)
  color         String?           @default("#3B82F6")
  isActive      Boolean           @default(true)
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  assignments   ShiftAssignment[]
  company       Company           @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("hr_shifts")
}

model ShiftAssignment {
  id         String   @id @default(cuid())
  companyId  String
  employeeId String
  shiftId    String
  date       DateTime @db.Date
  notes      String?  @db.Text
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  company    Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  shift      Shift    @relation(fields: [shiftId], references: [id], onDelete: Cascade)

  @@unique([employeeId, shiftId, date])
  @@index([companyId])
  @@index([employeeId])
  @@index([shiftId])
  @@index([date])
  @@map("hr_shift_assignments")
}

model Benefit {
  id          String              @id @default(cuid())
  companyId   String
  name        String
  description String?             @db.Text
  type        String
  cost        Decimal?            @db.Decimal(12, 2)
  currency    String              @default("EGP")
  isActive    Boolean             @default(true)
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  enrollments BenefitEnrollment[]
  company     Company             @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("hr_benefits")
}

model BenefitEnrollment {
  id         String    @id @default(cuid())
  companyId  String
  employeeId String
  benefitId  String
  startDate  DateTime  @db.Date
  endDate    DateTime? @db.Date
  status     String    @default("ACTIVE")
  notes      String?   @db.Text
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  benefit    Benefit   @relation(fields: [benefitId], references: [id], onDelete: Cascade)
  company    Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  employee   Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([employeeId])
  @@index([benefitId])
  @@map("hr_benefit_enrollments")
}

model Goal {
  id           String      @id @default(cuid())
  companyId    String
  employeeId   String?
  departmentId String?
  title        String
  description  String?     @db.Text
  targetValue  Decimal     @db.Decimal(12, 2)
  currentValue Decimal     @default(0.00) @db.Decimal(12, 2)
  unit         String?
  startDate    DateTime    @db.Date
  endDate      DateTime    @db.Date
  status       String      @default("PENDING")
  progress     Int         @default(0)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  company      Company     @relation(fields: [companyId], references: [id], onDelete: Cascade)
  department   Department? @relation(fields: [departmentId], references: [id], onDelete: Cascade)
  employee     Employee?   @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([employeeId])
  @@index([departmentId])
  @@index([status])
  @@map("hr_goals")
}

model Feedback {
  id             String    @id @default(cuid())
  companyId      String
  fromEmployeeId String
  toEmployeeId   String?
  type           String    @default("PEER")
  category       String?
  content        String    @db.Text
  rating         Int?
  isAnonymous    Boolean   @default(false)
  status         String    @default("ACTIVE")
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  company        Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  fromEmployee   Employee  @relation("FeedbackFrom", fields: [fromEmployeeId], references: [id], onDelete: Cascade)
  toEmployee     Employee? @relation("FeedbackTo", fields: [toEmployeeId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([fromEmployeeId])
  @@index([toEmployeeId])
  @@index([type])
  @@map("hr_feedback")
}

model Resignation {
  id              String    @id @default(cuid())
  companyId       String
  employeeId      String
  resignationDate DateTime  @db.Date
  lastWorkingDay  DateTime  @db.Date
  reason          String?   @db.Text
  exitInterview   String?   @db.Text
  status          String    @default("PENDING")
  approvedBy      String?
  approvedAt      DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  company         Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  employee        Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([employeeId])
  @@index([status])
  @@map("hr_resignations")
}

model HRSettings {
  id                    String   @id @default(cuid())
  companyId             String   @unique
  workDays              String   @default("[1,2,3,4,5]")
  workStartTime         String   @default("09:00")
  workEndTime           String   @default("17:00")
  breakDuration         Int      @default(60)
  annualLeaveDefault    Int      @default(21)
  sickLeaveDefault      Int      @default(15)
  carryOverLimit        Int      @default(5)
  lateGracePeriod       Int      @default(15)
  earlyLeaveGracePeriod Int      @default(15)
  overtimeMinHours      Decimal  @default(1.0) @db.Decimal(3, 1)
  overtimeRate          Decimal  @default(1.50) @db.Decimal(3, 2)
  payrollDay            Int      @default(25)
  socialInsuranceRate   Decimal  @default(14.00) @db.Decimal(5, 2)
  taxBrackets           String?  @db.Text
  publicHolidays        String?  @db.Text
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  company               Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@map("hr_settings")
}

model SupportTicket {
  id          String              @id @default(cuid())
  ticketId    String              @unique
  subject     String
  description String              @db.Text
  category    SupportCategory     @default(INQUIRY)
  status      SupportTicketStatus @default(OPEN)
  rating      Int?
  feedback    String?             @db.Text
  userId      String
  companyId   String?
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  closedAt    DateTime?
  attachments SupportAttachment[]
  messages    SupportMessage[]
  company     Company?            @relation(fields: [companyId], references: [id])
  user        User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([companyId])
  @@index([status])
  @@index([category])
}

model SupportMessage {
  id          String              @id @default(cuid())
  content     String              @db.Text
  isFromAdmin Boolean             @default(false)
  ticketId    String
  senderId    String
  createdAt   DateTime            @default(now())
  attachments SupportAttachment[]
  sender      User                @relation(fields: [senderId], references: [id], onDelete: Cascade)
  ticket      SupportTicket       @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@index([ticketId])
  @@index([senderId])
}

model SupportAttachment {
  id           String          @id @default(cuid())
  filename     String
  originalName String
  mimeType     String
  size         Int
  url          String
  ticketId     String?
  messageId    String?
  createdAt    DateTime        @default(now())
  message      SupportMessage? @relation(fields: [messageId], references: [id], onDelete: Cascade)
  ticket       SupportTicket?  @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@index([ticketId])
  @@index([messageId])
}

model FAQ {
  id         String   @id @default(cuid())
  question   String
  answer     String   @db.Text
  category   String   @default("general")
  tags       String?  @db.Text
  order      Int      @default(0)
  helpful    Int      @default(0)
  notHelpful Int      @default(0)
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([category])
  @@index([isActive])
}

model ai_failure_logs {
  id             String   @id
  companyId      String
  conversationId String?
  customerId     String?
  errorType      String   @db.VarChar(100)
  errorMessage   String?  @db.Text
  context        String?  @db.LongText
  createdAt      DateTime @default(now())

  @@index([companyId, createdAt], map: "idx_company_created")
  @@index([errorType], map: "idx_error_type")
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  EXPIRED
  CANCELLED
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum ProjectStatus {
  PLANNING
  ACTIVE
  COMPLETED
  ON_HOLD
}

enum UserRole {
  SUPER_ADMIN
  COMPANY_ADMIN
  MANAGER
  AGENT
}

enum SubscriptionPlan {
  BASIC
  PRO
  ENTERPRISE
}

enum SubscriptionStatus {
  ACTIVE
  INACTIVE
  CANCELLED
  EXPIRED
  TRIAL
  SUSPENDED
}

enum GeminiKeyType {
  COMPANY
  CENTRAL
}

enum InvoiceStatus {
  DRAFT
  SENT
  PAID
  OVERDUE
  CANCELLED
  REFUNDED
}

enum InvoiceType {
  SUBSCRIPTION
  ONE_TIME
  UPGRADE
  DOWNGRADE
  REFUND
}

enum CustomerStatus {
  LEAD
  PROSPECT
  CUSTOMER
  VIP
  INACTIVE
}

enum CommunicationChannel {
  FACEBOOK
  WHATSAPP
  TELEGRAM
  EMAIL
  SMS
  PHONE
  WEBSITE
  TEST
}

enum ConversationStatus {
  ACTIVE
  PENDING
  RESOLVED
  CLOSED
}

enum MessageType {
  TEXT
  IMAGE
  VIDEO
  AUDIO
  FILE
  LOCATION
  STICKER
  EMOJI
  TEMPLATE
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum PaymentMethod {
  CASH
  CREDIT_CARD
  BANK_TRANSFER
  PAYPAL
  STRIPE
}

enum StockMovementType {
  IN
  OUT
  ADJUSTMENT
  TRANSFER
  RETURN
}

enum StockMovementReason {
  PURCHASE
  SALE
  DAMAGE
  EXPIRED
  LOST
  FOUND
  TRANSFER
  RETURN
  ADJUSTMENT
}

enum AlertPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum AlertType {
  LOW_STOCK
  OUT_OF_STOCK
  OVERSTOCK
  EXPIRY_WARNING
}

enum StorePageType {
  SHIPPING_POLICY
  RETURN_POLICY
  REFUND_POLICY
  PRIVACY_POLICY
  TERMS_CONDITIONS
  ABOUT_US
  CONTACT_US
  FAQ
  PAYMENT_METHODS
  CUSTOM
}

enum CouponType {
  PERCENTAGE
  FIXED
  FREE_SHIPPING
}

enum WhatsAppSessionStatus {
  CONNECTED
  DISCONNECTED
  QR_PENDING
  CONNECTING
  LOGGED_OUT
}

enum WhatsAppMessageType {
  TEXT
  IMAGE
  VIDEO
  AUDIO
  DOCUMENT
  STICKER
  LOCATION
  CONTACT
  REACTION
  POLL
  TEMPLATE
  BUTTONS
  LIST
  PRODUCT
  INTERACTIVE
}

enum WhatsAppMessageStatus {
  PENDING
  SENT
  DELIVERED
  READ
  FAILED
}

enum Gender {
  MALE
  FEMALE
}

enum MaritalStatus {
  SINGLE
  MARRIED
  DIVORCED
  WIDOWED
}

enum ContractType {
  FULL_TIME
  PART_TIME
  CONTRACT
  TEMPORARY
  INTERNSHIP
  FREELANCE
}

enum EmployeeStatus {
  ACTIVE
  ON_LEAVE
  SUSPENDED
  TERMINATED
  RESIGNED
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  HALF_DAY
  ON_LEAVE
  HOLIDAY
  WEEKEND
  REMOTE
}

enum LeaveType {
  ANNUAL
  SICK
  UNPAID
  MATERNITY
  PATERNITY
  BEREAVEMENT
  MARRIAGE
  HAJJ
  STUDY
  EMERGENCY
  OTHER
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

enum PayrollStatus {
  DRAFT
  PENDING_APPROVAL
  APPROVED
  PAID
  CANCELLED
}

enum ReviewStatus {
  DRAFT
  SUBMITTED
  ACKNOWLEDGED
  COMPLETED
}

enum WarningType {
  VERBAL
  WRITTEN
  FINAL
  TERMINATION
}

enum TrainingStatus {
  PLANNED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum SupportTicketStatus {
  OPEN
  IN_PROGRESS
  CLOSED
}

enum SupportCategory {
  TECHNICAL
  BILLING
  INQUIRY
  SUGGESTION
  COMPLAINT
}

enum whatsapp_statuses_type {
  TEXT
  IMAGE
  VIDEO
  AUDIO
  DOCUMENT
  STICKER
  LOCATION
  CONTACT
  POLL
  PRODUCT
  ORDER
  CATALOG
  INTERACTIVE
  BUTTON_REPLY
  LIST_REPLY
  TEMPLATE
}

# ุชุญููู ุตูุญุฉ Telegram Userbot

## ๐ ูุง ูู ุตูุญุฉ Telegram Userbotุ

ุตูุญุฉ `/telegram-userbot` ูู ูุธุงู **ูุฎุชูู ุชูุงูุงู** ุนู Telegram Bot:

### ุงููุฑู ุจูู Telegram Bot ู Telegram Userbot:

| ุงูููุฒุฉ | Telegram Bot | Telegram Userbot |
|--------|--------------|------------------|
| **ุงูููุน** | Bot Token ูู @BotFather | ุญุณุงุจ Telegram ุดุฎุตู (MTProto API) |
| **ุงููุตูู** | ููุท ุงููุญุงุฏุซุงุช ุงูุชู ุจุฏุฃูุง ุงููุณุชุฎุฏู ูุน ุงูุจูุช | ุงููุตูู ุงููุงูู ูุญุณุงุจ Telegram ุงูุดุฎุตู |
| **ุงููุญุงุฏุซุงุช** | ููุท ูุน ุงููุณุชุฎุฏููู ุงูุฐูู ุจุฏุฃูุง ูุญุงุฏุซุฉ | ุฌููุน ุงููุญุงุฏุซุงุช (ุฃูุฑุงุฏุ ูุฌููุนุงุชุ ูููุงุช) |
| **ุงูุงุณุชุฎุฏุงู** | ููุจูุชุงุช ุงูุขููุฉ | ูุฅุฏุงุฑุฉ ุญุณุงุจ Telegram ุงูุดุฎุตู ูู Dashboard |

### ุงููุธููุฉ:
ุตูุญุฉ Telegram Userbot ุชุณูุญ ูู ุจู:
1. **ุชุณุฌูู ุงูุฏุฎูู** ุจุญุณุงุจ Telegram ุงูุดุฎุตู (ุฑูู ุงููุงุชู + ููุฏ ุงูุชุญูู)
2. **ุนุฑุถ ุฌููุน ุงููุญุงุฏุซุงุช** (ุฃูุฑุงุฏุ ูุฌููุนุงุชุ ูููุงุช)
3. **ุฅุฑุณุงู ูุงุณุชูุจุงู ุงูุฑุณุงุฆู** ูู ุญุณุงุจู ุงูุดุฎุตู
4. **ุฅุฑุณุงู ุงููููุงุช** ูู ุญุณุงุจู ุงูุดุฎุตู

---

## ๐ง ููู ุชุนููุ

### 1. ุนูููุฉ ุชุณุฌูู ุงูุฏุฎูู:
```
1. ุงููุณุชุฎุฏู ูุฏุฎู ุฑูู ุงููุงุชู
2. Backend ูุฑุณู ููุฏ ุงูุชุญูู ุนุจุฑ Telegram API
3. ุงููุณุชุฎุฏู ูุฏุฎู ุงูููุฏ
4. Backend ูุญูุธ Session String ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
5. ุงููุณุชุฎุฏู ููููู ุงูุขู ุงุณุชุฎุฏุงู ุญุณุงุจู
```

### 2. API Endpoints:
- `POST /api/userbot/login` - ุฅุฑุณุงู ููุฏ ุงูุชุญูู
- `POST /api/userbot/verify` - ุงูุชุญูู ูู ุงูููุฏ ูุชุณุฌูู ุงูุฏุฎูู
- `GET /api/userbot/dialogs` - ุฌูุจ ูุงุฆูุฉ ุงููุญุงุฏุซุงุช
- `GET /api/userbot/messages` - ุฌูุจ ุฑุณุงุฆู ูุญุงุฏุซุฉ ูุนููุฉ
- `POST /api/userbot/message` - ุฅุฑุณุงู ุฑุณุงูุฉ
- `POST /api/userbot/message/file` - ุฅุฑุณุงู ููู
- `POST /api/userbot/logout` - ุชุณุฌูู ุงูุฎุฑูุฌ

### 3. ุงูููุชุจุฉ ุงููุณุชุฎุฏูุฉ:
- **GramJS (telegram)** - ููุชุจุฉ Node.js ูููุตูู ูู Telegram MTProto API
- ุชุณูุญ ุจุงููุตูู ุงููุงูู ูุญุณุงุจ Telegram ุงูุดุฎุตู

---

## โ ุงูุฃุฎุทุงุก ุงูููุฌูุฏุฉ (ุชู ุฅุตูุงุญ ุจุนุถูุง)

### 1. **ุฎุทุฃ ูู Schema (ูุดููุฉ ุญุฑุฌุฉ)** โ ุชู ุงูุฅุตูุงุญ

**ุงููุดููุฉ (ุงูุณุงุจูุฉ):**
- ุงูููุฏ ูุงู ูุญุงูู ุงุณุชุฎุฏุงู `type: 'USERBOT'` ู `sessionString` ูู `TelegramConfig`
- ููู Schema ูุงู ูุญุชูู ุนูู:
  - `clientSession` (ุจุฏูุงู ูู `sessionString`)
  - ูุง ููุฌุฏ `type` field

**ุงูุฅุตูุงุญ ุงููุทุจู:**
- โ ุชู ุฅุถุงูุฉ `type` field ุฅูู Schema
- โ ุชู ุฅุถุงูุฉ `sessionString` field ุฅูู Schema
- โ ุชู ุฅุถุงูุฉ unique constraint ุนูู `[companyId, type]`
- โ ุชู ุชุญุฏูุซ ุงูููุฏ ูุงุณุชุฎุฏุงู ุงูุญููู ุงูุฌุฏูุฏุฉ ูุน fallback ูู `clientSession`

### 2. **ุนุฏู ูุฌูุฏ Authentication ูู Routes** โ ุชู ุงูุฅุตูุงุญ

**ุงููุดููุฉ (ุงูุณุงุจูุฉ):**
- ุฌููุน routes ูู `userbotRoutes.js` ูุงูุช **ุบูุฑ ูุญููุฉ** ุจู authentication
- ุฃู ุดุฎุต ูุงู ููููู ุงููุตูู ูุญุณุงุจุงุช Telegram!

**ุงูุฅุตูุงุญ ุงููุทุจู:**
- โ ุชู ุฅุถุงูุฉ `verifyToken.authenticateToken` ูุฌููุน routes
- โ ุชู ุฅุถุงูุฉ `verifyToken.requireCompanyAccess` ูุฌููุน routes
- โ ุชู ุชุญุฏูุซ Frontend ูุฅุฑุณุงู Authorization token
- โ ุชู ุฅุฒุงูุฉ `companyId` ูู request body ูุงุณุชุฎุฏุงูู ูู JWT token

### 3. **ูุดููุฉ ูู ุฅุฏุงุฑุฉ Session**

**ุงููุดููุฉ:**
- Session ูุชู ุญูุธู ูู memory (`this.clients.set(companyId, client)`)
- ุนูุฏ ุฅุนุงุฏุฉ ุชุดุบูู ุงูุณูุฑูุฑุ ูุชู ููุฏุงู ุฌููุน ุงูุฌูุณุงุช
- ูุฌุจ ุฅุนุงุฏุฉ ุงูุงุชุตุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ูู ูุฑุฉ

### 4. **ูุดููุฉ ูู Polling**

**ุงููุดููุฉ:**
- Frontend ูุณุชุฎุฏู Polling ูู 3 ุซูุงูู ูุฌูุจ ุงูุฑุณุงุฆู (`setInterval(fetchMessages, 3000)`)
- ูุฐุง ุบูุฑ ูุนุงู ููุณุชููู ููุงุฑุฏ ูุซูุฑุฉ
- ูุฌุจ ุงุณุชุฎุฏุงู WebSocket ุฃู Telegram Updates

### 5. **ูุดููุฉ ูู Error Handling**

**ุงููุดููุฉ:**
- ูุง ููุฌุฏ ูุนุงูุฌุฉ ููุฃุฎุทุงุก ุจุดูู ุตุญูุญ
- ุนูุฏ ูุดู ุงูุงุชุตุงูุ ูุง ูุชู ุฅุนุงุฏุฉ ุงููุญุงููุฉ
- ูุง ููุฌุฏ feedback ูุงุถุญ ูููุณุชุฎุฏู

### 6. **ูุดููุฉ ูู 2FA (Two-Factor Authentication)**

**ุงููุดููุฉ:**
- ุงูููุฏ ูุง ูุฏุนู 2FA ุจุดูู ูุงูู
- ุฅุฐุง ูุงู ุงูุญุณุงุจ ูุญูู ุจู 2FAุ ุณููุดู ุชุณุฌูู ุงูุฏุฎูู

### 7. **ูุดููุฉ ูู ุฅุฑุณุงู ุงููููุงุช**

**ุงููุดููุฉ:**
- ูุชู ุญูุธ ุงูููู ูู temp directory ุซู ุญุฐูู
- ูู ุจูุฆุฉ serverlessุ ูุฏ ูุง ูุนูู ุจุดูู ุตุญูุญ
- ูุฌุจ ุงุณุชุฎุฏุงู buffer ูุจุงุดุฑุฉ ุฃู S3

---

## ๐ง ุงูุฅุตูุงุญุงุช ุงููุทููุจุฉ

### 1. ุชุญุฏูุซ Schema:
```prisma
model TelegramConfig {
  id              String   @id @default(cuid())
  companyId       String
  type            String   @default("BOT") // "BOT" or "USERBOT"
  label           String   @default("Official Bot")
  botToken        String?  @db.Text
  sessionString   String?  @db.Text // ููู USERBOT
  clientSession   String?  @db.Text // ููู USERBOT (deprecated)
  // ... ุจุงูู ุงูุญููู
}
```

### 2. ุฅุถุงูุฉ Authentication:
```javascript
router.post('/login', verifyToken.authenticateToken, verifyToken.requireCompanyAccess, async (req, res) => {
router.get('/dialogs', verifyToken.authenticateToken, verifyToken.requireCompanyAccess, async (req, res) => {
// ... ุฅูุฎ
```

### 3. ุชุญุณูู ุฅุฏุงุฑุฉ Session:
- ุญูุธ Session ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุดูู ุตุญูุญ
- ุฅุนุงุฏุฉ ุงูุงุชุตุงู ุชููุงุฆูุงู ุนูุฏ ุฅุนุงุฏุฉ ุงูุชุดุบูู
- ุงูุชุญูู ูู ุตุญุฉ Session ูุจู ุงูุงุณุชุฎุฏุงู

### 4. ุงุณุชุจุฏุงู Polling ุจู WebSocket:
- ุงุณุชุฎุฏุงู Telegram Updates API
- ุฃู ุงุณุชุฎุฏุงู Socket.IO ูุฅุฑุณุงู ุงูุฑุณุงุฆู ุงูุฌุฏูุฏุฉ

### 5. ุฅุถุงูุฉ ุฏุนู 2FA:
- ูุนุงูุฌุฉ ุญุงูุฉ 2FA ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู
- ุทูุจ ูููุฉ ุงููุฑูุฑ ุฅุฐุง ูุฒู ุงูุฃูุฑ

---

## ๐ ููุฎุต ุงูุฃุฎุทุงุก

| ุงูุฎุทุฃ | ุงูุฎุทูุฑุฉ | ุงูุญุงูุฉ |
|-------|---------|--------|
| Schema ุบูุฑ ูุชุทุงุจู | ๐ด ุญุฑุฌุฉ | ูุฌุจ ุฅุตูุงุญูุง ููุฑุงู |
| ุนุฏู ูุฌูุฏ Authentication | ๐ด ุญุฑุฌุฉ | ูุฌุจ ุฅุตูุงุญูุง ููุฑุงู |
| ุฅุฏุงุฑุฉ Session ุบูุฑ ุตุญูุญุฉ | ๐ก ูุชูุณุทุฉ | ูุฌุจ ุชุญุณูููุง |
| ุงุณุชุฎุฏุงู Polling | ๐ก ูุชูุณุทุฉ | ูุฌุจ ุงุณุชุจุฏุงููุง |
| ุนุฏู ุฏุนู 2FA | ๐ก ูุชูุณุทุฉ | ูุฌุจ ุฅุถุงูุชูุง |
| Error Handling ุถุนูู | ๐ข ููุฎูุถุฉ | ูุฌุจ ุชุญุณูููุง |
| ุฅุฑุณุงู ุงููููุงุช | ๐ข ููุฎูุถุฉ | ูุฌุจ ุชุญุณูููุง |

---

## โ ุงูุชูุตูุงุช

### ููุงุณุชุฎุฏุงู ุงูููุฑู:
1. โ **ุชู ุฅุตูุงุญ ุงูุฃุฎุทุงุก ุงูุญุฑุฌุฉ** - Schema + Authentication
2. โ **ุชู ุฅุถุงูุฉ ุฏุนู 2FA**
3. โ **ุชู ุชุญุณูู Error Handling**

### ููุชุญุณููุงุช ุงููุณุชูุจููุฉ:
1. โณ ุงุณุชุจุฏุงู Polling ุจู WebSocket (ุชุญุณูู ุฃุฏุงุก)
2. โณ ุชุญุณูู ุฅุฏุงุฑุฉ Session (ุฅุนุงุฏุฉ ุงูุงุชุตุงู ุงูุชููุงุฆู)
3. โณ ุฅุถุงูุฉ Unit Tests

---

## ๐ฏ ุงูุฎูุงุตุฉ

ุตูุญุฉ Telegram Userbot ูู **ูุธุงู ููู** ูุณูุญ ุจุงููุตูู ุงููุงูู ูุญุณุงุจ Telegram ุงูุดุฎุตู.

### โ ุงูุฅุตูุงุญุงุช ุงูููุชููุฉ:
- โ ุฅุตูุงุญ Schema (ุฅุถุงูุฉ type ู sessionString)
- โ ุฅุถุงูุฉ Authentication ูุฌููุน routes
- โ ุฅุถุงูุฉ ุฏุนู 2FA
- โ ุชุญุณูู Error Handling
- โ ุชุญุณูู ูุนุงูุฌุฉ chatId (ุฏุนู username ู ID)

### โณ ุงูุชุญุณููุงุช ุงููุชุจููุฉ (ุบูุฑ ุญุฑุฌุฉ):
- โณ ุงุณุชุจุฏุงู Polling ุจู WebSocket
- โณ ุชุญุณูู ุฅุฏุงุฑุฉ Session ุนูุฏ ุฅุนุงุฏุฉ ุงูุชุดุบูู

**ุงูุญุงูุฉ ุงูุญุงููุฉ:** โ **ุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู** ุจุนุฏ ุชูููุฐ Migration

### ๐ ููุงุญุธุงุช ูููุฉ:
1. **ูุฌุจ ุฅุถุงูุฉ `TELEGRAM_API_ID` ู `TELEGRAM_API_HASH` ูู `.env`**
2. **ูุฌุจ ุงุฎุชุจุงุฑ ุงูุตูุญุฉ ุจุนุฏ Migration**
3. **Session ูุชู ุญูุธู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชููุงุฆูุงู**

